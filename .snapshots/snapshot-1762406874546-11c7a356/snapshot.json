{
  "id": "snapshot-1762406874546-11c7a356",
  "timestamp": 1762406874546,
  "description": "",
  "gitBranch": "main",
  "gitCommitHash": "195f197029df664ac87eac6369e39402cf149e7a",
  "tags": [],
  "notes": "",
  "taskReference": "",
  "isFavorite": false,
  "isSelective": false,
  "selectedFiles": [],
  "files": {
    ".dockerignore": {
      "diff": "Index: .dockerignore\n===================================================================\n--- .dockerignore\n+++ .dockerignore\n@@ -1,9 +1,63 @@\n+# Git\n+.git\n+.gitignore\n+.gitattributes\n+\n+# CI/CD\n+.github\n+\n+# Documentation\n+*.md\n+\n+# Environment files\n+.env\n+.env.*\n+!.env.example\n+\n+# Dependencies\n node_modules\n npm-debug.log\n-.env\n-.git\n-.gitignore\n-README.md\n+yarn-error.log\n+\n+# IDE\n+.vscode\n+.idea\n+*.swp\n+*.swo\n+*~\n+\n+# OS\n .DS_Store\n+Thumbs.db\n+\n+# Logs\n+logs\n *.log\n+\n+# Backups\n+backups\n+*.sql\n+*.sql.gz\n+\n+# Certificates\n+certbot\n+\n+# Nginx config (copied separately)\n+nginx\n+\n+# Development files\n+docker-compose.yml\n+Dockerfile\n client\n+\n+# Test files\n+test\n+tests\n+*.test.js\n+*.spec.js\n+coverage\n+\n+# Temporary files\n+tmp\n+temp\n+*.tmp\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    ".env.example": {
      "diff": "Index: .env.example\n===================================================================\n--- .env.example\n+++ .env.example\n@@ -1,14 +1,18 @@\n # Server Configuration\n PORT=3000\n NODE_ENV=development\n \n-# MySQL Database Configuration\n+# PostgreSQL Database Configuration\n+# For Vercel deployment, use POSTGRES_URL connection string (recommended)\n+POSTGRES_URL=postgresql://user:password@host:5432/database\n+\n+# OR use individual settings (fallback for local development)\n DB_USER=freelance_user\n DB_HOST=localhost\n DB_NAME=freelance_platform\n DB_PASSWORD=root123\n-DB_PORT=3306\n+DB_PORT=5432\n \n # JWT Configuration\n # IMPORTANT: Generate strong secrets using: node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\n # DO NOT use these example values in production!\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    ".env.production.example": {
      "content": "# Production Environment Configuration\r\n# Copy this file to .env.production and fill in the values\r\n\r\n# ======================================\r\n# Domain Configuration\r\n# ======================================\r\nDOMAIN=yourdomain.com\r\nEMAIL=your-email@example.com\r\n\r\n# ======================================\r\n# Server Configuration\r\n# ======================================\r\nNODE_ENV=production\r\nPORT=3000\r\n\r\n# ======================================\r\n# PostgreSQL Database Configuration\r\n# ======================================\r\n# Database credentials (use a strong password!)\r\nDB_USER=freelance_user\r\nDB_NAME=freelance_platform\r\nDB_PASSWORD=\r\nDB_PORT=5432\r\n\r\n# ======================================\r\n# JWT Configuration\r\n# ======================================\r\n# Generate strong secrets using:\r\n# node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\r\n\r\nJWT_SECRET=\r\nJWT_REFRESH_SECRET=\r\nJWT_EXPIRES_IN=15m\r\nJWT_REFRESH_EXPIRES_IN=7d\r\n\r\n# ======================================\r\n# Frontend Configuration\r\n# ======================================\r\n# API URL that the frontend will use (usually https://yourdomain.com)\r\nCLIENT_URL=https://yourdomain.com\r\nVITE_API_URL=https://yourdomain.com/api\r\n\r\n# ======================================\r\n# Client Port (internal)\r\n# ======================================\r\nCLIENT_PORT=5173\r\n\r\n# ======================================\r\n# Email Configuration (Optional - for future features)\r\n# ======================================\r\n# SMTP_HOST=smtp.gmail.com\r\n# SMTP_PORT=587\r\n# SMTP_SECURE=false\r\n# SMTP_USER=\r\n# SMTP_PASSWORD=\r\n# SMTP_FROM=noreply@yourdomain.com\r\n\r\n# ======================================\r\n# Monitoring & Logging (Optional)\r\n# ======================================\r\n# LOG_LEVEL=info\r\n# SENTRY_DSN=\r\n\r\n# ======================================\r\n# Rate Limiting (Optional - defaults in code)\r\n# ======================================\r\n# RATE_LIMIT_WINDOW_MS=900000\r\n# RATE_LIMIT_MAX_REQUESTS=100\r\n"
    },
    ".do\\app.yaml": {
      "content": "name: freelance-platform\r\nregion: nyc\r\n\r\n# Backend API Service\r\nservices:\r\n  - name: api\r\n    github:\r\n      repo: YukioTheSage/freelance-sturdy\r\n      branch: main\r\n      deploy_on_push: true\r\n    source_dir: /\r\n    build_command: npm install\r\n    run_command: npm start\r\n    environment_slug: node-js\r\n    instance_count: 1\r\n    instance_size_slug: basic-xxs\r\n    http_port: 3000\r\n    routes:\r\n      - path: /api\r\n      - path: /health\r\n    health_check:\r\n      http_path: /health\r\n      initial_delay_seconds: 30\r\n      period_seconds: 10\r\n      timeout_seconds: 5\r\n      success_threshold: 1\r\n      failure_threshold: 3\r\n    envs:\r\n      - key: NODE_ENV\r\n        value: production\r\n      - key: PORT\r\n        value: \"3000\"\r\n      - key: JWT_SECRET\r\n        value: ${JWT_SECRET}\r\n        type: SECRET\r\n      - key: JWT_REFRESH_SECRET\r\n        value: ${JWT_REFRESH_SECRET}\r\n        type: SECRET\r\n      - key: JWT_EXPIRES_IN\r\n        value: \"15m\"\r\n      - key: JWT_REFRESH_EXPIRES_IN\r\n        value: \"7d\"\r\n      - key: CLIENT_URL\r\n        value: ${web.PUBLIC_URL}\r\n      - key: POSTGRES_URL\r\n        value: ${POSTGRES_URL}\r\n        type: SECRET\r\n\r\n# Frontend Static Site\r\nstatic_sites:\r\n  - name: web\r\n    github:\r\n      repo: YukioTheSage/freelance-sturdy\r\n      branch: main\r\n      deploy_on_push: true\r\n    source_dir: /client\r\n    build_command: npm install && npm run build\r\n    output_dir: dist\r\n    routes:\r\n      - path: /\r\n    envs:\r\n      - key: VITE_API_URL\r\n        value: ${api.PUBLIC_URL}/api\r\n"
    },
    ".nodemon.json": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    ".gitignore": {
      "diff": "Index: .gitignore\n===================================================================\n--- .gitignore\n+++ .gitignore\n@@ -6,8 +6,9 @@\n # Environment variables\n .env\n .env.local\n .env.*.local\n+.env.production\n \n # Logs\n logs/\n *.log\n@@ -28,4 +29,13 @@\n \n # Build\n dist/\n build/\n+\n+# Production deployment\n+backups/\n+*.sql\n+*.sql.gz\n+certbot/\n+\n+# Docker volumes\n+mysql_data/\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "Dockerfile.prod": {
      "content": "# Multi-stage build for production\r\nFROM node:18-alpine AS base\r\n\r\n# Install dumb-init for proper signal handling\r\nRUN apk add --no-cache dumb-init\r\n\r\nWORKDIR /app\r\n\r\n# Copy package files\r\nCOPY package*.json ./\r\n\r\n# Install production dependencies only\r\nRUN npm ci --only=production && npm cache clean --force\r\n\r\n# Copy source code\r\nCOPY src ./src\r\n\r\n# Create non-root user\r\nRUN addgroup -g 1001 -S nodejs && \\\r\n    adduser -S nodejs -u 1001 && \\\r\n    chown -R nodejs:nodejs /app\r\n\r\nUSER nodejs\r\n\r\n# Expose port\r\nEXPOSE 3000\r\n\r\n# Health check\r\nHEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \\\r\n  CMD node -e \"require('http').get('http://localhost:3000/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})\"\r\n\r\n# Use dumb-init to handle signals properly\r\nENTRYPOINT [\"dumb-init\", \"--\"]\r\n\r\n# Start application\r\nCMD [\"node\", \"src/server.js\"]\r\n"
    },
    "entrypoint.sh": {
      "diff": "Index: entrypoint.sh\n===================================================================\n--- entrypoint.sh\n+++ entrypoint.sh\n@@ -1,11 +1,11 @@\n #!/bin/bash\n-# Wait for MySQL to be ready\n-echo \"Waiting for MySQL to be ready...\"\n-while ! nc -z mysql 3306; do\n+# Wait for PostgreSQL to be ready\n+echo \"Waiting for PostgreSQL to be ready...\"\n+while ! nc -z postgres 5432; do\n   sleep 1\n done\n-echo \"MySQL is ready!\"\n+echo \"PostgreSQL is ready!\"\n \n # Initialize database and seed data\n echo \"Initializing database...\"\n npm run init-db\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "Dockerfile": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "docker-compose.yml": {
      "diff": "Index: docker-compose.yml\n===================================================================\n--- docker-compose.yml\n+++ docker-compose.yml\n@@ -1,26 +1,25 @@\n version: '3.8'\n \n services:\n-  # MySQL Database\n-  mysql:\n-    image: mysql:8.0\n-    container_name: freelance_mysql\n+  # PostgreSQL Database\n+  postgres:\n+    image: postgres:16\n+    container_name: freelance_postgres\n     restart: unless-stopped\n     environment:\n-      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD:-root123}\n-      MYSQL_DATABASE: ${DB_NAME:-freelance_platform}\n-      MYSQL_USER: ${DB_USER:-freelance_user}\n-      MYSQL_PASSWORD: ${DB_PASSWORD:-root123}\n+      POSTGRES_USER: ${DB_USER:-freelance_user}\n+      POSTGRES_PASSWORD: ${DB_PASSWORD:-root123}\n+      POSTGRES_DB: ${DB_NAME:-freelance_platform}\n     ports:\n-      - \"${DB_PORT:-3306}:3306\"\n+      - \"${DB_PORT:-5432}:5432\"\n     volumes:\n-      - mysql_data:/var/lib/mysql\n+      - postgres_data:/var/lib/postgresql/data\n       - ./src/db/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql\n     networks:\n       - freelance_network\n     healthcheck:\n-      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\", \"-u\", \"root\", \"-p${DB_PASSWORD:-root123}\"]\n+      test: [\"CMD-SHELL\", \"pg_isready -U ${DB_USER:-freelance_user}\"]\n       timeout: 20s\n       retries: 10\n \n   # Node.js Application (optional - can run locally too)\n@@ -33,19 +32,19 @@\n     environment:\n       NODE_ENV: ${NODE_ENV:-development}\n       PORT: ${PORT:-3000}\n       DB_USER: ${DB_USER:-freelance_user}\n-      DB_HOST: mysql\n+      DB_HOST: postgres\n       DB_NAME: ${DB_NAME:-freelance_platform}\n       DB_PASSWORD: ${DB_PASSWORD:-root123}\n-      DB_PORT: 3306\n+      DB_PORT: 5432\n       JWT_SECRET: ${JWT_SECRET}\n       JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}\n       JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-15m}\n       JWT_REFRESH_EXPIRES_IN: ${JWT_REFRESH_EXPIRES_IN:-7d}\n       CLIENT_URL: ${CLIENT_URL:-http://localhost:5173}\n     depends_on:\n-      mysql:\n+      postgres:\n         condition: service_healthy\n     networks:\n       - freelance_network\n     volumes:\n@@ -73,9 +72,9 @@\n       - /app/node_modules\n     command: npm run dev -- --host 0.0.0.0 --port 5173\n \n volumes:\n-  mysql_data:\n+  postgres_data:\n     driver: local\n \n networks:\n   freelance_network:\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    ".github\\workflows\\deploy.yml": {
      "content": "name: Deploy to Production\r\n\r\non:\r\n  push:\r\n    branches:\r\n      - main\r\n  workflow_dispatch: # Allow manual trigger\r\n\r\njobs:\r\n  test:\r\n    name: Run Tests\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n      - name: Checkout code\r\n        uses: actions/checkout@v3\r\n\r\n      - name: Setup Node.js\r\n        uses: actions/setup-node@v3\r\n        with:\r\n          node-version: '18'\r\n          cache: 'npm'\r\n\r\n      - name: Install dependencies\r\n        run: npm ci\r\n\r\n      # Uncomment when you have tests\r\n      # - name: Run tests\r\n      #   run: npm test\r\n\r\n      - name: Check code formatting\r\n        run: npm run lint || echo \"No linting configured\"\r\n        continue-on-error: true\r\n\r\n  deploy:\r\n    name: Deploy to DigitalOcean\r\n    needs: test\r\n    runs-on: ubuntu-latest\r\n    if: github.ref == 'refs/heads/main'\r\n\r\n    steps:\r\n      - name: Deploy to production server\r\n        uses: appleboy/ssh-action@master\r\n        with:\r\n          host: ${{ secrets.DROPLET_IP }}\r\n          username: ${{ secrets.DROPLET_USER }}\r\n          key: ${{ secrets.SSH_PRIVATE_KEY }}\r\n          script: |\r\n            cd ~/your-repo\r\n            git pull origin main\r\n            docker-compose -f docker-compose.prod.yml build --no-cache\r\n            docker-compose -f docker-compose.prod.yml up -d\r\n            docker image prune -f\r\n\r\n      - name: Health check\r\n        run: |\r\n          sleep 30\r\n          curl -f https://${{ secrets.DOMAIN }}/health || exit 1\r\n\r\n      - name: Notify deployment\r\n        if: always()\r\n        run: |\r\n          if [ ${{ job.status }} == 'success' ]; then\r\n            echo \"✅ Deployment successful!\"\r\n          else\r\n            echo \"❌ Deployment failed!\"\r\n          fi\r\n\r\n  # Optional: Notify on Slack/Discord\r\n  # notify:\r\n  #   name: Send notification\r\n  #   needs: deploy\r\n  #   runs-on: ubuntu-latest\r\n  #   if: always()\r\n  #   steps:\r\n  #     - name: Send Slack notification\r\n  #       uses: 8398a7/action-slack@v3\r\n  #       with:\r\n  #         status: ${{ job.status }}\r\n  #         webhook_url: ${{ secrets.SLACK_WEBHOOK }}\r\n"
    },
    "vercel.json": {
      "content": "{\r\n  \"version\": 2,\r\n  \"name\": \"freelance-platform-api\",\r\n  \"builds\": [\r\n    {\r\n      \"src\": \"api/**/*.js\",\r\n      \"use\": \"@vercel/node\"\r\n    }\r\n  ],\r\n  \"routes\": [\r\n    {\r\n      \"src\": \"/api/(.*)\",\r\n      \"dest\": \"/api/$1\"\r\n    },\r\n    {\r\n      \"src\": \"/health\",\r\n      \"dest\": \"/api/health\"\r\n    }\r\n  ],\r\n  \"env\": {\r\n    \"NODE_ENV\": \"production\"\r\n  },\r\n  \"regions\": [\"iad1\"]\r\n}\r\n"
    },
    "api\\health.js": {
      "content": "const { query } = require('../lib/db');\r\nconst { apiHandler } = require('../lib/middleware');\r\n\r\n/**\r\n * GET /api/health\r\n * Health check endpoint for monitoring\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  try {\r\n    // Test database connection\r\n    const result = await query('SELECT NOW() as time');\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'API is running',\r\n      timestamp: new Date().toISOString(),\r\n      database: result.rows.length > 0 ? 'connected' : 'disconnected'\r\n    });\r\n  } catch (error) {\r\n    res.status(503).json({\r\n      success: false,\r\n      message: 'Service unavailable',\r\n      error: error.message\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET']\r\n});\r\n"
    },
    "api\\proposals\\[id].js": {
      "content": "const { body, param } = require('express-validator');\r\nconst { query } = require('../../lib/db');\r\nconst { authenticate } = require('../../lib/auth');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * GET /api/proposals/:id\r\n * Get proposal by ID with full details\r\n * Protected: Requires authentication\r\n */\r\nconst getProposal = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  const result = await query(\r\n    `SELECT p.*,\r\n            proj.title AS project_title,\r\n            proj.description AS project_description,\r\n            CONCAT_WS(' ', u.first_name, u.last_name) AS freelancer_name,\r\n            u.email AS freelancer_email,\r\n            fp.bio AS freelancer_bio,\r\n            fp.rating_avg AS freelancer_rating,\r\n            fp.rating_count AS freelancer_rating_count,\r\n            fp.experience_years AS freelancer_experience\r\n     FROM proposals p\r\n     JOIN projects proj ON p.project_id = proj.id\r\n     JOIN freelancer_profiles fp ON p.freelancer_id = fp.id\r\n     JOIN users u ON fp.user_id = u.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (result.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  res.json({ success: true, data: result.rows[0] });\r\n};\r\n\r\n/**\r\n * PATCH /api/proposals/:id\r\n * Update proposal (e.g., change status, update bid)\r\n * Protected: Freelancer can update their own proposal, Client can update status\r\n */\r\nconst updateProposal = async (req, res) => {\r\n  const { id } = req.query;\r\n  const { bid_amount, hourly_rate, estimated_hours, cover_letter, status } = req.body;\r\n\r\n  // Get the proposal with owner info\r\n  const proposalResult = await query(\r\n    `SELECT p.*, fp.user_id as freelancer_user_id, cp.user_id as client_user_id\r\n     FROM proposals p\r\n     JOIN freelancer_profiles fp ON p.freelancer_id = fp.id\r\n     JOIN projects proj ON p.project_id = proj.id\r\n     JOIN client_profiles cp ON proj.client_id = cp.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (proposalResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  const proposal = proposalResult.rows[0];\r\n\r\n  // Check permissions\r\n  const isFreelancerOwner = proposal.freelancer_user_id === req.user.userId;\r\n  const isProjectOwner = proposal.client_user_id === req.user.userId;\r\n  const isAdmin = req.user.role === 'admin';\r\n\r\n  if (!isFreelancerOwner && !isProjectOwner && !isAdmin) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to update this proposal'\r\n    });\r\n  }\r\n\r\n  // Freelancers can only update bid details, not status\r\n  // Clients can only update status\r\n  let updateFields = {};\r\n\r\n  if (isFreelancerOwner && !isProjectOwner) {\r\n    // Freelancer updating their own proposal\r\n    updateFields = {\r\n      bid_amount: bid_amount ?? null,\r\n      hourly_rate: hourly_rate ?? null,\r\n      estimated_hours: estimated_hours ?? null,\r\n      cover_letter: cover_letter ?? null\r\n    };\r\n  } else if (isProjectOwner || isAdmin) {\r\n    // Client or admin updating status\r\n    if (status) {\r\n      updateFields.status = status;\r\n    }\r\n  }\r\n\r\n  const updateResult = await query(\r\n    `UPDATE proposals\r\n     SET bid_amount = COALESCE(?, bid_amount),\r\n         hourly_rate = COALESCE(?, hourly_rate),\r\n         estimated_hours = COALESCE(?, estimated_hours),\r\n         cover_letter = COALESCE(?, cover_letter),\r\n         status = COALESCE(?, status)\r\n     WHERE id = ?`,\r\n    [\r\n      updateFields.bid_amount ?? null,\r\n      updateFields.hourly_rate ?? null,\r\n      updateFields.estimated_hours ?? null,\r\n      updateFields.cover_letter ?? null,\r\n      updateFields.status ?? null,\r\n      id\r\n    ]\r\n  );\r\n\r\n  if (updateResult.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  const result = await query(\r\n    'SELECT * FROM proposals WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  res.json({ success: true, data: result.rows[0] });\r\n};\r\n\r\n/**\r\n * DELETE /api/proposals/:id\r\n * Withdraw/delete a proposal\r\n * Protected: Only the freelancer who created it can delete\r\n */\r\nconst deleteProposal = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  // Get the proposal with owner info\r\n  const proposalResult = await query(\r\n    `SELECT p.*, fp.user_id as freelancer_user_id\r\n     FROM proposals p\r\n     JOIN freelancer_profiles fp ON p.freelancer_id = fp.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (proposalResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  const proposal = proposalResult.rows[0];\r\n\r\n  // Check if user is the owner or an admin\r\n  if (proposal.freelancer_user_id !== req.user.userId && req.user.role !== 'admin') {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to delete this proposal'\r\n    });\r\n  }\r\n\r\n  const result = await query('DELETE FROM proposals WHERE id = ?', [id]);\r\n\r\n  if (result.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  res.json({ success: true, message: 'Proposal deleted successfully' });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getProposal(req, res);\r\n  } else if (req.method === 'PATCH') {\r\n    return updateProposal(req, res);\r\n  } else if (req.method === 'DELETE') {\r\n    return deleteProposal(req, res);\r\n  }\r\n};\r\n\r\n// Validation rules for PATCH\r\nconst patchValidations = [\r\n  param('id')\r\n    .isUUID()\r\n    .withMessage('Proposal ID must be a valid UUID'),\r\n  body('bid_amount')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Bid amount must be a positive number'),\r\n  body('hourly_rate')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Hourly rate must be a positive number'),\r\n  body('estimated_hours')\r\n    .optional()\r\n    .isInt({ min: 1 })\r\n    .withMessage('Estimated hours must be a positive integer'),\r\n  body('cover_letter')\r\n    .optional()\r\n    .isLength({ max: 5000 })\r\n    .withMessage('Cover letter must be at most 5000 characters'),\r\n  body('status')\r\n    .optional()\r\n    .isIn(['pending', 'accepted', 'rejected', 'withdrawn'])\r\n    .withMessage('Status must be one of: pending, accepted, rejected, withdrawn')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'PATCH', 'DELETE'],\r\n  middlewares: [\r\n    authenticate,\r\n    (req, res, next) => {\r\n      if (req.method === 'PATCH') {\r\n        // Set req.params for validation\r\n        req.params = { id: req.query.id };\r\n        // Apply validations\r\n        return Promise.all(patchValidations.map(v => v.run(req)))\r\n          .then(() => validate(req, res, next))\r\n          .catch(next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "api\\projects\\[id].js": {
      "content": "const { body, param } = require('express-validator');\r\nconst { query } = require('../../lib/db');\r\nconst { authenticate } = require('../../lib/auth');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * GET /api/projects/:id\r\n * Get project by ID with full details\r\n * Protected: Requires authentication\r\n */\r\nconst getProject = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  const result = await query(\r\n    `SELECT p.*,\r\n            c.company_name,\r\n            c.company_size,\r\n            CONCAT_WS(' ', u.first_name, u.last_name) AS client_name,\r\n            u.country AS client_country\r\n     FROM projects p\r\n     JOIN client_profiles c ON p.client_id = c.id\r\n     JOIN users u ON c.user_id = u.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (result.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Project not found' });\r\n  }\r\n\r\n  const project = result.rows[0];\r\n\r\n  const skillsResult = await query(\r\n    `SELECT s.id, s.name, s.category\r\n     FROM skills s\r\n     JOIN project_skills ps ON s.id = ps.skill_id\r\n     WHERE ps.project_id = ?`,\r\n    [id]\r\n  );\r\n  project.skills = skillsResult.rows;\r\n\r\n  const proposalCount = await query(\r\n    'SELECT COUNT(*) AS count FROM proposals WHERE project_id = ?',\r\n    [id]\r\n  );\r\n  const countRow = proposalCount.rows[0];\r\n  project.proposal_count = countRow ? Number(countRow.count || 0) : 0;\r\n\r\n  res.json({ success: true, data: project });\r\n};\r\n\r\n/**\r\n * PATCH /api/projects/:id\r\n * Update project\r\n * Protected: Only the project owner (client) can update\r\n */\r\nconst updateProject = async (req, res) => {\r\n  const { id } = req.query;\r\n  const { title, description, budget_min, budget_max, status, due_at } = req.body;\r\n\r\n  // Verify ownership - check if the project belongs to the authenticated user's client profile\r\n  const projectOwnerResult = await query(\r\n    `SELECT p.*, c.user_id\r\n     FROM projects p\r\n     JOIN client_profiles c ON p.client_id = c.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (projectOwnerResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Project not found' });\r\n  }\r\n\r\n  const project = projectOwnerResult.rows[0];\r\n\r\n  // Check if user is the owner or an admin\r\n  if (project.user_id !== req.user.userId && req.user.role !== 'admin') {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to update this project'\r\n    });\r\n  }\r\n\r\n  // Convert ISO datetime to MySQL format (YYYY-MM-DD HH:MM:SS)\r\n  let formattedDueAt = null;\r\n  if (due_at) {\r\n    formattedDueAt = new Date(due_at).toISOString().slice(0, 19).replace('T', ' ');\r\n  }\r\n\r\n  const updateResult = await query(\r\n    `UPDATE projects\r\n     SET title = COALESCE(?, title),\r\n         description = COALESCE(?, description),\r\n         budget_min = COALESCE(?, budget_min),\r\n         budget_max = COALESCE(?, budget_max),\r\n         status = COALESCE(?, status),\r\n         due_at = COALESCE(?, due_at)\r\n     WHERE id = ?`,\r\n    [\r\n      title ?? null,\r\n      description ?? null,\r\n      budget_min ?? null,\r\n      budget_max ?? null,\r\n      status ?? null,\r\n      formattedDueAt,\r\n      id\r\n    ]\r\n  );\r\n\r\n  if (updateResult.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'Project not found' });\r\n  }\r\n\r\n  const result = await query(\r\n    'SELECT * FROM projects WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  res.json({ success: true, data: result.rows[0] });\r\n};\r\n\r\n/**\r\n * DELETE /api/projects/:id\r\n * Delete a project\r\n * Protected: Only the project owner (client) or admin can delete\r\n */\r\nconst deleteProject = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  // Verify ownership\r\n  const projectOwnerResult = await query(\r\n    `SELECT p.*, c.user_id\r\n     FROM projects p\r\n     JOIN client_profiles c ON p.client_id = c.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (projectOwnerResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Project not found' });\r\n  }\r\n\r\n  const project = projectOwnerResult.rows[0];\r\n\r\n  // Check if user is the owner or an admin\r\n  if (project.user_id !== req.user.userId && req.user.role !== 'admin') {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to delete this project'\r\n    });\r\n  }\r\n\r\n  const result = await query('DELETE FROM projects WHERE id = ?', [id]);\r\n\r\n  if (result.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'Project not found' });\r\n  }\r\n\r\n  res.json({ success: true, message: 'Project deleted successfully' });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getProject(req, res);\r\n  } else if (req.method === 'PATCH') {\r\n    return updateProject(req, res);\r\n  } else if (req.method === 'DELETE') {\r\n    return deleteProject(req, res);\r\n  }\r\n};\r\n\r\n// Validation rules for PATCH\r\nconst patchValidations = [\r\n  param('id')\r\n    .isUUID()\r\n    .withMessage('Project ID must be a valid UUID'),\r\n  body('title')\r\n    .optional()\r\n    .isLength({ max: 255 })\r\n    .withMessage('Title must be at most 255 characters'),\r\n  body('description')\r\n    .optional()\r\n    .isLength({ max: 5000 })\r\n    .withMessage('Description must be at most 5000 characters'),\r\n  body('budget_min')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Minimum budget must be a positive number'),\r\n  body('budget_max')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Maximum budget must be a positive number'),\r\n  body('status')\r\n    .optional()\r\n    .isIn(['open', 'awarded', 'in_progress', 'completed', 'cancelled'])\r\n    .withMessage('Status must be one of: open, awarded, in_progress, completed, cancelled'),\r\n  body('due_at')\r\n    .optional()\r\n    .isISO8601()\r\n    .withMessage('Due date must be a valid ISO 8601 datetime')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'PATCH', 'DELETE'],\r\n  middlewares: [\r\n    authenticate,\r\n    (req, res, next) => {\r\n      if (req.method === 'PATCH') {\r\n        // Set req.params for validation\r\n        req.params = { id: req.query.id };\r\n        // Apply validations\r\n        return Promise.all(patchValidations.map(v => v.run(req)))\r\n          .then(() => validate(req, res, next))\r\n          .catch(next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "api\\proposals\\index.js": {
      "content": "const { randomUUID } = require('crypto');\r\nconst { body } = require('express-validator');\r\nconst { query } = require('../../lib/db');\r\nconst { authenticate, authorize } = require('../../lib/auth');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\nconst parseIntOrDefault = (value, defaultValue) => {\r\n  const parsed = Number.parseInt(value, 10);\r\n  return Number.isNaN(parsed) ? defaultValue : parsed;\r\n};\r\n\r\n/**\r\n * GET /api/proposals\r\n * Get proposals with filters\r\n * Protected: Requires authentication\r\n */\r\nconst getProposals = async (req, res) => {\r\n  const { project_id, freelancer_id, status, limit = 50, offset = 0 } = req.query;\r\n\r\n  let sql = `\r\n    SELECT p.*,\r\n           proj.title AS project_title,\r\n           CONCAT_WS(' ', u.first_name, u.last_name) AS freelancer_name,\r\n           fp.rating_avg AS freelancer_rating,\r\n           fp.hourly_rate AS freelancer_hourly_rate\r\n    FROM proposals p\r\n    JOIN projects proj ON p.project_id = proj.id\r\n    JOIN freelancer_profiles fp ON p.freelancer_id = fp.id\r\n    JOIN users u ON fp.user_id = u.id\r\n    WHERE 1=1\r\n  `;\r\n\r\n  const params = [];\r\n\r\n  if (project_id) {\r\n    sql += ' AND p.project_id = ?';\r\n    params.push(project_id);\r\n  }\r\n\r\n  if (freelancer_id) {\r\n    sql += ' AND p.freelancer_id = ?';\r\n    params.push(freelancer_id);\r\n  }\r\n\r\n  if (status) {\r\n    sql += ' AND p.status = ?';\r\n    params.push(status);\r\n  }\r\n\r\n  sql += ' ORDER BY p.submitted_at DESC LIMIT ? OFFSET ?';\r\n  params.push(parseIntOrDefault(limit, 50), parseIntOrDefault(offset, 0));\r\n\r\n  const result = await query(sql, params);\r\n\r\n  res.json({\r\n    success: true,\r\n    data: result.rows,\r\n    count: result.rowCount\r\n  });\r\n};\r\n\r\n/**\r\n * POST /api/proposals\r\n * Submit a new proposal\r\n * Protected: Only freelancers can submit proposals\r\n */\r\nconst createProposal = async (req, res) => {\r\n  const {\r\n    project_id,\r\n    bid_amount,\r\n    hourly_rate,\r\n    estimated_hours,\r\n    cover_letter\r\n  } = req.body;\r\n\r\n  if (!project_id) {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'project_id is required'\r\n    });\r\n  }\r\n\r\n  // Get the freelancer profile for the authenticated user\r\n  const freelancerProfileResult = await query(\r\n    'SELECT id FROM freelancer_profiles WHERE user_id = ?',\r\n    [req.user.userId]\r\n  );\r\n\r\n  if (freelancerProfileResult.rows.length === 0) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'Freelancer profile not found. Only freelancers can submit proposals.'\r\n    });\r\n  }\r\n\r\n  const freelancer_id = freelancerProfileResult.rows[0].id;\r\n\r\n  // Validate that the project exists\r\n  const projectCheck = await query(\r\n    'SELECT id FROM projects WHERE id = ?',\r\n    [project_id]\r\n  );\r\n\r\n  if (projectCheck.rows.length === 0) {\r\n    return res.status(404).json({\r\n      success: false,\r\n      message: 'Project not found'\r\n    });\r\n  }\r\n\r\n  // Check if a proposal already exists for this freelancer and project\r\n  const existingProposal = await query(\r\n    'SELECT id FROM proposals WHERE project_id = ? AND freelancer_id = ?',\r\n    [project_id, freelancer_id]\r\n  );\r\n\r\n  if (existingProposal.rows.length > 0) {\r\n    return res.status(409).json({\r\n      success: false,\r\n      message: 'You have already submitted a proposal for this project'\r\n    });\r\n  }\r\n\r\n  const proposalId = randomUUID();\r\n\r\n  try {\r\n    await query(\r\n      `INSERT INTO proposals (id, project_id, freelancer_id, bid_amount, hourly_rate, estimated_hours, cover_letter)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?)`,\r\n      [\r\n        proposalId,\r\n        project_id,\r\n        freelancer_id,\r\n        bid_amount ?? null,\r\n        hourly_rate ?? null,\r\n        estimated_hours ?? null,\r\n        cover_letter ?? null\r\n      ]\r\n    );\r\n\r\n    const result = await query(\r\n      'SELECT * FROM proposals WHERE id = ?',\r\n      [proposalId]\r\n    );\r\n\r\n    res.status(201).json({ success: true, data: result.rows[0] });\r\n  } catch (error) {\r\n    if (error.code === 'ER_DUP_ENTRY') {\r\n      return res.status(409).json({\r\n        success: false,\r\n        message: 'You have already submitted a proposal for this project'\r\n      });\r\n    }\r\n    if (error.code === 'ER_NO_REFERENCED_ROW' || error.code === 'ER_NO_REFERENCED_ROW_2') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Invalid reference: freelancer or project does not exist'\r\n      });\r\n    }\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getProposals(req, res);\r\n  } else if (req.method === 'POST') {\r\n    return createProposal(req, res);\r\n  }\r\n};\r\n\r\n// Validation rules for POST\r\nconst postValidations = [\r\n  body('project_id')\r\n    .notEmpty()\r\n    .withMessage('Project ID is required')\r\n    .isUUID()\r\n    .withMessage('Project ID must be a valid UUID'),\r\n  body('bid_amount')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Bid amount must be a positive number'),\r\n  body('hourly_rate')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Hourly rate must be a positive number'),\r\n  body('estimated_hours')\r\n    .optional()\r\n    .isInt({ min: 1 })\r\n    .withMessage('Estimated hours must be a positive integer'),\r\n  body('cover_letter')\r\n    .notEmpty()\r\n    .withMessage('Cover letter is required')\r\n    .isLength({ max: 5000 })\r\n    .withMessage('Cover letter must be at most 5000 characters')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'POST'],\r\n  middlewares: [\r\n    authenticate,\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        return authorize('freelancer', 'admin')(req, res, next);\r\n      }\r\n      next();\r\n    },\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        // Apply validations\r\n        return Promise.all(postValidations.map(v => v.run(req)))\r\n          .then(() => validate(req, res, next))\r\n          .catch(next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "api\\users\\[id].js": {
      "content": "const { query } = require('../../lib/db');\r\nconst { authenticate, verifyOwnership } = require('../../lib/auth');\r\nconst { apiHandler } = require('../../lib/middleware');\r\nconst { getUserWithProfile } = require('../../lib/authHelpers');\r\n\r\n/**\r\n * GET /api/users/:id\r\n * Get user by ID with profile details\r\n * Protected: Requires authentication\r\n */\r\nconst getUser = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  const user = await getUserWithProfile(id);\r\n\r\n  if (!user) {\r\n    return res.status(404).json({ success: false, message: 'User not found' });\r\n  }\r\n\r\n  res.json({ success: true, data: user });\r\n};\r\n\r\n/**\r\n * PATCH /api/users/:id\r\n * Update user information\r\n * Protected: User can only update their own profile, or admin can update any\r\n */\r\nconst updateUser = async (req, res) => {\r\n  const { id } = req.query;\r\n  const { first_name, last_name, phone, country } = req.body;\r\n\r\n  const updateResult = await query(\r\n    `UPDATE users\r\n     SET first_name = COALESCE(?, first_name),\r\n         last_name = COALESCE(?, last_name),\r\n         phone = COALESCE(?, phone),\r\n         country = COALESCE(?, country),\r\n         updated_at = CURRENT_TIMESTAMP\r\n     WHERE id = ?`,\r\n    [first_name, last_name, phone, country, id]\r\n  );\r\n\r\n  if (updateResult.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'User not found' });\r\n  }\r\n\r\n  // Fetch the updated user\r\n  const result = await query(\r\n    'SELECT id, email, role, first_name, last_name, phone, country, is_verified, updated_at FROM users WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  res.json({ success: true, data: result.rows[0] });\r\n};\r\n\r\n/**\r\n * DELETE /api/users/:id\r\n * Delete a user (cascades to profiles)\r\n * Protected: User can delete own account, or admin can delete any\r\n */\r\nconst deleteUser = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  const result = await query('DELETE FROM users WHERE id = ?', [id]);\r\n\r\n  if (result.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'User not found' });\r\n  }\r\n\r\n  res.json({ success: true, message: 'User deleted successfully' });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  // Add id to params for verifyOwnership middleware\r\n  req.params = { id: req.query.id };\r\n\r\n  if (req.method === 'GET') {\r\n    return getUser(req, res);\r\n  } else if (req.method === 'PATCH') {\r\n    return updateUser(req, res);\r\n  } else if (req.method === 'DELETE') {\r\n    return deleteUser(req, res);\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'PATCH', 'DELETE'],\r\n  middlewares: [\r\n    authenticate,\r\n    // For PATCH and DELETE, verify ownership\r\n    (req, res, next) => {\r\n      req.params = { id: req.query.id };\r\n      if (req.method === 'PATCH' || req.method === 'DELETE') {\r\n        return verifyOwnership()(req, res, next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "api\\projects\\index.js": {
      "content": "const { randomUUID } = require('crypto');\r\nconst { body } = require('express-validator');\r\nconst { query, transaction } = require('../../lib/db');\r\nconst { authenticate, authorize, optionalAuth } = require('../../lib/auth');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\nconst parseIntOrDefault = (value, defaultValue) => {\r\n  const parsed = Number.parseInt(value, 10);\r\n  return Number.isNaN(parsed) ? defaultValue : parsed;\r\n};\r\n\r\n/**\r\n * GET /api/projects\r\n * Get all projects with filters\r\n * Public endpoint but shows different data for authenticated users\r\n */\r\nconst getProjects = async (req, res) => {\r\n  const { status, project_type, min_budget, max_budget, limit = 50, offset = 0 } = req.query;\r\n\r\n  let sql = `\r\n    SELECT p.*,\r\n           c.company_name,\r\n           CONCAT_WS(' ', u.first_name, u.last_name) AS client_name,\r\n           (SELECT COUNT(*) FROM proposals WHERE project_id = p.id) AS proposal_count\r\n    FROM projects p\r\n    JOIN client_profiles c ON p.client_id = c.id\r\n    JOIN users u ON c.user_id = u.id\r\n    WHERE 1=1\r\n  `;\r\n\r\n  const params = [];\r\n\r\n  if (status) {\r\n    sql += ' AND p.status = ?';\r\n    params.push(status);\r\n  }\r\n\r\n  if (project_type) {\r\n    sql += ' AND p.project_type = ?';\r\n    params.push(project_type);\r\n  }\r\n\r\n  if (min_budget) {\r\n    sql += ' AND p.budget_min >= ?';\r\n    params.push(min_budget);\r\n  }\r\n\r\n  if (max_budget) {\r\n    sql += ' AND p.budget_max <= ?';\r\n    params.push(max_budget);\r\n  }\r\n\r\n  sql += ' ORDER BY p.posted_at DESC LIMIT ? OFFSET ?';\r\n  params.push(parseIntOrDefault(limit, 50), parseIntOrDefault(offset, 0));\r\n\r\n  const result = await query(sql, params);\r\n\r\n  for (const project of result.rows) {\r\n    const skillsResult = await query(\r\n      `SELECT s.id, s.name, s.category\r\n       FROM skills s\r\n       JOIN project_skills ps ON s.id = ps.skill_id\r\n       WHERE ps.project_id = ?`,\r\n      [project.id]\r\n    );\r\n    project.skills = skillsResult.rows;\r\n    project.proposal_count = Number(project.proposal_count || 0);\r\n  }\r\n\r\n  res.json({\r\n    success: true,\r\n    data: result.rows,\r\n    count: result.rowCount\r\n  });\r\n};\r\n\r\n/**\r\n * POST /api/projects\r\n * Create a new project\r\n * Protected: Only clients can create projects\r\n */\r\nconst createProject = async (req, res) => {\r\n  const {\r\n    title,\r\n    description,\r\n    project_type,\r\n    budget_min,\r\n    budget_max,\r\n    currency,\r\n    due_at,\r\n    skill_ids = []\r\n  } = req.body;\r\n\r\n  // Get the client profile for the authenticated user\r\n  const clientProfileResult = await query(\r\n    'SELECT id FROM client_profiles WHERE user_id = ?',\r\n    [req.user.userId]\r\n  );\r\n\r\n  if (clientProfileResult.rows.length === 0) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'Client profile not found. Only clients can create projects.'\r\n    });\r\n  }\r\n\r\n  const client_id = clientProfileResult.rows[0].id;\r\n  const projectId = randomUUID();\r\n\r\n  // Convert ISO datetime to MySQL format (YYYY-MM-DD HH:MM:SS)\r\n  let formattedDueAt = null;\r\n  if (due_at) {\r\n    formattedDueAt = new Date(due_at).toISOString().slice(0, 19).replace('T', ' ');\r\n  }\r\n\r\n  await transaction(async (connection) => {\r\n    await connection.query(\r\n      `INSERT INTO projects (id, client_id, title, description, project_type, budget_min, budget_max, currency, due_at)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,\r\n      [\r\n        projectId,\r\n        client_id,\r\n        title,\r\n        description ?? null,\r\n        project_type,\r\n        budget_min ?? null,\r\n        budget_max ?? null,\r\n        currency ?? 'USD',\r\n        formattedDueAt\r\n      ]\r\n    );\r\n\r\n    if (Array.isArray(skill_ids) && skill_ids.length > 0) {\r\n      for (const skillId of skill_ids) {\r\n        await connection.query(\r\n          'INSERT INTO project_skills (project_id, skill_id) VALUES (?, ?)',\r\n          [projectId, skillId]\r\n        );\r\n      }\r\n    }\r\n  });\r\n\r\n  const projectResult = await query(\r\n    `SELECT p.*,\r\n            c.company_name,\r\n            CONCAT_WS(' ', u.first_name, u.last_name) AS client_name,\r\n            (SELECT COUNT(*) FROM proposals WHERE project_id = p.id) AS proposal_count\r\n     FROM projects p\r\n     JOIN client_profiles c ON p.client_id = c.id\r\n     JOIN users u ON c.user_id = u.id\r\n     WHERE p.id = ?`,\r\n    [projectId]\r\n  );\r\n\r\n  if (projectResult.rows.length === 0) {\r\n    return res.status(500).json({ success: false, message: 'Failed to create project' });\r\n  }\r\n\r\n  const project = projectResult.rows[0];\r\n\r\n  const skillsResult = await query(\r\n    `SELECT s.id, s.name, s.category\r\n     FROM skills s\r\n     JOIN project_skills ps ON s.id = ps.skill_id\r\n     WHERE ps.project_id = ?`,\r\n    [projectId]\r\n  );\r\n  project.skills = skillsResult.rows;\r\n  project.proposal_count = Number(project.proposal_count || 0);\r\n\r\n  res.status(201).json({ success: true, data: project });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getProjects(req, res);\r\n  } else if (req.method === 'POST') {\r\n    return createProject(req, res);\r\n  }\r\n};\r\n\r\n// Validation rules for POST\r\nconst postValidations = [\r\n  body('title')\r\n    .notEmpty()\r\n    .withMessage('Title is required')\r\n    .isLength({ max: 255 })\r\n    .withMessage('Title must be at most 255 characters'),\r\n  body('description')\r\n    .optional()\r\n    .isLength({ max: 5000 })\r\n    .withMessage('Description must be at most 5000 characters'),\r\n  body('project_type')\r\n    .notEmpty()\r\n    .withMessage('Project type is required')\r\n    .isIn(['fixed', 'hourly'])\r\n    .withMessage('Project type must be either \"fixed\" or \"hourly\"'),\r\n  body('budget_min')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Minimum budget must be a positive number'),\r\n  body('budget_max')\r\n    .optional()\r\n    .isFloat({ min: 0 })\r\n    .withMessage('Maximum budget must be a positive number'),\r\n  body('currency')\r\n    .optional()\r\n    .isLength({ max: 3 })\r\n    .withMessage('Currency must be a 3-letter code'),\r\n  body('due_at')\r\n    .optional()\r\n    .isISO8601()\r\n    .withMessage('Due date must be a valid ISO 8601 datetime'),\r\n  body('skill_ids')\r\n    .optional()\r\n    .isArray()\r\n    .withMessage('Skill IDs must be an array')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'POST'],\r\n  middlewares: [\r\n    (req, res, next) => {\r\n      if (req.method === 'GET') {\r\n        return optionalAuth(req, res, next);\r\n      }\r\n      next();\r\n    },\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        return authenticate(req, res, next);\r\n      }\r\n      next();\r\n    },\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        return authorize('client', 'admin')(req, res, next);\r\n      }\r\n      next();\r\n    },\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        // Apply validations\r\n        return Promise.all(postValidations.map(v => v.run(req)))\r\n          .then(() => validate(req, res, next))\r\n          .catch(next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "api\\users\\index.js": {
      "content": "const { query, transaction } = require('../../lib/db');\r\nconst { authenticate, authorize } = require('../../lib/auth');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * GET /api/users\r\n * Get all users with optional role filter\r\n * Protected: Requires authentication\r\n */\r\nconst getUsers = async (req, res) => {\r\n  const { role, limit = 50, offset = 0 } = req.query;\r\n\r\n  let sql = 'SELECT id, email, role, first_name, last_name, phone, country, is_verified, created_at FROM users';\r\n  const params = [];\r\n\r\n  if (role) {\r\n    sql += ' WHERE role = ?';\r\n    params.push(role);\r\n    sql += ' ORDER BY created_at DESC LIMIT ? OFFSET ?';\r\n    params.push(parseInt(limit), parseInt(offset));\r\n  } else {\r\n    sql += ' ORDER BY created_at DESC LIMIT ? OFFSET ?';\r\n    params.push(parseInt(limit), parseInt(offset));\r\n  }\r\n\r\n  const result = await query(sql, params);\r\n  res.json({\r\n    success: true,\r\n    data: result.rows,\r\n    count: result.rowCount\r\n  });\r\n};\r\n\r\n/**\r\n * POST /api/users\r\n * Create a new user (with optional profile)\r\n * NOTE: This endpoint is kept for admin use or testing\r\n * Regular users should use /api/auth/register\r\n * Protected: Admin only\r\n */\r\nconst createUser = async (req, res) => {\r\n  const { email, password, role, first_name, last_name, phone, country, profile } = req.body;\r\n\r\n  // Validate required fields\r\n  if (!email || !role) {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'Email and role are required'\r\n    });\r\n  }\r\n\r\n  // Use transaction to create user and profile\r\n  const result = await transaction(async (connection) => {\r\n    // Insert user and return the inserted row\r\n    const userResult = await connection.query(\r\n      `INSERT INTO users (email, password_hash, role, first_name, last_name, phone, country)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?)\r\n       RETURNING id, email, role, first_name, last_name, phone, country, is_verified, created_at`,\r\n      [email, password, role, first_name, last_name, phone, country]\r\n    );\r\n    const user = userResult.rows[0];\r\n\r\n    // Create profile based on role\r\n    if (role === 'freelancer' && profile) {\r\n      await connection.query(\r\n        `INSERT INTO freelancer_profiles (user_id, bio, hourly_rate, experience_years, headline)\r\n         VALUES (?, ?, ?, ?, ?)`,\r\n        [user.id, profile.bio, profile.hourly_rate, profile.experience_years, profile.headline]\r\n      );\r\n      const profileResult = await connection.query(\r\n        'SELECT * FROM freelancer_profiles WHERE user_id = ?',\r\n        [user.id]\r\n      );\r\n      user.profile = profileResult.rows[0];\r\n    } else if (role === 'client' && profile) {\r\n      await connection.query(\r\n        `INSERT INTO client_profiles (user_id, company_name, company_size, website)\r\n         VALUES (?, ?, ?, ?)`,\r\n        [user.id, profile.company_name, profile.company_size, profile.website]\r\n      );\r\n      const profileResult = await connection.query(\r\n        'SELECT * FROM client_profiles WHERE user_id = ?',\r\n        [user.id]\r\n      );\r\n      user.profile = profileResult.rows[0];\r\n    }\r\n\r\n    return user;\r\n  });\r\n\r\n  res.status(201).json({ success: true, data: result });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getUsers(req, res);\r\n  } else if (req.method === 'POST') {\r\n    return createUser(req, res);\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'POST'],\r\n  middlewares: [\r\n    authenticate,\r\n    // For POST, require admin role\r\n    (req, res, next) => {\r\n      if (req.method === 'POST') {\r\n        return authorize('admin')(req, res, next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "package.json": {
      "diff": "Index: package.json\n===================================================================\n--- package.json\n+++ package.json\n@@ -26,9 +26,9 @@\n     \"express-validator\": \"^7.3.0\",\n     \"helmet\": \"^8.1.0\",\n     \"jsonwebtoken\": \"^9.0.2\",\n     \"morgan\": \"^1.10.1\",\n-    \"mysql2\": \"^3.6.0\"\n+    \"pg\": \"^8.13.0\"\n   },\n   \"devDependencies\": {\n     \"nodemon\": \"^3.1.10\"\n   }\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "api\\proposals\\[id]\\reject.js": {
      "content": "const { query } = require('../../../lib/db');\r\nconst { authenticate } = require('../../../lib/auth');\r\nconst { apiHandler } = require('../../../lib/middleware');\r\n\r\n/**\r\n * POST /api/proposals/:id/reject\r\n * Reject a proposal (client only)\r\n * Protected: Only the project owner can reject proposals\r\n */\r\nconst rejectProposal = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  // Get the proposal with ownership info\r\n  const proposalResult = await query(\r\n    `SELECT p.*,\r\n            cp.user_id as client_user_id\r\n     FROM proposals p\r\n     JOIN projects proj ON p.project_id = proj.id\r\n     JOIN client_profiles cp ON proj.client_id = cp.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (proposalResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  const proposal = proposalResult.rows[0];\r\n\r\n  // Check if user is the project owner or admin\r\n  const isProjectOwner = proposal.client_user_id === req.user.userId;\r\n  const isAdmin = req.user.role === 'admin';\r\n\r\n  if (!isProjectOwner && !isAdmin) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'Only the project owner can reject proposals'\r\n    });\r\n  }\r\n\r\n  // Check if proposal is already accepted\r\n  if (proposal.status === 'accepted') {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'Cannot reject an accepted proposal'\r\n    });\r\n  }\r\n\r\n  // Update proposal status to rejected\r\n  await query(\r\n    'UPDATE proposals SET status = ? WHERE id = ?',\r\n    ['rejected', id]\r\n  );\r\n\r\n  const updatedProposal = await query(\r\n    'SELECT * FROM proposals WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  res.json({\r\n    success: true,\r\n    message: 'Proposal rejected successfully',\r\n    data: updatedProposal.rows[0]\r\n  });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'POST') {\r\n    return rejectProposal(req, res);\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST'],\r\n  middlewares: [authenticate]\r\n});\r\n"
    },
    "api\\auth\\register.js": {
      "content": "const bcrypt = require('bcrypt');\r\nconst { body } = require('express-validator');\r\nconst { query, transaction } = require('../../lib/db');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\nconst { generateTokens, saveRefreshToken } = require('../../lib/authHelpers');\r\n\r\n/**\r\n * POST /api/auth/register\r\n * Register a new user\r\n *\r\n * NOTE: Rate limiting in serverless requires external service like Upstash Redis\r\n * For production, consider using @upstash/ratelimit or Vercel's Edge Config\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  const { email, password, role, first_name, last_name, phone, country, profile } = req.body;\r\n\r\n  // Check if user already exists\r\n  const existingUser = await query('SELECT id FROM users WHERE email = ?', [email]);\r\n\r\n  if (existingUser.rows.length > 0) {\r\n    return res.status(409).json({\r\n      success: false,\r\n      message: 'Email already registered. Please login or use a different email.'\r\n    });\r\n  }\r\n\r\n  // Hash password\r\n  const saltRounds = 10;\r\n  const passwordHash = await bcrypt.hash(password, saltRounds);\r\n\r\n  // Create user with profile in transaction\r\n  const result = await transaction(async (connection) => {\r\n    // Generate UUID for the new user\r\n    const uuidResult = await connection.query('SELECT gen_random_uuid() as id');\r\n    const userId = uuidResult.rows[0].id;\r\n\r\n    // Insert user with the generated UUID\r\n    await connection.query(\r\n      `INSERT INTO users (id, email, password_hash, role, first_name, last_name, phone, country)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\r\n      [userId, email, passwordHash, role, first_name, last_name, phone, country]\r\n    );\r\n\r\n    // Get the inserted user\r\n    const userResult = await connection.query(\r\n      'SELECT id, email, role, first_name, last_name, phone, country, is_verified, created_at FROM users WHERE id = ?',\r\n      [userId]\r\n    );\r\n    const user = userResult.rows[0];\r\n\r\n    // Create profile based on role\r\n    if (role === 'freelancer' && profile) {\r\n      await connection.query(\r\n        `INSERT INTO freelancer_profiles (user_id, bio, hourly_rate, experience_years, headline)\r\n         VALUES (?, ?, ?, ?, ?)`,\r\n        [\r\n          user.id,\r\n          profile.bio || null,\r\n          profile.hourly_rate || null,\r\n          profile.experience_years || null,\r\n          profile.headline || null\r\n        ]\r\n      );\r\n\r\n      const profileResult = await connection.query(\r\n        'SELECT * FROM freelancer_profiles WHERE user_id = ?',\r\n        [user.id]\r\n      );\r\n      user.profile = profileResult.rows[0];\r\n    } else if (role === 'client' && profile) {\r\n      await connection.query(\r\n        `INSERT INTO client_profiles (user_id, company_name, company_size, website)\r\n         VALUES (?, ?, ?, ?)`,\r\n        [\r\n          user.id,\r\n          profile.company_name || null,\r\n          profile.company_size || null,\r\n          profile.website || null\r\n        ]\r\n      );\r\n\r\n      const profileResult = await connection.query(\r\n        'SELECT * FROM client_profiles WHERE user_id = ?',\r\n        [user.id]\r\n      );\r\n      user.profile = profileResult.rows[0];\r\n    }\r\n\r\n    return user;\r\n  });\r\n\r\n  // Generate tokens\r\n  const { accessToken, refreshToken } = generateTokens(result);\r\n\r\n  // Save refresh token to database\r\n  await saveRefreshToken(result.id, refreshToken);\r\n\r\n  res.status(201).json({\r\n    success: true,\r\n    message: 'Registration successful',\r\n    data: {\r\n      user: result,\r\n      accessToken,\r\n      refreshToken\r\n    }\r\n  });\r\n};\r\n\r\n// Validation middleware\r\nconst validations = [\r\n  body('email')\r\n    .isEmail()\r\n    .normalizeEmail()\r\n    .withMessage('Please provide a valid email address'),\r\n  body('password')\r\n    .isLength({ min: 8 })\r\n    .withMessage('Password must be at least 8 characters long')\r\n    .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/)\r\n    .withMessage('Password must contain at least one uppercase letter, one lowercase letter, and one number'),\r\n  body('role')\r\n    .isIn(['freelancer', 'client'])\r\n    .withMessage('Role must be either freelancer or client'),\r\n  body('first_name')\r\n    .optional()\r\n    .trim()\r\n    .isLength({ min: 1, max: 100 })\r\n    .withMessage('First name must be between 1 and 100 characters'),\r\n  body('last_name')\r\n    .optional()\r\n    .trim()\r\n    .isLength({ min: 1, max: 100 })\r\n    .withMessage('Last name must be between 1 and 100 characters'),\r\n  body('phone')\r\n    .optional()\r\n    .matches(/^[+]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[0-9]{1,9}$/)\r\n    .withMessage('Please provide a valid phone number'),\r\n  body('country')\r\n    .optional()\r\n    .trim()\r\n    .isLength({ max: 100 })\r\n    .withMessage('Country must not exceed 100 characters')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST'],\r\n  middlewares: [...validations, validate]\r\n});\r\n"
    },
    "api\\proposals\\[id]\\accept.js": {
      "content": "const { randomUUID } = require('crypto');\r\nconst { query, transaction } = require('../../../lib/db');\r\nconst { authenticate } = require('../../../lib/auth');\r\nconst { apiHandler } = require('../../../lib/middleware');\r\n\r\n/**\r\n * POST /api/proposals/:id/accept\r\n * Accept a proposal (client only)\r\n * Protected: Only the project owner can accept proposals\r\n * Business Logic:\r\n * - Sets proposal status to 'accepted'\r\n * - Rejects all other proposals for the same project\r\n * - Updates project status to 'awarded'\r\n * - Creates a contract automatically\r\n */\r\nconst acceptProposal = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  // Get the proposal with full project and ownership info\r\n  const proposalResult = await query(\r\n    `SELECT p.*,\r\n            p.project_id,\r\n            proj.status as project_status,\r\n            cp.user_id as client_user_id\r\n     FROM proposals p\r\n     JOIN projects proj ON p.project_id = proj.id\r\n     JOIN client_profiles cp ON proj.client_id = cp.id\r\n     WHERE p.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (proposalResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Proposal not found' });\r\n  }\r\n\r\n  const proposal = proposalResult.rows[0];\r\n\r\n  // Check if user is the project owner or admin\r\n  const isProjectOwner = proposal.client_user_id === req.user.userId;\r\n  const isAdmin = req.user.role === 'admin';\r\n\r\n  if (!isProjectOwner && !isAdmin) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'Only the project owner can accept proposals'\r\n    });\r\n  }\r\n\r\n  // Check if proposal is already accepted or rejected\r\n  if (proposal.status === 'accepted') {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'This proposal has already been accepted'\r\n    });\r\n  }\r\n\r\n  if (proposal.status === 'rejected') {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'Cannot accept a rejected proposal'\r\n    });\r\n  }\r\n\r\n  // Check if project is in valid state to accept proposals\r\n  if (proposal.project_status !== 'open') {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'Project is not open for accepting proposals'\r\n    });\r\n  }\r\n\r\n  let contractId = null;\r\n\r\n  await transaction(async (connection) => {\r\n    // 1. Accept this proposal\r\n    await connection.query(\r\n      'UPDATE proposals SET status = ? WHERE id = ?',\r\n      ['accepted', id]\r\n    );\r\n\r\n    // 2. Reject all other proposals for this project\r\n    await connection.query(\r\n      `UPDATE proposals\r\n       SET status = 'rejected'\r\n       WHERE project_id = ?\r\n       AND id != ?\r\n       AND status IN ('submitted', 'shortlisted')`,\r\n      [proposal.project_id, id]\r\n    );\r\n\r\n    // 3. Update project status to 'awarded'\r\n    await connection.query(\r\n      'UPDATE projects SET status = ? WHERE id = ?',\r\n      ['awarded', proposal.project_id]\r\n    );\r\n\r\n    // 4. Create a contract automatically\r\n    contractId = randomUUID();\r\n\r\n    // Get project details to determine contract type and client_id\r\n    const projectResult = await connection.query(\r\n      'SELECT project_type, client_id, currency FROM projects WHERE id = ?',\r\n      [proposal.project_id]\r\n    );\r\n\r\n    const project = projectResult.rows[0];\r\n    const contractType = project.project_type; // 'fixed' or 'hourly'\r\n    const agreedAmount = contractType === 'fixed' ? proposal.bid_amount : null;\r\n    const hourlyRate = contractType === 'hourly' ? proposal.hourly_rate : null;\r\n\r\n    await connection.query(\r\n      `INSERT INTO contracts\r\n       (id, project_id, client_id, freelancer_id, contract_type, status, agreed_amount, hourly_rate, currency)\r\n       VALUES (?, ?, ?, ?, ?, 'active', ?, ?, ?)`,\r\n      [\r\n        contractId,\r\n        proposal.project_id,\r\n        project.client_id,\r\n        proposal.freelancer_id,\r\n        contractType,\r\n        agreedAmount,\r\n        hourlyRate,\r\n        project.currency\r\n      ]\r\n    );\r\n  });\r\n\r\n  // Fetch updated proposal\r\n  const updatedProposal = await query(\r\n    'SELECT * FROM proposals WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  // Fetch created contract\r\n  const contractResult = await query(\r\n    'SELECT * FROM contracts WHERE id = ?',\r\n    [contractId]\r\n  );\r\n\r\n  res.json({\r\n    success: true,\r\n    message: 'Proposal accepted successfully and contract created',\r\n    data: {\r\n      proposal: updatedProposal.rows[0],\r\n      contract: contractResult.rows[0]\r\n    }\r\n  });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'POST') {\r\n    return acceptProposal(req, res);\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST'],\r\n  middlewares: [authenticate]\r\n});\r\n"
    },
    "api\\auth\\refresh.js": {
      "content": "const jwt = require('jsonwebtoken');\r\nconst { query } = require('../../lib/db');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * POST /api/auth/refresh\r\n * Refresh access token using refresh token\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  const { refreshToken } = req.body;\r\n\r\n  if (!refreshToken) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Refresh token required'\r\n    });\r\n  }\r\n\r\n  // Verify refresh token\r\n  const decoded = jwt.verify(refreshToken, process.env.JWT_REFRESH_SECRET);\r\n\r\n  if (decoded.type !== 'refresh') {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Invalid token type'\r\n    });\r\n  }\r\n\r\n  // Check if refresh token exists in database and is not revoked\r\n  const tokenResult = await query(\r\n    'SELECT * FROM refresh_tokens WHERE token = ? AND user_id = ? AND revoked = FALSE AND expires_at > NOW()',\r\n    [refreshToken, decoded.userId]\r\n  );\r\n\r\n  if (tokenResult.rows.length === 0) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Invalid or expired refresh token'\r\n    });\r\n  }\r\n\r\n  // Get user\r\n  const userResult = await query(\r\n    'SELECT id, email, role, first_name, last_name FROM users WHERE id = ?',\r\n    [decoded.userId]\r\n  );\r\n\r\n  if (userResult.rows.length === 0) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'User not found'\r\n    });\r\n  }\r\n\r\n  const user = userResult.rows[0];\r\n\r\n  // Generate new access token\r\n  const accessToken = jwt.sign(\r\n    {\r\n      userId: user.id,\r\n      email: user.email,\r\n      role: user.role\r\n    },\r\n    process.env.JWT_SECRET,\r\n    { expiresIn: process.env.JWT_EXPIRES_IN || '15m' }\r\n  );\r\n\r\n  res.json({\r\n    success: true,\r\n    data: {\r\n      accessToken\r\n    }\r\n  });\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST']\r\n});\r\n"
    },
    "api\\auth\\me.js": {
      "content": "const { apiHandler } = require('../../lib/middleware');\r\nconst { authenticate } = require('../../lib/auth');\r\nconst { getUserWithProfile } = require('../../lib/authHelpers');\r\n\r\n/**\r\n * GET /api/auth/me\r\n * Get current user info\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  const user = await getUserWithProfile(req.user.userId);\r\n\r\n  if (!user) {\r\n    return res.status(404).json({\r\n      success: false,\r\n      message: 'User not found'\r\n    });\r\n  }\r\n\r\n  res.json({\r\n    success: true,\r\n    data: user\r\n  });\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET'],\r\n  middlewares: [authenticate]\r\n});\r\n"
    },
    "api\\auth\\logout.js": {
      "content": "const jwt = require('jsonwebtoken');\r\nconst { query } = require('../../lib/db');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * POST /api/auth/logout\r\n * Logout and revoke refresh token\r\n * Note: Does not require authentication to allow logout even with expired tokens\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  const { refreshToken } = req.body;\r\n\r\n  if (refreshToken) {\r\n    // Verify the refresh token to get the user ID\r\n    try {\r\n      const decoded = jwt.verify(refreshToken, process.env.JWT_REFRESH_SECRET);\r\n\r\n      // Revoke the refresh token\r\n      await query(\r\n        'UPDATE refresh_tokens SET revoked = TRUE WHERE token = ? AND user_id = ?',\r\n        [refreshToken, decoded.userId]\r\n      );\r\n    } catch (jwtError) {\r\n      // If token is invalid/expired, still return success\r\n      // The token is unusable anyway\r\n      console.log('Invalid refresh token on logout:', jwtError.message);\r\n    }\r\n  }\r\n\r\n  res.json({\r\n    success: true,\r\n    message: 'Logout successful'\r\n  });\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST']\r\n});\r\n"
    },
    "api\\auth\\logout-all.js": {
      "content": "const { query } = require('../../lib/db');\r\nconst { apiHandler } = require('../../lib/middleware');\r\nconst { authenticate } = require('../../lib/auth');\r\n\r\n/**\r\n * POST /api/auth/logout-all\r\n * Logout from all devices (revoke all refresh tokens)\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  // Revoke all refresh tokens for this user\r\n  await query(\r\n    'UPDATE refresh_tokens SET revoked = TRUE WHERE user_id = ?',\r\n    [req.user.userId]\r\n  );\r\n\r\n  res.json({\r\n    success: true,\r\n    message: 'Logged out from all devices'\r\n  });\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST'],\r\n  middlewares: [authenticate]\r\n});\r\n"
    },
    "api\\auth\\login.js": {
      "content": "const bcrypt = require('bcrypt');\r\nconst { body } = require('express-validator');\r\nconst { query } = require('../../lib/db');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\nconst { generateTokens, saveRefreshToken } = require('../../lib/authHelpers');\r\n\r\n/**\r\n * POST /api/auth/login\r\n * Login with email and password\r\n *\r\n * NOTE: Rate limiting in serverless requires external service like Upstash Redis\r\n */\r\n\r\nconst handler = async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  // Get user with password\r\n  const userResult = await query(\r\n    'SELECT * FROM users WHERE email = ?',\r\n    [email]\r\n  );\r\n\r\n  if (userResult.rows.length === 0) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Invalid email or password'\r\n    });\r\n  }\r\n\r\n  const user = userResult.rows[0];\r\n\r\n  // Verify password\r\n  const isPasswordValid = await bcrypt.compare(password, user.password_hash);\r\n\r\n  if (!isPasswordValid) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Invalid email or password'\r\n    });\r\n  }\r\n\r\n  // Get profile based on role\r\n  if (user.role === 'freelancer') {\r\n    const profileResult = await query(\r\n      'SELECT * FROM freelancer_profiles WHERE user_id = ?',\r\n      [user.id]\r\n    );\r\n    user.profile = profileResult.rows[0] || null;\r\n  } else if (user.role === 'client') {\r\n    const profileResult = await query(\r\n      'SELECT * FROM client_profiles WHERE user_id = ?',\r\n      [user.id]\r\n    );\r\n    user.profile = profileResult.rows[0] || null;\r\n  }\r\n\r\n  // Remove password from response\r\n  delete user.password_hash;\r\n\r\n  // Generate tokens\r\n  const { accessToken, refreshToken } = generateTokens(user);\r\n\r\n  // Save refresh token to database\r\n  await saveRefreshToken(user.id, refreshToken);\r\n\r\n  res.json({\r\n    success: true,\r\n    message: 'Login successful',\r\n    data: {\r\n      user,\r\n      accessToken,\r\n      refreshToken\r\n    }\r\n  });\r\n};\r\n\r\n// Validation middleware\r\nconst validations = [\r\n  body('email')\r\n    .isEmail()\r\n    .normalizeEmail()\r\n    .withMessage('Please provide a valid email address'),\r\n  body('password')\r\n    .notEmpty()\r\n    .withMessage('Password is required')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['POST'],\r\n  middlewares: [...validations, validate]\r\n});\r\n"
    },
    "api\\contracts\\index.js": {
      "content": "const { query } = require('../../lib/db');\r\nconst { authenticate } = require('../../lib/auth');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\nconst parseIntOrDefault = (value, defaultValue) => {\r\n  const parsed = Number.parseInt(value, 10);\r\n  return Number.isNaN(parsed) ? defaultValue : parsed;\r\n};\r\n\r\n/**\r\n * GET /api/contracts\r\n * Get contracts with filters\r\n * Protected: Requires authentication\r\n */\r\nconst getContracts = async (req, res) => {\r\n  const { project_id, client_id, freelancer_id, status, limit = 50, offset = 0 } = req.query;\r\n\r\n  let sql = `\r\n    SELECT c.*,\r\n           proj.title AS project_title,\r\n           CONCAT_WS(' ', uc.first_name, uc.last_name) AS client_name,\r\n           cp.company_name,\r\n           CONCAT_WS(' ', uf.first_name, uf.last_name) AS freelancer_name,\r\n           fp.hourly_rate AS freelancer_hourly_rate\r\n    FROM contracts c\r\n    JOIN projects proj ON c.project_id = proj.id\r\n    JOIN client_profiles cp ON c.client_id = cp.id\r\n    JOIN users uc ON cp.user_id = uc.id\r\n    JOIN freelancer_profiles fp ON c.freelancer_id = fp.id\r\n    JOIN users uf ON fp.user_id = uf.id\r\n    WHERE 1=1\r\n  `;\r\n\r\n  const params = [];\r\n\r\n  if (project_id) {\r\n    sql += ' AND c.project_id = ?';\r\n    params.push(project_id);\r\n  }\r\n\r\n  if (client_id) {\r\n    sql += ' AND c.client_id = ?';\r\n    params.push(client_id);\r\n  }\r\n\r\n  if (freelancer_id) {\r\n    sql += ' AND c.freelancer_id = ?';\r\n    params.push(freelancer_id);\r\n  }\r\n\r\n  if (status) {\r\n    sql += ' AND c.status = ?';\r\n    params.push(status);\r\n  }\r\n\r\n  // Filter by user role\r\n  if (req.user.role === 'client') {\r\n    const clientProfileResult = await query(\r\n      'SELECT id FROM client_profiles WHERE user_id = ?',\r\n      [req.user.userId]\r\n    );\r\n    if (clientProfileResult.rows.length > 0) {\r\n      sql += ' AND c.client_id = ?';\r\n      params.push(clientProfileResult.rows[0].id);\r\n    }\r\n  } else if (req.user.role === 'freelancer') {\r\n    const freelancerProfileResult = await query(\r\n      'SELECT id FROM freelancer_profiles WHERE user_id = ?',\r\n      [req.user.userId]\r\n    );\r\n    if (freelancerProfileResult.rows.length > 0) {\r\n      sql += ' AND c.freelancer_id = ?';\r\n      params.push(freelancerProfileResult.rows[0].id);\r\n    }\r\n  }\r\n\r\n  sql += ' ORDER BY c.start_at DESC LIMIT ? OFFSET ?';\r\n  params.push(parseIntOrDefault(limit, 50), parseIntOrDefault(offset, 0));\r\n\r\n  const result = await query(sql, params);\r\n\r\n  res.json({\r\n    success: true,\r\n    data: result.rows,\r\n    count: result.rowCount\r\n  });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getContracts(req, res);\r\n  }\r\n};\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET'],\r\n  middlewares: [authenticate]\r\n});\r\n"
    },
    "scripts\\maintenance.sh": {
      "content": "#!/bin/bash\r\n\r\n# Maintenance Script\r\n# Cleans up Docker resources and optimizes the system\r\n\r\nset -e\r\n\r\n# Colors\r\nGREEN='\\033[0;32m'\r\nBLUE='\\033[0;34m'\r\nYELLOW='\\033[1;33m'\r\nNC='\\033[0m'\r\n\r\necho -e \"${BLUE}=== System Maintenance ===${NC}\\n\"\r\n\r\n# Stop containers\r\necho -e \"${BLUE}[INFO]${NC} Stopping containers...\"\r\ndocker-compose -f docker-compose.prod.yml down\r\n\r\n# Remove unused Docker images\r\necho -e \"${BLUE}[INFO]${NC} Removing unused Docker images...\"\r\ndocker image prune -af\r\n\r\n# Remove unused volumes (be careful with this!)\r\necho -e \"${YELLOW}[WARNING]${NC} This will remove unused volumes\"\r\nread -p \"Do you want to remove unused volumes? (yes/no): \" CONFIRM\r\nif [ \"$CONFIRM\" = \"yes\" ]; then\r\n    docker volume prune -f\r\n    echo -e \"${GREEN}[SUCCESS]${NC} Unused volumes removed\"\r\nfi\r\n\r\n# Remove unused networks\r\necho -e \"${BLUE}[INFO]${NC} Removing unused networks...\"\r\ndocker network prune -f\r\n\r\n# Clean up old logs (keep last 30 days)\r\necho -e \"${BLUE}[INFO]${NC} Cleaning up old log files...\"\r\nfind ./logs -name \"*.log\" -type f -mtime +30 -delete 2>/dev/null || true\r\n\r\n# Clean up old backups (keep last 30 days)\r\necho -e \"${BLUE}[INFO]${NC} Cleaning up old backup files...\"\r\nfind ./backups -name \"backup_*.sql.gz\" -type f -mtime +30 -delete 2>/dev/null || true\r\n\r\n# Check disk space\r\necho -e \"\\n${BLUE}[INFO]${NC} Current disk usage:\"\r\ndf -h | grep -E '^/dev/'\r\n\r\n# Show Docker disk usage\r\necho -e \"\\n${BLUE}[INFO]${NC} Docker disk usage:\"\r\ndocker system df\r\n\r\n# Restart containers\r\necho -e \"\\n${BLUE}[INFO]${NC} Starting containers...\"\r\ndocker-compose -f docker-compose.prod.yml up -d\r\n\r\necho -e \"\\n${GREEN}[SUCCESS]${NC} Maintenance completed!\"\r\n"
    },
    "scripts\\logs.sh": {
      "content": "#!/bin/bash\r\n\r\n# Logs Viewer Script\r\n# Easy access to container logs\r\n\r\n# Colors\r\nBLUE='\\033[0;34m'\r\nNC='\\033[0m'\r\n\r\nSERVICE=$1\r\n\r\nif [ -z \"$SERVICE\" ]; then\r\n    echo -e \"${BLUE}Usage:${NC} $0 [service] [options]\"\r\n    echo \"\"\r\n    echo \"Services: app, mysql, nginx, client, certbot\"\r\n    echo \"\"\r\n    echo \"Examples:\"\r\n    echo \"  $0 app              # Show all app logs\"\r\n    echo \"  $0 app -f           # Follow app logs\"\r\n    echo \"  $0 app --tail 100   # Show last 100 lines\"\r\n    echo \"  $0 nginx -f         # Follow nginx logs\"\r\n    echo \"\"\r\n    echo \"Show all services:\"\r\n    echo \"  $0 all -f\"\r\n    exit 1\r\nfi\r\n\r\nif [ \"$SERVICE\" = \"all\" ]; then\r\n    docker-compose -f docker-compose.prod.yml logs ${@:2}\r\nelse\r\n    docker-compose -f docker-compose.prod.yml logs $SERVICE ${@:2}\r\nfi\r\n"
    },
    "scripts\\health-check.sh": {
      "content": "#!/bin/bash\r\n\r\n# Health Check Script - Check if all services are running properly\r\n\r\n# Colors\r\nGREEN='\\033[0;32m'\r\nRED='\\033[0;31m'\r\nYELLOW='\\033[1;33m'\r\nBLUE='\\033[0;34m'\r\nNC='\\033[0m'\r\n\r\necho -e \"${BLUE}=== Service Health Check ===${NC}\\n\"\r\n\r\n# Check Docker containers status\r\necho -e \"${BLUE}[INFO]${NC} Checking container status...\"\r\ndocker-compose -f docker-compose.prod.yml ps\r\necho \"\"\r\n\r\n# Check MySQL\r\necho -e \"${BLUE}[INFO]${NC} Checking MySQL database...\"\r\nif docker-compose -f docker-compose.prod.yml exec -T mysql mysqladmin ping -h localhost --silent; then\r\n    echo -e \"${GREEN}✓${NC} MySQL is running\"\r\nelse\r\n    echo -e \"${RED}✗${NC} MySQL is not responding\"\r\nfi\r\n\r\n# Check API\r\necho -e \"${BLUE}[INFO]${NC} Checking API server...\"\r\nif curl -f -s http://localhost:3000/health > /dev/null; then\r\n    echo -e \"${GREEN}✓${NC} API server is running\"\r\nelse\r\n    echo -e \"${RED}✗${NC} API server is not responding\"\r\nfi\r\n\r\n# Check Nginx\r\necho -e \"${BLUE}[INFO]${NC} Checking Nginx...\"\r\nif curl -f -s http://localhost/health > /dev/null; then\r\n    echo -e \"${GREEN}✓${NC} Nginx is running\"\r\nelse\r\n    echo -e \"${RED}✗${NC} Nginx is not responding\"\r\nfi\r\n\r\n# Check SSL certificate expiration (if exists)\r\nif [ -f \"certbot/conf/live/$(grep DOMAIN .env.production | cut -d '=' -f2)/fullchain.pem\" ]; then\r\n    DOMAIN=$(grep DOMAIN .env.production | cut -d '=' -f2)\r\n    echo -e \"\\n${BLUE}[INFO]${NC} Checking SSL certificate...\"\r\n    EXPIRY=$(openssl x509 -enddate -noout -in \"certbot/conf/live/$DOMAIN/fullchain.pem\" | cut -d= -f2)\r\n    echo -e \"${GREEN}✓${NC} SSL certificate expires: $EXPIRY\"\r\nfi\r\n\r\n# Check disk space\r\necho -e \"\\n${BLUE}[INFO]${NC} Checking disk space...\"\r\ndf -h | grep -E '^/dev/' | awk '{print $5 \" used on \" $6}' | while read line; do\r\n    usage=$(echo $line | cut -d% -f1)\r\n    if [ $usage -gt 80 ]; then\r\n        echo -e \"${RED}✗${NC} High disk usage: $line\"\r\n    else\r\n        echo -e \"${GREEN}✓${NC} Disk usage: $line\"\r\n    fi\r\ndone\r\n\r\n# Check memory usage\r\necho -e \"\\n${BLUE}[INFO]${NC} Checking memory usage...\"\r\nfree -h | grep Mem | awk '{print \"Total: \" $2 \", Used: \" $3 \", Available: \" $7}'\r\n\r\n# Show recent logs\r\necho -e \"\\n${BLUE}[INFO]${NC} Recent error logs (last 10 lines)...\"\r\ndocker-compose -f docker-compose.prod.yml logs --tail=10 --no-color 2>&1 | grep -i error || echo \"No recent errors found\"\r\n\r\necho -e \"\\n${GREEN}Health check completed!${NC}\"\r\n"
    },
    "scripts\\backup.sh": {
      "content": "#!/bin/bash\r\n\r\n# Database Backup Script\r\n# Creates a backup of the MySQL database with timestamp\r\n\r\nset -e\r\n\r\n# Colors\r\nGREEN='\\033[0;32m'\r\nBLUE='\\033[0;34m'\r\nRED='\\033[0;31m'\r\nNC='\\033[0m'\r\n\r\n# Load environment variables\r\nif [ -f .env.production ]; then\r\n    export $(grep -v '^#' .env.production | xargs)\r\nelse\r\n    echo -e \"${RED}[ERROR]${NC} .env.production file not found!\"\r\n    exit 1\r\nfi\r\n\r\n# Configuration\r\nBACKUP_DIR=\"./backups\"\r\nDATE=$(date +%Y%m%d_%H%M%S)\r\nBACKUP_FILE=\"$BACKUP_DIR/backup_${DB_NAME}_${DATE}.sql\"\r\nDAYS_TO_KEEP=7\r\n\r\n# Create backup directory if it doesn't exist\r\nmkdir -p $BACKUP_DIR\r\n\r\necho -e \"${BLUE}[INFO]${NC} Starting database backup...\"\r\n\r\n# Create backup\r\ndocker-compose -f docker-compose.prod.yml exec -T mysql mysqldump \\\r\n    -u root \\\r\n    -p${DB_ROOT_PASSWORD} \\\r\n    --single-transaction \\\r\n    --routines \\\r\n    --triggers \\\r\n    --events \\\r\n    ${DB_NAME} > ${BACKUP_FILE}\r\n\r\n# Compress backup\r\necho -e \"${BLUE}[INFO]${NC} Compressing backup...\"\r\ngzip ${BACKUP_FILE}\r\nBACKUP_FILE=\"${BACKUP_FILE}.gz\"\r\n\r\n# Calculate size\r\nSIZE=$(du -h ${BACKUP_FILE} | cut -f1)\r\n\r\necho -e \"${GREEN}[SUCCESS]${NC} Backup created: ${BACKUP_FILE} (${SIZE})\"\r\n\r\n# Delete old backups\r\necho -e \"${BLUE}[INFO]${NC} Cleaning up old backups (keeping last ${DAYS_TO_KEEP} days)...\"\r\nfind ${BACKUP_DIR} -name \"backup_*.sql.gz\" -type f -mtime +${DAYS_TO_KEEP} -delete\r\n\r\n# Count remaining backups\r\nBACKUP_COUNT=$(ls -1 ${BACKUP_DIR}/backup_*.sql.gz 2>/dev/null | wc -l)\r\necho -e \"${GREEN}[SUCCESS]${NC} Total backups: ${BACKUP_COUNT}\"\r\n"
    },
    "api\\contracts\\[id].js": {
      "content": "const { body, param } = require('express-validator');\r\nconst { query } = require('../../lib/db');\r\nconst { authenticate } = require('../../lib/auth');\r\nconst { validate } = require('../../lib/validate');\r\nconst { apiHandler } = require('../../lib/middleware');\r\n\r\n/**\r\n * GET /api/contracts/:id\r\n * Get contract by ID with full details\r\n * Protected: Requires authentication\r\n */\r\nconst getContract = async (req, res) => {\r\n  const { id } = req.query;\r\n\r\n  const result = await query(\r\n    `SELECT c.*,\r\n            proj.title AS project_title,\r\n            proj.description AS project_description,\r\n            proj.project_type,\r\n            CONCAT_WS(' ', uc.first_name, uc.last_name) AS client_name,\r\n            uc.email AS client_email,\r\n            cp.company_name,\r\n            CONCAT_WS(' ', uf.first_name, uf.last_name) AS freelancer_name,\r\n            uf.email AS freelancer_email,\r\n            fp.bio AS freelancer_bio,\r\n            fp.rating_avg AS freelancer_rating\r\n     FROM contracts c\r\n     JOIN projects proj ON c.project_id = proj.id\r\n     JOIN client_profiles cp ON c.client_id = cp.id\r\n     JOIN users uc ON cp.user_id = uc.id\r\n     JOIN freelancer_profiles fp ON c.freelancer_id = fp.id\r\n     JOIN users uf ON fp.user_id = uf.id\r\n     WHERE c.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (result.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Contract not found' });\r\n  }\r\n\r\n  const contract = result.rows[0];\r\n\r\n  // Check if user has access to this contract\r\n  const clientProfileResult = await query(\r\n    'SELECT id FROM client_profiles WHERE user_id = ?',\r\n    [req.user.userId]\r\n  );\r\n  const freelancerProfileResult = await query(\r\n    'SELECT id FROM freelancer_profiles WHERE user_id = ?',\r\n    [req.user.userId]\r\n  );\r\n\r\n  const isClient = clientProfileResult.rows.length > 0 &&\r\n                   clientProfileResult.rows[0].id === contract.client_id;\r\n  const isFreelancer = freelancerProfileResult.rows.length > 0 &&\r\n                       freelancerProfileResult.rows[0].id === contract.freelancer_id;\r\n  const isAdmin = req.user.role === 'admin';\r\n\r\n  if (!isClient && !isFreelancer && !isAdmin) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to view this contract'\r\n    });\r\n  }\r\n\r\n  // Get milestones for this contract\r\n  const milestonesResult = await query(\r\n    'SELECT * FROM milestones WHERE contract_id = ? ORDER BY due_at ASC',\r\n    [id]\r\n  );\r\n\r\n  res.json({\r\n    success: true,\r\n    data: {\r\n      ...contract,\r\n      milestones: milestonesResult.rows\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * PATCH /api/contracts/:id\r\n * Update contract (e.g., change status, end date)\r\n * Protected: Only client or freelancer in the contract can update\r\n */\r\nconst updateContract = async (req, res) => {\r\n  const { id } = req.query;\r\n  const { status, end_at } = req.body;\r\n\r\n  // Get the contract with owner info\r\n  const contractResult = await query(\r\n    `SELECT c.*, cp.user_id as client_user_id, fp.user_id as freelancer_user_id\r\n     FROM contracts c\r\n     JOIN client_profiles cp ON c.client_id = cp.id\r\n     JOIN freelancer_profiles fp ON c.freelancer_id = fp.id\r\n     WHERE c.id = ?`,\r\n    [id]\r\n  );\r\n\r\n  if (contractResult.rows.length === 0) {\r\n    return res.status(404).json({ success: false, message: 'Contract not found' });\r\n  }\r\n\r\n  const contract = contractResult.rows[0];\r\n\r\n  // Check permissions\r\n  const isClient = contract.client_user_id === req.user.userId;\r\n  const isFreelancer = contract.freelancer_user_id === req.user.userId;\r\n  const isAdmin = req.user.role === 'admin';\r\n\r\n  if (!isClient && !isFreelancer && !isAdmin) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'You do not have permission to update this contract'\r\n    });\r\n  }\r\n\r\n  // Convert ISO datetime to MySQL format (YYYY-MM-DD HH:MM:SS)\r\n  let formattedEndAt = null;\r\n  if (end_at) {\r\n    formattedEndAt = new Date(end_at).toISOString().slice(0, 19).replace('T', ' ');\r\n  }\r\n\r\n  const updateResult = await query(\r\n    `UPDATE contracts\r\n     SET status = COALESCE(?, status),\r\n         end_at = COALESCE(?, end_at)\r\n     WHERE id = ?`,\r\n    [status ?? null, formattedEndAt, id]\r\n  );\r\n\r\n  if (updateResult.rowCount === 0) {\r\n    return res.status(404).json({ success: false, message: 'Contract not found' });\r\n  }\r\n\r\n  const result = await query(\r\n    'SELECT * FROM contracts WHERE id = ?',\r\n    [id]\r\n  );\r\n\r\n  res.json({ success: true, data: result.rows[0] });\r\n};\r\n\r\nconst handler = async (req, res) => {\r\n  if (req.method === 'GET') {\r\n    return getContract(req, res);\r\n  } else if (req.method === 'PATCH') {\r\n    return updateContract(req, res);\r\n  }\r\n};\r\n\r\n// Validation rules for PATCH\r\nconst patchValidations = [\r\n  param('id')\r\n    .isUUID()\r\n    .withMessage('Contract ID must be a valid UUID'),\r\n  body('status')\r\n    .optional()\r\n    .isIn(['active', 'completed', 'cancelled', 'disputed'])\r\n    .withMessage('Status must be one of: active, completed, cancelled, disputed'),\r\n  body('end_at')\r\n    .optional()\r\n    .isISO8601()\r\n    .withMessage('End date must be a valid ISO 8601 datetime')\r\n];\r\n\r\nmodule.exports = apiHandler(handler, {\r\n  methods: ['GET', 'PATCH'],\r\n  middlewares: [\r\n    authenticate,\r\n    (req, res, next) => {\r\n      if (req.method === 'PATCH') {\r\n        // Set req.params for validation\r\n        req.params = { id: req.query.id };\r\n        // Apply validations\r\n        return Promise.all(patchValidations.map(v => v.run(req)))\r\n          .then(() => validate(req, res, next))\r\n          .catch(next);\r\n      }\r\n      next();\r\n    }\r\n  ]\r\n});\r\n"
    },
    "docker-compose.prod.yml": {
      "content": "version: '3.8'\r\n\r\nservices:\r\n  # PostgreSQL Database\r\n  postgres:\r\n    image: postgres:16\r\n    container_name: freelance_postgres_prod\r\n    restart: always\r\n    environment:\r\n      POSTGRES_USER: ${DB_USER}\r\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\r\n      POSTGRES_DB: ${DB_NAME}\r\n    volumes:\r\n      - postgres_data:/var/lib/postgresql/data\r\n      - ./src/db/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql\r\n      - ./backups:/backups\r\n    networks:\r\n      - freelance_network\r\n    healthcheck:\r\n      test: [\"CMD-SHELL\", \"pg_isready -U ${DB_USER}\"]\r\n      timeout: 20s\r\n      retries: 10\r\n      interval: 30s\r\n    command: -c max_connections=200 -c shared_buffers=256MB\r\n    deploy:\r\n      resources:\r\n        limits:\r\n          memory: 1G\r\n        reservations:\r\n          memory: 512M\r\n\r\n  # Node.js Application\r\n  app:\r\n    build:\r\n      context: .\r\n      dockerfile: Dockerfile.prod\r\n      args:\r\n        NODE_ENV: production\r\n    container_name: freelance_app_prod\r\n    restart: always\r\n    environment:\r\n      NODE_ENV: production\r\n      PORT: 3000\r\n      DB_USER: ${DB_USER}\r\n      DB_HOST: postgres\r\n      DB_NAME: ${DB_NAME}\r\n      DB_PASSWORD: ${DB_PASSWORD}\r\n      DB_PORT: 5432\r\n      JWT_SECRET: ${JWT_SECRET}\r\n      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}\r\n      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-15m}\r\n      JWT_REFRESH_EXPIRES_IN: ${JWT_REFRESH_EXPIRES_IN:-7d}\r\n      CLIENT_URL: ${CLIENT_URL}\r\n    depends_on:\r\n      postgres:\r\n        condition: service_healthy\r\n    networks:\r\n      - freelance_network\r\n    healthcheck:\r\n      test: [\"CMD\", \"wget\", \"--quiet\", \"--tries=1\", \"--spider\", \"http://localhost:3000/health\"]\r\n      interval: 30s\r\n      timeout: 10s\r\n      retries: 3\r\n      start_period: 40s\r\n    deploy:\r\n      resources:\r\n        limits:\r\n          memory: 512M\r\n        reservations:\r\n          memory: 256M\r\n\r\n  # React Client Application\r\n  client:\r\n    build:\r\n      context: ./client\r\n      dockerfile: Dockerfile.prod\r\n      args:\r\n        VITE_API_URL: ${VITE_API_URL}\r\n    container_name: freelance_client_prod\r\n    restart: always\r\n    networks:\r\n      - freelance_network\r\n    deploy:\r\n      resources:\r\n        limits:\r\n          memory: 256M\r\n        reservations:\r\n          memory: 128M\r\n\r\n  # Nginx Reverse Proxy\r\n  nginx:\r\n    image: nginx:alpine\r\n    container_name: freelance_nginx\r\n    restart: always\r\n    ports:\r\n      - \"80:80\"\r\n      - \"443:443\"\r\n    volumes:\r\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\r\n      - ./nginx/conf.d:/etc/nginx/conf.d:ro\r\n      - ./certbot/conf:/etc/letsencrypt:ro\r\n      - ./certbot/www:/var/www/certbot:ro\r\n      - ./client/dist:/usr/share/nginx/html:ro\r\n    depends_on:\r\n      - app\r\n      - client\r\n    networks:\r\n      - freelance_network\r\n    healthcheck:\r\n      test: [\"CMD\", \"wget\", \"--quiet\", \"--tries=1\", \"--spider\", \"http://localhost/health\"]\r\n      interval: 30s\r\n      timeout: 10s\r\n      retries: 3\r\n\r\n  # Certbot for SSL certificates\r\n  certbot:\r\n    image: certbot/certbot\r\n    container_name: freelance_certbot\r\n    volumes:\r\n      - ./certbot/conf:/etc/letsencrypt\r\n      - ./certbot/www:/var/www/certbot\r\n    entrypoint: \"/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'\"\r\n    networks:\r\n      - freelance_network\r\n\r\nvolumes:\r\n  postgres_data:\r\n    driver: local\r\n\r\nnetworks:\r\n  freelance_network:\r\n    driver: bridge\r\n"
    },
    "scripts\\make-executable.sh": {
      "content": "#!/bin/bash\r\n\r\n# Make all scripts executable\r\n# Run this if you clone the repo and scripts aren't executable\r\n\r\necho \"Making scripts executable...\"\r\nchmod +x deploy.sh\r\nchmod +x scripts/*.sh\r\n\r\necho \"Done! All scripts are now executable.\"\r\n"
    },
    "scripts\\restore.sh": {
      "content": "#!/bin/bash\r\n\r\n# Database Restore Script\r\n# Restores MySQL database from a backup file\r\n\r\nset -e\r\n\r\n# Colors\r\nGREEN='\\033[0;32m'\r\nBLUE='\\033[0;34m'\r\nRED='\\033[0;31m'\r\nYELLOW='\\033[1;33m'\r\nNC='\\033[0m'\r\n\r\n# Load environment variables\r\nif [ -f .env.production ]; then\r\n    export $(grep -v '^#' .env.production | xargs)\r\nelse\r\n    echo -e \"${RED}[ERROR]${NC} .env.production file not found!\"\r\n    exit 1\r\nfi\r\n\r\nBACKUP_DIR=\"./backups\"\r\n\r\n# List available backups\r\necho -e \"${BLUE}Available backups:${NC}\"\r\nls -lh ${BACKUP_DIR}/backup_*.sql.gz 2>/dev/null || {\r\n    echo -e \"${RED}[ERROR]${NC} No backup files found in ${BACKUP_DIR}\"\r\n    exit 1\r\n}\r\n\r\necho \"\"\r\nread -p \"Enter the backup filename to restore (e.g., backup_freelance_platform_20240101_120000.sql.gz): \" BACKUP_FILE\r\n\r\nBACKUP_PATH=\"${BACKUP_DIR}/${BACKUP_FILE}\"\r\n\r\nif [ ! -f \"${BACKUP_PATH}\" ]; then\r\n    echo -e \"${RED}[ERROR]${NC} Backup file not found: ${BACKUP_PATH}\"\r\n    exit 1\r\nfi\r\n\r\necho -e \"${YELLOW}[WARNING]${NC} This will overwrite the current database!\"\r\nread -p \"Are you sure you want to continue? (yes/no): \" CONFIRM\r\n\r\nif [ \"$CONFIRM\" != \"yes\" ]; then\r\n    echo -e \"${BLUE}[INFO]${NC} Restore cancelled\"\r\n    exit 0\r\nfi\r\n\r\n# Create a safety backup before restore\r\necho -e \"${BLUE}[INFO]${NC} Creating safety backup of current database...\"\r\nSAFETY_BACKUP=\"${BACKUP_DIR}/safety_backup_$(date +%Y%m%d_%H%M%S).sql\"\r\ndocker-compose -f docker-compose.prod.yml exec -T mysql mysqldump \\\r\n    -u root \\\r\n    -p${DB_ROOT_PASSWORD} \\\r\n    --single-transaction \\\r\n    ${DB_NAME} > ${SAFETY_BACKUP}\r\ngzip ${SAFETY_BACKUP}\r\necho -e \"${GREEN}[SUCCESS]${NC} Safety backup created: ${SAFETY_BACKUP}.gz\"\r\n\r\n# Decompress and restore\r\necho -e \"${BLUE}[INFO]${NC} Restoring database from ${BACKUP_FILE}...\"\r\ngunzip -c ${BACKUP_PATH} | docker-compose -f docker-compose.prod.yml exec -T mysql mysql \\\r\n    -u root \\\r\n    -p${DB_ROOT_PASSWORD} \\\r\n    ${DB_NAME}\r\n\r\necho -e \"${GREEN}[SUCCESS]${NC} Database restored successfully!\"\r\necho -e \"${BLUE}[INFO]${NC} Safety backup kept at: ${SAFETY_BACKUP}.gz\"\r\n"
    },
    "nginx\\nginx.conf": {
      "content": "user nginx;\r\nworker_processes auto;\r\nerror_log /var/log/nginx/error.log warn;\r\npid /var/run/nginx.pid;\r\n\r\nevents {\r\n    worker_connections 2048;\r\n    use epoll;\r\n}\r\n\r\nhttp {\r\n    include /etc/nginx/mime.types;\r\n    default_type application/octet-stream;\r\n\r\n    log_format main '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n                    '$status $body_bytes_sent \"$http_referer\" '\r\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n\r\n    access_log /var/log/nginx/access.log main;\r\n\r\n    sendfile on;\r\n    tcp_nopush on;\r\n    tcp_nodelay on;\r\n    keepalive_timeout 65;\r\n    types_hash_max_size 2048;\r\n    client_max_body_size 20M;\r\n\r\n    # Gzip Settings\r\n    gzip on;\r\n    gzip_vary on;\r\n    gzip_proxied any;\r\n    gzip_comp_level 6;\r\n    gzip_types text/plain text/css text/xml text/javascript\r\n               application/json application/javascript application/xml+rss\r\n               application/rss+xml font/truetype font/opentype\r\n               application/vnd.ms-fontobject image/svg+xml;\r\n\r\n    # Security Headers\r\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\r\n    add_header X-Content-Type-Options \"nosniff\" always;\r\n    add_header X-XSS-Protection \"1; mode=block\" always;\r\n    add_header Referrer-Policy \"no-referrer-when-downgrade\" always;\r\n\r\n    # Rate Limiting\r\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/m;\r\n    limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=10r/m;\r\n\r\n    # Include all server configurations\r\n    include /etc/nginx/conf.d/*.conf;\r\n}\r\n"
    },
    "lib\\db.js": {
      "content": "const { Pool } = require('pg');\r\n\r\n/**\r\n * Serverless-compatible PostgreSQL connection\r\n * Uses singleton pattern to reuse connection pool across function invocations\r\n */\r\n\r\nlet pool;\r\n\r\n/**\r\n * Get or create a PostgreSQL connection pool optimized for serverless\r\n */\r\nconst getPool = () => {\r\n  if (!pool) {\r\n    pool = new Pool({\r\n      connectionString: process.env.POSTGRES_URL || process.env.DATABASE_URL,\r\n      // Serverless-optimized settings\r\n      max: 1, // Limit connections in serverless environment\r\n      idleTimeoutMillis: 10000, // Close idle connections quickly\r\n      connectionTimeoutMillis: 3000,\r\n      // For development fallback\r\n      ...(process.env.DB_HOST && {\r\n        host: process.env.DB_HOST,\r\n        user: process.env.DB_USER,\r\n        password: process.env.DB_PASSWORD,\r\n        database: process.env.DB_NAME,\r\n        port: parseInt(process.env.DB_PORT || '5432'),\r\n      }),\r\n    });\r\n\r\n    // Handle pool errors\r\n    pool.on('error', (err) => {\r\n      console.error('Unexpected error on PostgreSQL pool', err);\r\n      pool = null; // Reset pool on error\r\n    });\r\n  }\r\n\r\n  return pool;\r\n};\r\n\r\n/**\r\n * Convert MySQL-style ? placeholders to PostgreSQL-style $1, $2, $3\r\n * @param {string} text - SQL query with ? placeholders\r\n * @returns {string} - SQL query with $n placeholders\r\n */\r\nconst convertPlaceholders = (text) => {\r\n  let index = 0;\r\n  return text.replace(/\\?/g, () => `$${++index}`);\r\n};\r\n\r\n/**\r\n * Execute a raw SQL query\r\n * @param {string} text - The SQL query (can use ? or $1, $2, etc.)\r\n * @param {Array} params - Query parameters\r\n * @returns {Promise<object>} - Query result with rows and metadata\r\n */\r\nconst query = async (text, params = []) => {\r\n  const start = Date.now();\r\n  const pool = getPool();\r\n\r\n  try {\r\n    // Convert MySQL-style ? to PostgreSQL-style $1, $2, $3\r\n    const pgQuery = convertPlaceholders(text);\r\n    const result = await pool.query(pgQuery, params);\r\n    const duration = Date.now() - start;\r\n\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      console.log('Executed query', { text: pgQuery, duration, rows: result.rowCount });\r\n    }\r\n\r\n    return { rows: result.rows, fields: result.fields, rowCount: result.rowCount };\r\n  } catch (error) {\r\n    console.error('Database query error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Get a client from the pool for transactions\r\n * @returns {Promise<object>} - Database client\r\n */\r\nconst getClient = async () => {\r\n  const pool = getPool();\r\n  const client = await pool.connect();\r\n\r\n  const originalRelease = client.release.bind(client);\r\n  const originalQuery = client.query.bind(client);\r\n\r\n  // Wrap query to return consistent format\r\n  const wrappedQuery = async (text, params = []) => {\r\n    const pgQuery = convertPlaceholders(text);\r\n    const result = await originalQuery(pgQuery, params);\r\n    return { rows: result.rows, fields: result.fields, rowCount: result.rowCount };\r\n  };\r\n\r\n  // Override query method\r\n  client.query = wrappedQuery;\r\n  client.release = originalRelease;\r\n\r\n  return client;\r\n};\r\n\r\n/**\r\n * Execute queries in a transaction\r\n * @param {Function} callback - Async function that receives client\r\n * @returns {Promise<any>} - Result of the callback\r\n */\r\nconst transaction = async (callback) => {\r\n  const client = await getClient();\r\n  try {\r\n    await client.query('BEGIN', []);\r\n    const result = await callback(client);\r\n    await client.query('COMMIT', []);\r\n    return result;\r\n  } catch (error) {\r\n    await client.query('ROLLBACK', []);\r\n    throw error;\r\n  } finally {\r\n    client.release();\r\n  }\r\n};\r\n\r\n/**\r\n * Close the pool (useful for graceful shutdown, not typically needed in serverless)\r\n */\r\nconst closePool = async () => {\r\n  if (pool) {\r\n    await pool.end();\r\n    pool = null;\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  query,\r\n  getClient,\r\n  transaction,\r\n  closePool,\r\n};\r\n"
    },
    "lib\\authHelpers.js": {
      "content": "const jwt = require('jsonwebtoken');\r\nconst { query } = require('./db');\r\n\r\n/**\r\n * Helper function to generate JWT tokens\r\n */\r\nconst generateTokens = (user) => {\r\n  const accessToken = jwt.sign(\r\n    {\r\n      userId: user.id,\r\n      email: user.email,\r\n      role: user.role\r\n    },\r\n    process.env.JWT_SECRET,\r\n    { expiresIn: process.env.JWT_EXPIRES_IN || '15m' }\r\n  );\r\n\r\n  const refreshToken = jwt.sign(\r\n    {\r\n      userId: user.id,\r\n      type: 'refresh'\r\n    },\r\n    process.env.JWT_REFRESH_SECRET,\r\n    { expiresIn: process.env.JWT_REFRESH_EXPIRES_IN || '7d' }\r\n  );\r\n\r\n  return { accessToken, refreshToken };\r\n};\r\n\r\n/**\r\n * Helper function to save refresh token to database\r\n */\r\nconst saveRefreshToken = async (userId, token) => {\r\n  const expiresAt = new Date();\r\n  expiresAt.setDate(expiresAt.getDate() + 7); // 7 days from now\r\n\r\n  await query(\r\n    'INSERT INTO refresh_tokens (user_id, token, expires_at) VALUES (?, ?, ?)',\r\n    [userId, token, expiresAt.toISOString()]\r\n  );\r\n};\r\n\r\n/**\r\n * Helper function to get user with profile\r\n */\r\nconst getUserWithProfile = async (userId) => {\r\n  const userResult = await query(\r\n    'SELECT id, email, role, first_name, last_name, phone, country, is_verified, created_at FROM users WHERE id = ?',\r\n    [userId]\r\n  );\r\n\r\n  if (userResult.rows.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const user = userResult.rows[0];\r\n\r\n  // Get profile based on role\r\n  if (user.role === 'freelancer') {\r\n    const profileResult = await query(\r\n      'SELECT * FROM freelancer_profiles WHERE user_id = ?',\r\n      [user.id]\r\n    );\r\n    user.profile = profileResult.rows[0] || null;\r\n  } else if (user.role === 'client') {\r\n    const profileResult = await query(\r\n      'SELECT * FROM client_profiles WHERE user_id = ?',\r\n      [user.id]\r\n    );\r\n    user.profile = profileResult.rows[0] || null;\r\n  }\r\n\r\n  return user;\r\n};\r\n\r\nmodule.exports = {\r\n  generateTokens,\r\n  saveRefreshToken,\r\n  getUserWithProfile\r\n};\r\n"
    },
    "lib\\auth.js": {
      "content": "const jwt = require('jsonwebtoken');\r\nconst { query } = require('./db');\r\n\r\n/**\r\n * Authentication middleware - Verifies JWT token\r\n * Attaches user info to req.user\r\n */\r\nconst authenticate = async (req, res, next) => {\r\n  try {\r\n    // Get token from Authorization header\r\n    const authHeader = req.headers.authorization;\r\n\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'No token provided. Please login.'\r\n      });\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n\r\n    // Verify token\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n\r\n    // Check if user still exists\r\n    const result = await query(\r\n      'SELECT id, email, role, first_name, last_name, is_verified FROM users WHERE id = ?',\r\n      [decoded.userId]\r\n    );\r\n\r\n    if (result.rows.length === 0) {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'User no longer exists.'\r\n      });\r\n    }\r\n\r\n    // Attach user info to request\r\n    req.user = {\r\n      userId: decoded.userId,\r\n      email: decoded.email,\r\n      role: decoded.role,\r\n      ...result.rows[0]\r\n    };\r\n\r\n    next();\r\n  } catch (error) {\r\n    if (error.name === 'JsonWebTokenError') {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'Invalid token. Please login again.'\r\n      });\r\n    }\r\n\r\n    if (error.name === 'TokenExpiredError') {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'Token expired. Please login again.',\r\n        code: 'TOKEN_EXPIRED'\r\n      });\r\n    }\r\n\r\n    console.error('Authentication error:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Authentication failed.'\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Optional authentication - Does not fail if no token\r\n * Useful for endpoints that work differently for authenticated users\r\n */\r\nconst optionalAuth = async (req, res, next) => {\r\n  try {\r\n    const authHeader = req.headers.authorization;\r\n\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n      req.user = null;\r\n      return next();\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n\r\n    const result = await query(\r\n      'SELECT id, email, role, first_name, last_name FROM users WHERE id = ?',\r\n      [decoded.userId]\r\n    );\r\n\r\n    req.user = result.rows.length > 0 ? result.rows[0] : null;\r\n    next();\r\n  } catch (error) {\r\n    req.user = null;\r\n    next();\r\n  }\r\n};\r\n\r\n/**\r\n * Role-based authorization middleware\r\n * @param {...string} roles - Allowed roles\r\n */\r\nconst authorize = (...roles) => {\r\n  return (req, res, next) => {\r\n    if (!req.user) {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'Authentication required.'\r\n      });\r\n    }\r\n\r\n    if (!roles.includes(req.user.role)) {\r\n      return res.status(403).json({\r\n        success: false,\r\n        message: `Access denied. Required role: ${roles.join(' or ')}`\r\n      });\r\n    }\r\n\r\n    next();\r\n  };\r\n};\r\n\r\n/**\r\n * Ownership verification middleware\r\n * Checks if the user owns the resource\r\n * @param {string} paramName - Name of the param containing the user ID (default: 'id')\r\n */\r\nconst verifyOwnership = (paramName = 'id') => {\r\n  return (req, res, next) => {\r\n    if (!req.user) {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: 'Authentication required.'\r\n      });\r\n    }\r\n\r\n    const resourceUserId = req.params[paramName];\r\n\r\n    // Admin can access everything\r\n    if (req.user.role === 'admin') {\r\n      return next();\r\n    }\r\n\r\n    // User can only access their own resources\r\n    if (req.user.userId !== resourceUserId) {\r\n      return res.status(403).json({\r\n        success: false,\r\n        message: 'You do not have permission to access this resource.'\r\n      });\r\n    }\r\n\r\n    next();\r\n  };\r\n};\r\n\r\n/**\r\n * Check if user is verified\r\n */\r\nconst requireVerified = (req, res, next) => {\r\n  if (!req.user) {\r\n    return res.status(401).json({\r\n      success: false,\r\n      message: 'Authentication required.'\r\n    });\r\n  }\r\n\r\n  if (!req.user.is_verified) {\r\n    return res.status(403).json({\r\n      success: false,\r\n      message: 'Email verification required. Please verify your email.'\r\n    });\r\n  }\r\n\r\n  next();\r\n};\r\n\r\nmodule.exports = {\r\n  authenticate,\r\n  optionalAuth,\r\n  authorize,\r\n  verifyOwnership,\r\n  requireVerified\r\n};\r\n"
    },
    "scripts\\update.sh": {
      "content": "#!/bin/bash\r\n\r\n# Quick Update Script - Use this after initial deployment\r\n# This script pulls latest code and rebuilds containers\r\n\r\nset -e\r\n\r\n# Colors\r\nGREEN='\\033[0;32m'\r\nBLUE='\\033[0;34m'\r\nNC='\\033[0m'\r\n\r\necho -e \"${BLUE}[INFO]${NC} Pulling latest changes...\"\r\ngit pull origin main\r\n\r\necho -e \"${BLUE}[INFO]${NC} Rebuilding containers...\"\r\ndocker-compose -f docker-compose.prod.yml build --no-cache\r\n\r\necho -e \"${BLUE}[INFO]${NC} Restarting services...\"\r\ndocker-compose -f docker-compose.prod.yml up -d\r\n\r\necho -e \"${BLUE}[INFO]${NC} Cleaning up old images...\"\r\ndocker image prune -f\r\n\r\necho -e \"${GREEN}[SUCCESS]${NC} Update completed!\"\r\ndocker-compose -f docker-compose.prod.yml ps\r\n"
    },
    "scripts\\setup.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "scripts\\README.md": {
      "content": "# Deployment Scripts\r\n\r\nCollection of utility scripts for managing your production deployment.\r\n\r\n## Available Scripts\r\n\r\n### backup.sh\r\nCreates a compressed backup of the MySQL database.\r\n\r\n```bash\r\n./scripts/backup.sh\r\n```\r\n\r\n**Features:**\r\n- Timestamped backups in `./backups/` directory\r\n- Automatic compression (gzip)\r\n- Automatic cleanup of backups older than 7 days\r\n- Safe backup with `--single-transaction`\r\n\r\n**Automation:**\r\nSet up daily backups with cron:\r\n```bash\r\ncrontab -e\r\n# Add: 0 2 * * * cd /path/to/app && ./scripts/backup.sh >> logs/backup.log 2>&1\r\n```\r\n\r\n### restore.sh\r\nRestores the database from a backup file.\r\n\r\n```bash\r\n./scripts/restore.sh\r\n```\r\n\r\n**Features:**\r\n- Interactive selection of backup file\r\n- Safety backup before restore\r\n- Confirmation prompt to prevent accidents\r\n\r\n### update.sh\r\nQuick update script for deploying new code.\r\n\r\n```bash\r\n./scripts/update.sh\r\n```\r\n\r\n**Features:**\r\n- Pulls latest code from git\r\n- Rebuilds containers\r\n- Restarts services with zero-downtime\r\n- Cleans up old images\r\n\r\n**When to use:**\r\n- After pushing new code to production branch\r\n- For quick hotfixes\r\n- Regular updates\r\n\r\n### health-check.sh\r\nComprehensive health check of all services.\r\n\r\n```bash\r\n./scripts/health-check.sh\r\n```\r\n\r\n**Checks:**\r\n- Container status\r\n- MySQL connectivity\r\n- API server response\r\n- Nginx status\r\n- SSL certificate expiry\r\n- Disk space usage\r\n- Memory usage\r\n- Recent error logs\r\n\r\n**When to use:**\r\n- Regular monitoring (daily/weekly)\r\n- After deployments\r\n- When investigating issues\r\n- Before and after maintenance\r\n\r\n### logs.sh\r\nEasy access to Docker container logs.\r\n\r\n```bash\r\n./scripts/logs.sh <service> [options]\r\n```\r\n\r\n**Examples:**\r\n```bash\r\n# Follow all logs\r\n./scripts/logs.sh all -f\r\n\r\n# Show app logs\r\n./scripts/logs.sh app\r\n\r\n# Follow nginx logs\r\n./scripts/logs.sh nginx -f\r\n\r\n# Last 100 MySQL logs\r\n./scripts/logs.sh mysql --tail 100\r\n```\r\n\r\n**Available services:**\r\n- `all` - All services\r\n- `app` - Node.js API server\r\n- `mysql` - MySQL database\r\n- `nginx` - Nginx web server\r\n- `client` - React frontend (if running in container)\r\n- `certbot` - SSL certificate manager\r\n\r\n### maintenance.sh\r\nSystem maintenance and cleanup script.\r\n\r\n```bash\r\n./scripts/maintenance.sh\r\n```\r\n\r\n**Actions:**\r\n- Stops containers\r\n- Removes unused Docker images\r\n- Optionally removes unused volumes (asks for confirmation)\r\n- Removes unused networks\r\n- Cleans up old log files (30+ days)\r\n- Cleans up old backups (30+ days)\r\n- Shows disk usage\r\n- Restarts containers\r\n\r\n**When to use:**\r\n- Monthly maintenance\r\n- When disk space is low\r\n- Before major updates\r\n- When Docker is using too much space\r\n\r\n**Warning:** Be careful with volume pruning - it will remove ALL unused volumes including database data if not properly configured.\r\n\r\n## Best Practices\r\n\r\n### Regular Maintenance Schedule\r\n\r\n**Daily:**\r\n- Automated backups (via cron)\r\n- Health checks\r\n\r\n**Weekly:**\r\n- Review logs for errors\r\n- Check disk space\r\n- Monitor performance\r\n\r\n**Monthly:**\r\n- Run maintenance script\r\n- Review and clean old backups\r\n- Update system packages\r\n- Rotate secrets (if needed)\r\n\r\n### Before Deployments\r\n\r\n1. Create a backup:\r\n   ```bash\r\n   ./scripts/backup.sh\r\n   ```\r\n\r\n2. Run health check:\r\n   ```bash\r\n   ./scripts/health-check.sh\r\n   ```\r\n\r\n### After Deployments\r\n\r\n1. Check service status:\r\n   ```bash\r\n   docker-compose -f docker-compose.prod.yml ps\r\n   ```\r\n\r\n2. Monitor logs:\r\n   ```bash\r\n   ./scripts/logs.sh all -f\r\n   ```\r\n\r\n3. Run health check:\r\n   ```bash\r\n   ./scripts/health-check.sh\r\n   ```\r\n\r\n### Emergency Recovery\r\n\r\nIf something goes wrong:\r\n\r\n1. Check what's failing:\r\n   ```bash\r\n   ./scripts/health-check.sh\r\n   ./scripts/logs.sh all --tail 200\r\n   ```\r\n\r\n2. If database is corrupted:\r\n   ```bash\r\n   ./scripts/restore.sh\r\n   ```\r\n\r\n3. If services won't start:\r\n   ```bash\r\n   docker-compose -f docker-compose.prod.yml down\r\n   docker-compose -f docker-compose.prod.yml up -d\r\n   ```\r\n\r\n4. If still having issues:\r\n   ```bash\r\n   # Full rebuild\r\n   docker-compose -f docker-compose.prod.yml down\r\n   docker-compose -f docker-compose.prod.yml build --no-cache\r\n   docker-compose -f docker-compose.prod.yml up -d\r\n   ```\r\n\r\n## Script Permissions\r\n\r\nIf scripts are not executable:\r\n\r\n```bash\r\nchmod +x scripts/*.sh\r\n```\r\n\r\n## Logging Script Output\r\n\r\nCapture script output to log files:\r\n\r\n```bash\r\n# Append to log file\r\n./scripts/backup.sh >> logs/backup.log 2>&1\r\n\r\n# View log file\r\ntail -f logs/backup.log\r\n```\r\n\r\n## Troubleshooting\r\n\r\n### Permission Denied\r\n\r\n**Problem:** `permission denied` when running scripts\r\n\r\n**Solution:**\r\n```bash\r\nchmod +x scripts/*.sh\r\n```\r\n\r\n### Docker Permission Denied\r\n\r\n**Problem:** Docker commands fail with permission errors\r\n\r\n**Solution:** Make sure user is in docker group and log out/in:\r\n```bash\r\nsudo usermod -aG docker $USER\r\n# Then log out and back in\r\n```\r\n\r\n### Script Not Found\r\n\r\n**Problem:** `command not found` when running script\r\n\r\n**Solution:** Use relative path from project root:\r\n```bash\r\n./scripts/backup.sh\r\n```\r\n\r\nOr use absolute path:\r\n```bash\r\n/home/deployer/your-repo/scripts/backup.sh\r\n```\r\n\r\n## Advanced Usage\r\n\r\n### Custom Backup Location\r\n\r\nEdit `backup.sh` and change:\r\n```bash\r\nBACKUP_DIR=\"./backups\"\r\n```\r\n\r\n### Change Backup Retention\r\n\r\nEdit `backup.sh` and change:\r\n```bash\r\nDAYS_TO_KEEP=7\r\n```\r\n\r\n### Custom Log Retention\r\n\r\nEdit `maintenance.sh` and change:\r\n```bash\r\nfind ./logs -name \"*.log\" -type f -mtime +30 -delete\r\n```\r\n\r\n## Integration with CI/CD\r\n\r\nScripts can be used in CI/CD pipelines:\r\n\r\n```yaml\r\n# GitHub Actions example\r\n- name: Deploy\r\n  run: |\r\n    ssh user@server 'cd /app && ./scripts/update.sh'\r\n\r\n- name: Health Check\r\n  run: |\r\n    ssh user@server 'cd /app && ./scripts/health-check.sh'\r\n```\r\n\r\n## Security Notes\r\n\r\n- Scripts require appropriate permissions\r\n- Database credentials are read from `.env.production`\r\n- Backup files may contain sensitive data - secure them properly\r\n- Don't commit scripts with hardcoded credentials\r\n- Use SSH key authentication for automated runs\r\n\r\n## Need Help?\r\n\r\n- Main deployment guide: [../DEPLOYMENT.md](../DEPLOYMENT.md)\r\n- Quick start guide: [../QUICKSTART.md](../QUICKSTART.md)\r\n- Project documentation: [../CLAUDE.md](../CLAUDE.md)\r\n"
    },
    "docker-compose.dev.yml": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "deploy.sh": {
      "content": "#!/bin/bash\r\n\r\n# Freelancing Platform - Production Deployment Script\r\n# This script sets up and deploys the application on a DigitalOcean VPS\r\n\r\nset -e  # Exit on error\r\n\r\n# Colors for output\r\nRED='\\033[0;31m'\r\nGREEN='\\033[0;32m'\r\nYELLOW='\\033[1;33m'\r\nBLUE='\\033[0;34m'\r\nNC='\\033[0m' # No Color\r\n\r\n# Print colored output\r\nprint_info() {\r\n    echo -e \"${BLUE}[INFO]${NC} $1\"\r\n}\r\n\r\nprint_success() {\r\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\r\n}\r\n\r\nprint_warning() {\r\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\r\n}\r\n\r\nprint_error() {\r\n    echo -e \"${RED}[ERROR]${NC} $1\"\r\n}\r\n\r\n# Check if running as root\r\nif [ \"$EUID\" -eq 0 ]; then\r\n    print_error \"Please do not run this script as root or with sudo\"\r\n    exit 1\r\nfi\r\n\r\n# Check if .env.production exists\r\nif [ ! -f .env.production ]; then\r\n    print_error \".env.production file not found!\"\r\n    print_info \"Please create .env.production from .env.production.example\"\r\n    exit 1\r\nfi\r\n\r\nprint_info \"Starting deployment process...\"\r\n\r\n# Load environment variables\r\nexport $(grep -v '^#' .env.production | xargs)\r\n\r\n# Check required environment variables\r\nREQUIRED_VARS=(\"DOMAIN\" \"DB_ROOT_PASSWORD\" \"DB_PASSWORD\" \"JWT_SECRET\" \"JWT_REFRESH_SECRET\" \"EMAIL\")\r\nfor var in \"${REQUIRED_VARS[@]}\"; do\r\n    if [ -z \"${!var}\" ]; then\r\n        print_error \"Required environment variable $var is not set in .env.production\"\r\n        exit 1\r\n    fi\r\ndone\r\n\r\n# Update system packages\r\nprint_info \"Updating system packages...\"\r\nsudo apt-get update\r\nsudo apt-get upgrade -y\r\n\r\n# Install required packages\r\nprint_info \"Installing required packages...\"\r\nsudo apt-get install -y \\\r\n    apt-transport-https \\\r\n    ca-certificates \\\r\n    curl \\\r\n    gnupg \\\r\n    lsb-release \\\r\n    ufw \\\r\n    fail2ban\r\n\r\n# Install Docker if not already installed\r\nif ! command -v docker &> /dev/null; then\r\n    print_info \"Installing Docker...\"\r\n    curl -fsSL https://get.docker.com -o get-docker.sh\r\n    sudo sh get-docker.sh\r\n    sudo usermod -aG docker $USER\r\n    rm get-docker.sh\r\n    print_success \"Docker installed successfully\"\r\nelse\r\n    print_info \"Docker already installed\"\r\nfi\r\n\r\n# Install Docker Compose if not already installed\r\nif ! command -v docker-compose &> /dev/null; then\r\n    print_info \"Installing Docker Compose...\"\r\n    sudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\r\n    sudo chmod +x /usr/local/bin/docker-compose\r\n    print_success \"Docker Compose installed successfully\"\r\nelse\r\n    print_info \"Docker Compose already installed\"\r\nfi\r\n\r\n# Configure firewall\r\nprint_info \"Configuring firewall...\"\r\nsudo ufw --force enable\r\nsudo ufw default deny incoming\r\nsudo ufw default allow outgoing\r\nsudo ufw allow ssh\r\nsudo ufw allow http\r\nsudo ufw allow https\r\nprint_success \"Firewall configured\"\r\n\r\n# Configure fail2ban\r\nprint_info \"Configuring fail2ban...\"\r\nsudo systemctl enable fail2ban\r\nsudo systemctl start fail2ban\r\nprint_success \"fail2ban configured\"\r\n\r\n# Create necessary directories\r\nprint_info \"Creating necessary directories...\"\r\nmkdir -p certbot/conf certbot/www backups logs\r\n\r\n# Replace DOMAIN placeholder in nginx config\r\nprint_info \"Configuring nginx for domain: $DOMAIN\"\r\nsed -i \"s/\\${DOMAIN}/$DOMAIN/g\" nginx/conf.d/app.conf\r\n\r\n# Pull latest images and build\r\nprint_info \"Building Docker images...\"\r\ndocker-compose -f docker-compose.prod.yml build --no-cache\r\n\r\n# Initial setup - HTTP only for Let's Encrypt\r\nprint_info \"Starting services for initial setup...\"\r\ndocker-compose -f docker-compose.prod.yml up -d mysql app nginx\r\n\r\n# Wait for services to be ready\r\nprint_info \"Waiting for services to be ready...\"\r\nsleep 30\r\n\r\n# Initialize database\r\nprint_info \"Initializing database...\"\r\ndocker-compose -f docker-compose.prod.yml exec -T app node src/db/init.js || true\r\n\r\n# Obtain SSL certificate\r\nprint_info \"Obtaining SSL certificate from Let's Encrypt...\"\r\ndocker-compose -f docker-compose.prod.yml run --rm certbot certonly \\\r\n    --webroot \\\r\n    --webroot-path=/var/www/certbot \\\r\n    --email $EMAIL \\\r\n    --agree-tos \\\r\n    --no-eff-email \\\r\n    -d $DOMAIN \\\r\n    -d www.$DOMAIN || print_warning \"SSL certificate setup failed. You can run this manually later.\"\r\n\r\n# Uncomment HTTPS configuration in nginx\r\nif [ -f \"certbot/conf/live/$DOMAIN/fullchain.pem\" ]; then\r\n    print_info \"Enabling HTTPS configuration...\"\r\n    sed -i 's/# server {/server {/g' nginx/conf.d/app.conf\r\n    sed -i 's/#     /    /g' nginx/conf.d/app.conf\r\n    sed -i 's/# }/}/g' nginx/conf.d/app.conf\r\n\r\n    # Restart nginx to apply HTTPS configuration\r\n    docker-compose -f docker-compose.prod.yml restart nginx\r\n    print_success \"HTTPS enabled successfully\"\r\nelse\r\n    print_warning \"SSL certificate not found. HTTPS configuration not enabled.\"\r\n    print_info \"You can manually obtain certificate and enable HTTPS later.\"\r\nfi\r\n\r\n# Start all services including certbot renewal\r\nprint_info \"Starting all services...\"\r\ndocker-compose -f docker-compose.prod.yml up -d\r\n\r\n# Show status\r\nprint_info \"Checking service status...\"\r\ndocker-compose -f docker-compose.prod.yml ps\r\n\r\nprint_success \"Deployment completed successfully!\"\r\necho \"\"\r\nprint_info \"Your application should now be accessible at:\"\r\necho -e \"  ${GREEN}https://$DOMAIN${NC}\"\r\necho \"\"\r\nprint_info \"Useful commands:\"\r\necho \"  View logs:    docker-compose -f docker-compose.prod.yml logs -f\"\r\necho \"  Stop:         docker-compose -f docker-compose.prod.yml down\"\r\necho \"  Restart:      docker-compose -f docker-compose.prod.yml restart\"\r\necho \"  Backup DB:    ./scripts/backup.sh\"\r\necho \"\"\r\nprint_warning \"IMPORTANT: If you're in the docker group for the first time, you may need to log out and back in for changes to take effect.\"\r\n"
    },
    "lib\\validate.js": {
      "content": "const { validationResult } = require('express-validator');\r\n\r\n/**\r\n * Middleware to handle validation errors from express-validator\r\n */\r\nconst validate = (req, res, next) => {\r\n  const errors = validationResult(req);\r\n\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: 'Validation failed',\r\n      errors: errors.array().map(err => ({\r\n        field: err.path,\r\n        message: err.msg,\r\n        value: err.value\r\n      }))\r\n    });\r\n  }\r\n\r\n  next();\r\n};\r\n\r\nmodule.exports = { validate };\r\n"
    },
    "lib\\middleware.js": {
      "content": "/**\r\n * Utility to run middleware in Vercel serverless functions\r\n * Since we don't have Express app.use(), we need to manually run middleware\r\n */\r\n\r\n/**\r\n * Run a single middleware function\r\n * @param {Function} middleware - Express middleware function\r\n * @param {Object} req - Request object\r\n * @param {Object} res - Response object\r\n * @returns {Promise<void>}\r\n */\r\nconst runMiddleware = (middleware) => {\r\n  return (req, res) => {\r\n    return new Promise((resolve, reject) => {\r\n      middleware(req, res, (result) => {\r\n        if (result instanceof Error) {\r\n          return reject(result);\r\n        }\r\n        return resolve(result);\r\n      });\r\n    });\r\n  };\r\n};\r\n\r\n/**\r\n * Run multiple middleware functions in sequence\r\n * @param {Array<Function>} middlewares - Array of Express middleware functions\r\n * @param {Object} req - Request object\r\n * @param {Object} res - Response object\r\n * @returns {Promise<void>}\r\n */\r\nconst runMiddlewares = async (middlewares, req, res) => {\r\n  for (const middleware of middlewares) {\r\n    await runMiddleware(middleware)(req, res);\r\n  }\r\n};\r\n\r\n/**\r\n * CORS headers helper for Vercel serverless functions\r\n */\r\nconst corsHeaders = {\r\n  'Access-Control-Allow-Credentials': 'true',\r\n  'Access-Control-Allow-Origin': process.env.CLIENT_URL || '*',\r\n  'Access-Control-Allow-Methods': 'GET,OPTIONS,PATCH,DELETE,POST,PUT',\r\n  'Access-Control-Allow-Headers': 'X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization'\r\n};\r\n\r\n/**\r\n * Apply CORS headers to response\r\n */\r\nconst applyCors = (res) => {\r\n  Object.entries(corsHeaders).forEach(([key, value]) => {\r\n    res.setHeader(key, value);\r\n  });\r\n};\r\n\r\n/**\r\n * Handle OPTIONS request (CORS preflight)\r\n */\r\nconst handleOptions = (req, res) => {\r\n  if (req.method === 'OPTIONS') {\r\n    applyCors(res);\r\n    res.status(200).end();\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * API handler wrapper with CORS, error handling, and method validation\r\n * @param {Function} handler - The actual handler function\r\n * @param {Object} options - Options { methods: ['GET', 'POST'], middlewares: [] }\r\n */\r\nconst apiHandler = (handler, options = {}) => {\r\n  const { methods = ['GET'], middlewares = [] } = options;\r\n\r\n  return async (req, res) => {\r\n    try {\r\n      // Apply CORS\r\n      applyCors(res);\r\n\r\n      // Handle OPTIONS request\r\n      if (handleOptions(req, res)) {\r\n        return;\r\n      }\r\n\r\n      // Validate HTTP method\r\n      if (!methods.includes(req.method)) {\r\n        return res.status(405).json({\r\n          success: false,\r\n          message: `Method ${req.method} not allowed. Allowed methods: ${methods.join(', ')}`\r\n        });\r\n      }\r\n\r\n      // Run middlewares\r\n      if (middlewares.length > 0) {\r\n        await runMiddlewares(middlewares, req, res);\r\n      }\r\n\r\n      // Run the actual handler\r\n      await handler(req, res);\r\n    } catch (error) {\r\n      console.error('API Error:', error);\r\n\r\n      // If response already sent, don't send again\r\n      if (res.headersSent) {\r\n        return;\r\n      }\r\n\r\n      // Handle specific error types\r\n      if (error.name === 'JsonWebTokenError' || error.name === 'TokenExpiredError') {\r\n        return res.status(401).json({\r\n          success: false,\r\n          message: 'Authentication failed',\r\n          error: error.message\r\n        });\r\n      }\r\n\r\n      // PostgreSQL errors\r\n      if (error.code && error.code.startsWith('2')) {\r\n        const errorHandler = require('./errorHandler');\r\n        return errorHandler(error, req, res, () => {});\r\n      }\r\n\r\n      // Generic error\r\n      res.status(error.status || 500).json({\r\n        success: false,\r\n        message: error.message || 'Internal server error',\r\n        ...(process.env.NODE_ENV === 'development' && { stack: error.stack })\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nmodule.exports = {\r\n  runMiddleware,\r\n  runMiddlewares,\r\n  applyCors,\r\n  handleOptions,\r\n  apiHandler,\r\n  corsHeaders\r\n};\r\n"
    },
    "lib\\errorHandler.js": {
      "content": "/**\r\n * Global error handler middleware for PostgreSQL\r\n */\r\nconst errorHandler = (err, req, res, next) => {\r\n  console.error('Error:', err);\r\n\r\n  // PostgreSQL database errors (SQLSTATE codes)\r\n  if (err.code) {\r\n    switch (err.code) {\r\n      case '23505': // unique_violation\r\n        return res.status(409).json({\r\n          success: false,\r\n          message: 'Duplicate entry',\r\n          error: err.message || err.detail\r\n        });\r\n      case '23503': // foreign_key_violation\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Invalid reference',\r\n          error: err.message || err.detail\r\n        });\r\n      case '23502': // not_null_violation\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Missing required field',\r\n          error: err.message || err.detail\r\n        });\r\n      case '22P02': // invalid_text_representation\r\n      case '22007': // invalid_datetime_format\r\n      case '22003': // numeric_value_out_of_range\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Invalid data format',\r\n          error: err.message || err.detail\r\n        });\r\n      case '22001': // string_data_right_truncation\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Data too long',\r\n          error: err.message || err.detail\r\n        });\r\n      case '42703': // undefined_column\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Unknown column',\r\n          error: err.message || err.detail\r\n        });\r\n      case '42P01': // undefined_table\r\n        return res.status(500).json({\r\n          success: false,\r\n          message: 'Database table not found',\r\n          error: err.message || err.detail\r\n        });\r\n      case '23514': // check_violation\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Value violates constraint',\r\n          error: err.message || err.detail\r\n        });\r\n    }\r\n  }\r\n\r\n  // Default error response\r\n  res.status(err.status || 500).json({\r\n    success: false,\r\n    message: err.message || 'Internal server error',\r\n    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })\r\n  });\r\n};\r\n\r\nmodule.exports = errorHandler;\r\n"
    },
    "src\\server.js": {
      "diff": "Index: src\\server.js\n===================================================================\n--- src\\server.js\n+++ src\\server.js\n@@ -10,17 +10,18 @@\n \n const app = express();\n const PORT = process.env.PORT || 3000;\n \n-// Security: Check for required environment variables\n+// TEMPORARY HARDCODED SECRETS - FOR TESTING ONLY!\n+// WARNING: Never commit real secrets to production!\n if (!process.env.JWT_SECRET) {\n-  console.error('FATAL ERROR: JWT_SECRET is not defined.');\n-  process.exit(1);\n+  process.env.JWT_SECRET = 'c193e0b6db03de31445d3aeb0a24b7b5e4b7f908e670ef39af2144bb5686294f1ab3a3dcaa9dcfe8b652d8671e357ccd777a5d91cea621a983e16697a546b6d8';\n+  console.log('⚠️  Using hardcoded JWT_SECRET (TEMP ONLY!)');\n }\n \n if (!process.env.JWT_REFRESH_SECRET) {\n-  console.error('FATAL ERROR: JWT_REFRESH_SECRET is not defined.');\n-  process.exit(1);\n+  process.env.JWT_REFRESH_SECRET = '66cb715a72735df9694811982592e4eb869734181b0975a5d4fcab7d52efab4d402e8e1c6c3ca20133d5dac8eb1c55c04abf92302d4fe1ed675a72c9cfba74e1';\n+  console.log('⚠️  Using hardcoded JWT_REFRESH_SECRET (TEMP ONLY!)');\n }\n \n // Middleware\n app.use(helmet()); // Security headers\n@@ -37,16 +38,26 @@\n \n // API Routes\n app.use('/api', routes);\n \n+// Health check endpoint (for Docker and monitoring)\n+app.get('/health', (req, res) => {\n+  res.status(200).json({\n+    success: true,\n+    message: 'Server is healthy',\n+    timestamp: new Date().toISOString(),\n+    uptime: process.uptime()\n+  });\n+});\n+\n // Root endpoint\n app.get('/', (req, res) => {\n   res.json({\n     success: true,\n     message: 'Freelancing Platform API',\n     version: '1.0.0',\n     endpoints: {\n-      health: '/api/health',\n+      health: '/health',\n       users: '/api/users',\n       projects: '/api/projects',\n       proposals: '/api/proposals'\n     }\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\.env.example": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\db\\init.js": {
      "diff": "Index: src\\db\\init.js\n===================================================================\n--- src\\db\\init.js\n+++ src\\db\\init.js\n@@ -4,86 +4,86 @@\n  */\r\n \r\n const fs = require('fs');\r\n const path = require('path');\r\n-const mysql = require('mysql2');\r\n+const { Client } = require('pg');\r\n require('dotenv').config();\r\n \r\n const initDb = async () => {\r\n-  // Create connection without database selected\r\n-  const connection = mysql.createConnection({\r\n+  const dbName = process.env.DB_NAME || 'freelance_platform';\r\n+\r\n+  // First, connect to default 'postgres' database to create our database\r\n+  const defaultClient = new Client({\r\n     host: process.env.DB_HOST || 'localhost',\r\n-    user: process.env.DB_USER || 'root',\r\n+    user: process.env.DB_USER || 'postgres',\r\n     password: process.env.DB_PASSWORD || 'root123',\r\n-    port: process.env.DB_PORT || 3306\r\n+    port: process.env.DB_PORT || 5432,\r\n+    database: 'postgres' // Connect to default postgres database\r\n   });\r\n \r\n-  return new Promise((resolve, reject) => {\r\n-    connection.connect((err) => {\r\n-      if (err) {\r\n-        reject(err);\r\n-        return;\r\n+  try {\r\n+    await defaultClient.connect();\r\n+    console.log('Connected to PostgreSQL server');\r\n+\r\n+    // Create database if it doesn't exist\r\n+    try {\r\n+      await defaultClient.query(`CREATE DATABASE ${dbName}`);\r\n+      console.log(`✅ Database '${dbName}' created`);\r\n+    } catch (err) {\r\n+      if (err.code === '42P04') { // database_already_exists\r\n+        console.log(`⚠️  Database '${dbName}' already exists, continuing...`);\r\n+      } else {\r\n+        throw err;\r\n       }\r\n+    }\r\n \r\n-      const dbName = process.env.DB_NAME || 'freelance_platform';\r\n+    await defaultClient.end();\r\n \r\n-      // Create database if it doesn't exist\r\n-      connection.query(`CREATE DATABASE IF NOT EXISTS ${dbName}`, (err) => {\r\n-        if (err) {\r\n-          reject(err);\r\n-          return;\r\n-        }\r\n+    // Now connect to our newly created database\r\n+    const client = new Client({\r\n+      host: process.env.DB_HOST || 'localhost',\r\n+      user: process.env.DB_USER || 'postgres',\r\n+      password: process.env.DB_PASSWORD || 'root123',\r\n+      port: process.env.DB_PORT || 5432,\r\n+      database: dbName\r\n+    });\r\n \r\n-        // Select the database\r\n-        connection.query(`USE ${dbName}`, (err) => {\r\n-          if (err) {\r\n-            reject(err);\r\n-            return;\r\n-          }\r\n+    await client.connect();\r\n+    console.log(`Connected to database '${dbName}'`);\r\n \r\n-          // Read schema.sql\r\n-          const schemaPath = path.join(__dirname, 'schema.sql');\r\n-          const schema = fs.readFileSync(schemaPath, 'utf8');\r\n+    // Read schema.sql\r\n+    const schemaPath = path.join(__dirname, 'schema.sql');\r\n+    const schema = fs.readFileSync(schemaPath, 'utf8');\r\n \r\n-          // Split SQL statements by semicolon and filter out empty/comment lines\r\n-          const statements = schema\r\n-            .split(';')\r\n-            .map((stmt) => stmt.trim())\r\n-            .filter((stmt) => stmt && !stmt.startsWith('--'));\r\n+    // Split SQL statements by semicolon and filter out empty/comment lines\r\n+    const statements = schema\r\n+      .split(';')\r\n+      .map((stmt) => stmt.trim())\r\n+      .filter((stmt) => stmt && !stmt.startsWith('--'));\r\n \r\n-          let completed = 0;\r\n+    // Execute each statement\r\n+    for (let i = 0; i < statements.length; i++) {\r\n+      const stmt = statements[i] + ';';\r\n+      console.log(`Executing statement ${i + 1}/${statements.length}...`);\r\n \r\n-          const executeNext = () => {\r\n-            if (completed >= statements.length) {\r\n-              console.log('✅ Database schema initialized successfully!');\r\n-              connection.end();\r\n-              resolve();\r\n-              return;\r\n-            }\r\n+      try {\r\n+        await client.query(stmt);\r\n+      } catch (err) {\r\n+        // Ignore \"table already exists\" (42P07) and duplicate object (42710) errors\r\n+        if (err.code === '42P07' || err.code === '42710') {\r\n+          console.log(`⚠️  Skipping (${err.code}): ${err.message}`);\r\n+        } else {\r\n+          throw err;\r\n+        }\r\n+      }\r\n+    }\r\n \r\n-            const stmt = statements[completed] + ';';\r\n-            console.log(`Executing statement ${completed + 1}/${statements.length}...`);\r\n-\r\n-            connection.query(stmt, (err) => {\r\n-              if (err) {\r\n-                // Ignore \"table already exists\" errors (1050) and duplicate key errors (1061)\r\n-                if (err.code === 'ER_TABLE_EXISTS_ERROR' || err.code === 'ER_DUP_KEYNAME') {\r\n-                  console.log(`⚠️  Skipping (${err.code})`);\r\n-                } else {\r\n-                  reject(err);\r\n-                  return;\r\n-                }\r\n-              }\r\n-              completed++;\r\n-              executeNext();\r\n-            });\r\n-          };\r\n-\r\n-          executeNext();\r\n-        });\r\n-      });\r\n-    });\r\n-  });\r\n+    console.log('✅ Database schema initialized successfully!');\r\n+    await client.end();\r\n+  } catch (error) {\r\n+    console.error('Error during database initialization:', error);\r\n+    throw error;\r\n+  }\r\n };\r\n \r\n initDb()\r\n   .then(() => {\r\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\db\\seed.js": {
      "diff": "Index: src\\db\\seed.js\n===================================================================\n--- src\\db\\seed.js\n+++ src\\db\\seed.js\n@@ -1,5 +1,6 @@\n const { randomUUID } = require('crypto');\n+const { getClient } = require('./queries');\n const pool = require('../config/database');\n \n const TABLES = [\n   'messages',\n@@ -25,19 +26,20 @@\n   }\n };\n \n const seed = async () => {\n-  const connection = await pool.getConnection();\n+  const connection = await getClient();\n \n   try {\n     console.log('Resetting existing data...');\n-    await connection.query('SET FOREIGN_KEY_CHECKS = 0');\n+    // PostgreSQL: Disable foreign key checks temporarily\n+    await connection.query('SET session_replication_role = replica');\n     for (const table of TABLES) {\n-      await connection.query(`TRUNCATE TABLE ${table}`);\n+      await connection.query(`TRUNCATE TABLE ${table} RESTART IDENTITY CASCADE`);\n     }\n-    await connection.query('SET FOREIGN_KEY_CHECKS = 1');\n+    await connection.query('SET session_replication_role = DEFAULT');\n \n-    await connection.beginTransaction();\n+    await connection.query('BEGIN');\n \n     const userIds = {\n       janeClient: randomUUID(),\n       hiroClient: randomUUID(),\n@@ -654,12 +656,12 @@\n        VALUES (?, ?, ?, ?, ?, ?)`,\n       messages\n     );\n \n-    await connection.commit();\n+    await connection.query('COMMIT');\n     console.log('Database seeded successfully.');\n   } catch (error) {\n-    await connection.rollback().catch(() => {});\n+    await connection.query('ROLLBACK').catch(() => {});\n     console.error('Failed to seed database:', error);\n     process.exitCode = 1;\n   } finally {\n     connection.release();\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\db\\queries.js": {
      "diff": "Index: src\\db\\queries.js\n===================================================================\n--- src\\db\\queries.js\n+++ src\\db\\queries.js\n@@ -1,20 +1,32 @@\n const pool = require('../config/database');\n \n /**\n+ * Convert MySQL-style ? placeholders to PostgreSQL-style $1, $2, $3\n+ * @param {string} text - SQL query with ? placeholders\n+ * @returns {string} - SQL query with $n placeholders\n+ */\n+const convertPlaceholders = (text) => {\n+  let index = 0;\n+  return text.replace(/\\?/g, () => `$${++index}`);\n+};\n+\n+/**\n  * Execute a raw SQL query\n- * @param {string} text - The SQL query\n+ * @param {string} text - The SQL query (can use ? or $1, $2, etc.)\n  * @param {Array} params - Query parameters\n  * @returns {Promise<object>} - Query result with rows and metadata\n  */\n const query = async (text, params) => {\n   const start = Date.now();\n   try {\n-    const [rows, fields] = await pool.query(text, params);\n+    // Convert MySQL-style ? to PostgreSQL-style $1, $2, $3\n+    const pgQuery = convertPlaceholders(text);\n+    const result = await pool.query(pgQuery, params);\n     const duration = Date.now() - start;\n-    console.log('Executed query', { text, duration, rows: rows.length });\n-    // Return in PostgreSQL-like format for compatibility\n-    return { rows, fields, rowCount: rows.affectedRows || rows.length };\n+    console.log('Executed query', { text: pgQuery, duration, rows: result.rowCount });\n+    // PostgreSQL pg library already returns {rows, fields, rowCount}\n+    return { rows: result.rows, fields: result.fields, rowCount: result.rowCount };\n   } catch (error) {\n     console.error('Database query error:', error);\n     throw error;\n   }\n@@ -24,53 +36,54 @@\n  * Get a connection from the pool for transactions\n  * @returns {Promise<object>} - Database connection\n  */\n const getClient = async () => {\n-  const connection = await pool.getConnection();\n+  const client = await pool.connect();\n \n   // Set a timeout to release connection after 5 seconds of inactivity\n   const timeout = setTimeout(() => {\n-    console.error('A connection has been checked out for more than 5 seconds!');\n+    console.error('A client has been checked out for more than 5 seconds!');\n   }, 5000);\n \n-  const originalRelease = connection.release.bind(connection);\n-  const originalQuery = connection.query.bind(connection);\n+  const originalRelease = client.release.bind(client);\n+  const originalQuery = client.query.bind(client);\n \n-  // Wrap query to return PostgreSQL-like format\n+  // Wrap query to return consistent format\n   const wrappedQuery = async (text, params = []) => {\n-    const [rows, fields] = await originalQuery(text, params);\n-    return { rows, fields, rowCount: rows.affectedRows || rows.length };\n+    const pgQuery = convertPlaceholders(text);\n+    const result = await originalQuery(pgQuery, params);\n+    return { rows: result.rows, fields: result.fields, rowCount: result.rowCount };\n   };\n \n   // Wrap release to clear timeout\n-  connection.release = () => {\n+  client.release = () => {\n     clearTimeout(timeout);\n     return originalRelease();\n   };\n \n   // Add wrapped query method\n-  connection.query = wrappedQuery;\n+  client.query = wrappedQuery;\n \n-  return connection;\n+  return client;\n };\n \n /**\n  * Execute queries in a transaction\n- * @param {Function} callback - Async function that receives connection\n+ * @param {Function} callback - Async function that receives client\n  * @returns {Promise<any>} - Result of the callback\n  */\n const transaction = async (callback) => {\n-  const connection = await getClient();\n+  const client = await getClient();\n   try {\n-    await connection.query('START TRANSACTION', []);\n-    const result = await callback(connection);\n-    await connection.query('COMMIT', []);\n+    await client.query('BEGIN', []);\n+    const result = await callback(client);\n+    await client.query('COMMIT', []);\n     return result;\n   } catch (error) {\n-    await connection.query('ROLLBACK', []);\n+    await client.query('ROLLBACK', []);\n     throw error;\n   } finally {\n-    connection.release();\n+    client.release();\n   }\n };\n \n module.exports = {\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\users.js": {
      "diff": "Index: src\\routes\\users.js\n===================================================================\n--- src\\routes\\users.js\n+++ src\\routes\\users.js\n@@ -98,19 +98,15 @@\n     }\n \n     // Use transaction to create user and profile\n     const result = await transaction(async (connection) => {\n-      // Insert user\n-      await connection.query(\n+      // Insert user and return the inserted row\n+      const userResult = await connection.query(\n         `INSERT INTO users (email, password_hash, role, first_name, last_name, phone, country)\n-         VALUES (?, ?, ?, ?, ?, ?, ?)`,\n+         VALUES (?, ?, ?, ?, ?, ?, ?)\n+         RETURNING id, email, role, first_name, last_name, phone, country, is_verified, created_at`,\n         [email, password, role, first_name, last_name, phone, country]\n       );\n-\n-      // Get the inserted user\n-      const userResult = await connection.query(\n-        'SELECT id, email, role, first_name, last_name, phone, country, is_verified, created_at FROM users WHERE id = LAST_INSERT_ID()'\n-      );\n       const user = userResult.rows[0];\n \n       // Create profile based on role\n       if (role === 'freelancer' && profile) {\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\proposals.js": {
      "diff": "Index: src\\routes\\proposals.js\n===================================================================\n--- src\\routes\\proposals.js\n+++ src\\routes\\proposals.js\n@@ -2,8 +2,10 @@\n const { randomUUID } = require('crypto');\n const router = express.Router();\n const { query } = require('../db/queries');\n const { authenticate, authorize } = require('../middleware/auth');\n+const { body, param } = require('express-validator');\n+const { validate } = require('../middleware/validate');\n \n const parseIntOrDefault = (value, defaultValue) => {\n   const parsed = Number.parseInt(value, 10);\n   return Number.isNaN(parsed) ? defaultValue : parsed;\n@@ -104,9 +106,38 @@\n  * POST /api/proposals\n  * Submit a new proposal\n  * Protected: Only freelancers can submit proposals\n  */\n-router.post('/', authenticate, authorize('freelancer', 'admin'), async (req, res, next) => {\n+router.post(\n+  '/',\n+  authenticate,\n+  authorize('freelancer', 'admin'),\n+  [\n+    body('project_id')\n+      .notEmpty()\n+      .withMessage('Project ID is required')\n+      .isUUID()\n+      .withMessage('Project ID must be a valid UUID'),\n+    body('bid_amount')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Bid amount must be a positive number'),\n+    body('hourly_rate')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Hourly rate must be a positive number'),\n+    body('estimated_hours')\n+      .optional()\n+      .isInt({ min: 1 })\n+      .withMessage('Estimated hours must be a positive integer'),\n+    body('cover_letter')\n+      .notEmpty()\n+      .withMessage('Cover letter is required')\n+      .isLength({ max: 5000 })\n+      .withMessage('Cover letter must be at most 5000 characters')\n+  ],\n+  validate,\n+  async (req, res, next) => {\n   try {\n     const {\n       project_id,\n       bid_amount,\n@@ -422,9 +453,38 @@\n  * PATCH /api/proposals/:id\n  * Update proposal (e.g., change status, update bid)\n  * Protected: Freelancer can update their own proposal, Client can update status\n  */\n-router.patch('/:id', authenticate, async (req, res, next) => {\n+router.patch(\n+  '/:id',\n+  authenticate,\n+  [\n+    param('id')\n+      .isUUID()\n+      .withMessage('Proposal ID must be a valid UUID'),\n+    body('bid_amount')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Bid amount must be a positive number'),\n+    body('hourly_rate')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Hourly rate must be a positive number'),\n+    body('estimated_hours')\n+      .optional()\n+      .isInt({ min: 1 })\n+      .withMessage('Estimated hours must be a positive integer'),\n+    body('cover_letter')\n+      .optional()\n+      .isLength({ max: 5000 })\n+      .withMessage('Cover letter must be at most 5000 characters'),\n+    body('status')\n+      .optional()\n+      .isIn(['pending', 'accepted', 'rejected', 'withdrawn'])\n+      .withMessage('Status must be one of: pending, accepted, rejected, withdrawn')\n+  ],\n+  validate,\n+  async (req, res, next) => {\n   try {\n     const { id } = req.params;\n     const { bid_amount, hourly_rate, estimated_hours, cover_letter, status } = req.body;\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\projects.js": {
      "diff": "Index: src\\routes\\projects.js\n===================================================================\n--- src\\routes\\projects.js\n+++ src\\routes\\projects.js\n@@ -2,8 +2,10 @@\n const { randomUUID } = require('crypto');\n const router = express.Router();\n const { query, transaction } = require('../db/queries');\n const { authenticate, authorize, optionalAuth } = require('../middleware/auth');\n+const { body, param } = require('express-validator');\n+const { validate } = require('../middleware/validate');\n \n const parseIntOrDefault = (value, defaultValue) => {\n   const parsed = Number.parseInt(value, 10);\n   return Number.isNaN(parsed) ? defaultValue : parsed;\n@@ -132,9 +134,50 @@\n  * POST /api/projects\n  * Create a new project\n  * Protected: Only clients can create projects\n  */\n-router.post('/', authenticate, authorize('client', 'admin'), async (req, res, next) => {\n+router.post(\n+  '/',\n+  authenticate,\n+  authorize('client', 'admin'),\n+  [\n+    body('title')\n+      .notEmpty()\n+      .withMessage('Title is required')\n+      .isLength({ max: 255 })\n+      .withMessage('Title must be at most 255 characters'),\n+    body('description')\n+      .optional()\n+      .isLength({ max: 5000 })\n+      .withMessage('Description must be at most 5000 characters'),\n+    body('project_type')\n+      .notEmpty()\n+      .withMessage('Project type is required')\n+      .isIn(['fixed', 'hourly'])\n+      .withMessage('Project type must be either \"fixed\" or \"hourly\"'),\n+    body('budget_min')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Minimum budget must be a positive number'),\n+    body('budget_max')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Maximum budget must be a positive number'),\n+    body('currency')\n+      .optional()\n+      .isLength({ max: 3 })\n+      .withMessage('Currency must be a 3-letter code'),\n+    body('due_at')\n+      .optional()\n+      .isISO8601()\n+      .withMessage('Due date must be a valid ISO 8601 datetime'),\n+    body('skill_ids')\n+      .optional()\n+      .isArray()\n+      .withMessage('Skill IDs must be an array')\n+  ],\n+  validate,\n+  async (req, res, next) => {\n   try {\n     const {\n       title,\n       description,\n@@ -145,15 +188,8 @@\n       due_at,\n       skill_ids = []\n     } = req.body;\n \n-    if (!title || !project_type) {\n-      return res.status(400).json({\n-        success: false,\n-        message: 'title and project_type are required'\n-      });\n-    }\n-\n     // Get the client profile for the authenticated user\n     const clientProfileResult = await query(\n       'SELECT id FROM client_profiles WHERE user_id = ?',\n       [req.user.userId]\n@@ -168,8 +204,14 @@\n \n     const client_id = clientProfileResult.rows[0].id;\n     const projectId = randomUUID();\n \n+    // Convert ISO datetime to MySQL format (YYYY-MM-DD HH:MM:SS)\n+    let formattedDueAt = null;\n+    if (due_at) {\n+      formattedDueAt = new Date(due_at).toISOString().slice(0, 19).replace('T', ' ');\n+    }\n+\n     await transaction(async (connection) => {\n       await connection.query(\n         `INSERT INTO projects (id, client_id, title, description, project_type, budget_min, budget_max, currency, due_at)\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n@@ -181,9 +223,9 @@\n           project_type,\n           budget_min ?? null,\n           budget_max ?? null,\n           currency ?? 'USD',\n-          due_at ?? null\n+          formattedDueAt\n         ]\n       );\n \n       if (Array.isArray(skill_ids) && skill_ids.length > 0) {\n@@ -234,9 +276,42 @@\n  * PATCH /api/projects/:id\n  * Update project\n  * Protected: Only the project owner (client) can update\n  */\n-router.patch('/:id', authenticate, async (req, res, next) => {\n+router.patch(\n+  '/:id',\n+  authenticate,\n+  [\n+    param('id')\n+      .isUUID()\n+      .withMessage('Project ID must be a valid UUID'),\n+    body('title')\n+      .optional()\n+      .isLength({ max: 255 })\n+      .withMessage('Title must be at most 255 characters'),\n+    body('description')\n+      .optional()\n+      .isLength({ max: 5000 })\n+      .withMessage('Description must be at most 5000 characters'),\n+    body('budget_min')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Minimum budget must be a positive number'),\n+    body('budget_max')\n+      .optional()\n+      .isFloat({ min: 0 })\n+      .withMessage('Maximum budget must be a positive number'),\n+    body('status')\n+      .optional()\n+      .isIn(['open', 'awarded', 'in_progress', 'completed', 'cancelled'])\n+      .withMessage('Status must be one of: open, awarded, in_progress, completed, cancelled'),\n+    body('due_at')\n+      .optional()\n+      .isISO8601()\n+      .withMessage('Due date must be a valid ISO 8601 datetime')\n+  ],\n+  validate,\n+  async (req, res, next) => {\n   try {\n     const { id } = req.params;\n     const { title, description, budget_min, budget_max, status, due_at } = req.body;\n \n@@ -262,8 +337,14 @@\n         message: 'You do not have permission to update this project'\n       });\n     }\n \n+    // Convert ISO datetime to MySQL format (YYYY-MM-DD HH:MM:SS)\n+    let formattedDueAt = null;\n+    if (due_at) {\n+      formattedDueAt = new Date(due_at).toISOString().slice(0, 19).replace('T', ' ');\n+    }\n+\n     const updateResult = await query(\n       `UPDATE projects\n        SET title = COALESCE(?, title),\n            description = COALESCE(?, description),\n@@ -277,9 +358,9 @@\n         description ?? null,\n         budget_min ?? null,\n         budget_max ?? null,\n         status ?? null,\n-        due_at ?? null,\n+        formattedDueAt,\n         id\n       ]\n     );\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\db\\generateHashes.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\index.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\contracts.js": {
      "diff": "Index: src\\routes\\contracts.js\n===================================================================\n--- src\\routes\\contracts.js\n+++ src\\routes\\contracts.js\n@@ -2,8 +2,10 @@\n const { randomUUID } = require('crypto');\r\n const router = express.Router();\r\n const { query } = require('../db/queries');\r\n const { authenticate, authorize } = require('../middleware/auth');\r\n+const { body, param } = require('express-validator');\r\n+const { validate } = require('../middleware/validate');\r\n \r\n const parseIntOrDefault = (value, defaultValue) => {\r\n   const parsed = Number.parseInt(value, 10);\r\n   return Number.isNaN(parsed) ? defaultValue : parsed;\r\n@@ -174,9 +176,26 @@\n  * PATCH /api/contracts/:id\r\n  * Update contract (e.g., change status, end date)\r\n  * Protected: Only client or freelancer in the contract can update\r\n  */\r\n-router.patch('/:id', authenticate, async (req, res, next) => {\r\n+router.patch(\r\n+  '/:id',\r\n+  authenticate,\r\n+  [\r\n+    param('id')\r\n+      .isUUID()\r\n+      .withMessage('Contract ID must be a valid UUID'),\r\n+    body('status')\r\n+      .optional()\r\n+      .isIn(['active', 'completed', 'cancelled', 'disputed'])\r\n+      .withMessage('Status must be one of: active, completed, cancelled, disputed'),\r\n+    body('end_at')\r\n+      .optional()\r\n+      .isISO8601()\r\n+      .withMessage('End date must be a valid ISO 8601 datetime')\r\n+  ],\r\n+  validate,\r\n+  async (req, res, next) => {\r\n   try {\r\n     const { id } = req.params;\r\n     const { status, end_at } = req.body;\r\n \r\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\routes\\auth.js": {
      "diff": "Index: src\\routes\\auth.js\n===================================================================\n--- src\\routes\\auth.js\n+++ src\\routes\\auth.js\n@@ -57,11 +57,12 @@\n const saveRefreshToken = async (userId, token) => {\r\n   const expiresAt = new Date();\r\n   expiresAt.setDate(expiresAt.getDate() + 7); // 7 days from now\r\n \r\n+  // PostgreSQL accepts ISO format directly\r\n   await query(\r\n     'INSERT INTO refresh_tokens (user_id, token, expires_at) VALUES (?, ?, ?)',\r\n-    [userId, token, expiresAt]\r\n+    [userId, token, expiresAt.toISOString()]\r\n   );\r\n };\r\n \r\n /**\r\n@@ -125,9 +126,9 @@\n \r\n       // Create user with profile in transaction\r\n       const result = await transaction(async (connection) => {\r\n         // Generate UUID for the new user\r\n-        const uuidResult = await connection.query('SELECT UUID() as id');\r\n+        const uuidResult = await connection.query('SELECT gen_random_uuid() as id');\r\n         const userId = uuidResult.rows[0].id;\r\n \r\n         // Insert user with the generated UUID\r\n         await connection.query(\r\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\nginx.conf": {
      "content": "server {\r\n    listen 80;\r\n    server_name localhost;\r\n    root /usr/share/nginx/html;\r\n    index index.html;\r\n\r\n    # Gzip compression\r\n    gzip on;\r\n    gzip_vary on;\r\n    gzip_min_length 1024;\r\n    gzip_proxied any;\r\n    gzip_types\r\n        text/plain\r\n        text/css\r\n        text/xml\r\n        text/javascript\r\n        application/json\r\n        application/javascript\r\n        application/xml+rss\r\n        application/rss+xml\r\n        font/truetype\r\n        font/opentype\r\n        application/vnd.ms-fontobject\r\n        image/svg+xml;\r\n\r\n    # Security headers\r\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\r\n    add_header X-Content-Type-Options \"nosniff\" always;\r\n    add_header X-XSS-Protection \"1; mode=block\" always;\r\n\r\n    # Cache static assets\r\n    location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {\r\n        expires 1y;\r\n        add_header Cache-Control \"public, immutable\";\r\n    }\r\n\r\n    # Health check endpoint\r\n    location /health {\r\n        access_log off;\r\n        return 200 \"healthy\\n\";\r\n        add_header Content-Type text/plain;\r\n    }\r\n\r\n    # React Router - serve index.html for all routes\r\n    location / {\r\n        try_files $uri $uri/ /index.html;\r\n    }\r\n}\r\n"
    },
    "client\\index.html": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\Dockerfile.prod": {
      "content": "# Multi-stage build for production\r\nFROM node:18-alpine AS builder\r\n\r\nWORKDIR /app\r\n\r\n# Copy package files\r\nCOPY package*.json ./\r\n\r\n# Install dependencies\r\nRUN npm ci && npm cache clean --force\r\n\r\n# Copy source code\r\nCOPY . .\r\n\r\n# Build argument for API URL\r\nARG VITE_API_URL\r\nENV VITE_API_URL=$VITE_API_URL\r\n\r\n# Build the application\r\nRUN npm run build\r\n\r\n# Production stage - use nginx to serve static files\r\nFROM nginx:alpine AS production\r\n\r\n# Copy custom nginx config\r\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\r\n\r\n# Copy built assets from builder stage\r\nCOPY --from=builder /app/dist /usr/share/nginx/html\r\n\r\n# Add healthcheck\r\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\r\n  CMD wget --quiet --tries=1 --spider http://localhost/health || exit 1\r\n\r\n# Expose port\r\nEXPOSE 80\r\n\r\n# Start nginx\r\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\r\n"
    },
    "client\\Dockerfile": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\vite.config.js": {
      "diff": "Index: client\\vite.config.js\n===================================================================\n--- client\\vite.config.js\n+++ client\\vite.config.js\n@@ -3,13 +3,19 @@\n \n export default defineConfig({\n   plugins: [react()],\n   server: {\n-    port: 3000,\n-    proxy: {\n-      '/api': {\n-        target: 'http://localhost:5000',\n-        changeOrigin: true\n+    port: 3000\n+  },\n+  build: {\n+    outDir: 'dist',\n+    sourcemap: false,\n+    rollupOptions: {\n+      output: {\n+        manualChunks: {\n+          vendor: ['react', 'react-dom', 'react-router-dom'],\n+          axios: ['axios']\n+        }\n       }\n     }\n   }\n })\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\vercel.json": {
      "content": "{\r\n  \"version\": 2,\r\n  \"name\": \"freelance-platform-client\",\r\n  \"buildCommand\": \"npm run build\",\r\n  \"outputDirectory\": \"dist\",\r\n  \"devCommand\": \"npm run dev\",\r\n  \"installCommand\": \"npm install\",\r\n  \"framework\": \"vite\",\r\n  \"rewrites\": [\r\n    {\r\n      \"source\": \"/(.*)\",\r\n      \"destination\": \"/index.html\"\r\n    }\r\n  ],\r\n  \"headers\": [\r\n    {\r\n      \"source\": \"/assets/(.*)\",\r\n      \"headers\": [\r\n        {\r\n          \"key\": \"Cache-Control\",\r\n          \"value\": \"public, max-age=31536000, immutable\"\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}\r\n"
    },
    "client\\README.md": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\package.json": {
      "diff": "Index: client\\package.json\n===================================================================\n--- client\\package.json\n+++ client\\package.json\n@@ -3,12 +3,15 @@\n   \"version\": \"1.0.0\",\n   \"description\": \"React frontend for Freelancing Platform\",\n   \"private\": true,\n   \"dependencies\": {\n+    \"axios\": \"^1.6.2\",\n+    \"framer-motion\": \"^12.23.24\",\n     \"react\": \"^18.2.0\",\n     \"react-dom\": \"^18.2.0\",\n-    \"react-router-dom\": \"^6.20.0\",\n-    \"axios\": \"^1.6.2\"\n+    \"react-hot-toast\": \"^2.6.0\",\n+    \"react-loading-skeleton\": \"^3.5.0\",\n+    \"react-router-dom\": \"^6.20.0\"\n   },\n   \"devDependencies\": {\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n     \"vite\": \"^5.0.8\"\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\.gitignore": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\.env.production.example": {
      "content": "# Production API Configuration\r\n# This should point to your deployed Vercel API\r\nVITE_API_URL=https://your-api-name.vercel.app/api\r\n"
    },
    "nginx\\conf.d\\app.conf": {
      "content": "# HTTP Configuration (for initial setup and Let's Encrypt validation)\r\nserver {\r\n    listen 80;\r\n    server_name ${DOMAIN} www.${DOMAIN};\r\n    server_tokens off;\r\n\r\n    # Let's Encrypt challenge location\r\n    location /.well-known/acme-challenge/ {\r\n        root /var/www/certbot;\r\n    }\r\n\r\n    # Redirect all other HTTP traffic to HTTPS\r\n    location / {\r\n        return 301 https://$host$request_uri;\r\n    }\r\n}\r\n\r\n# HTTPS Configuration (uncomment after obtaining SSL certificate)\r\n# server {\r\n#     listen 443 ssl http2;\r\n#     server_name ${DOMAIN} www.${DOMAIN};\r\n#     server_tokens off;\r\n\r\n#     # SSL Configuration\r\n#     ssl_certificate /etc/letsencrypt/live/${DOMAIN}/fullchain.pem;\r\n#     ssl_certificate_key /etc/letsencrypt/live/${DOMAIN}/privkey.pem;\r\n#     ssl_protocols TLSv1.2 TLSv1.3;\r\n#     ssl_ciphers HIGH:!aNULL:!MD5;\r\n#     ssl_prefer_server_ciphers on;\r\n#     ssl_session_cache shared:SSL:10m;\r\n#     ssl_session_timeout 10m;\r\n\r\n#     # HSTS\r\n#     add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\r\n\r\n#     # API Endpoints\r\n#     location /api/ {\r\n#         limit_req zone=api_limit burst=20 nodelay;\r\n#         proxy_pass http://app:3000;\r\n#         proxy_http_version 1.1;\r\n#         proxy_set_header Upgrade $http_upgrade;\r\n#         proxy_set_header Connection 'upgrade';\r\n#         proxy_set_header Host $host;\r\n#         proxy_set_header X-Real-IP $remote_addr;\r\n#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n#         proxy_set_header X-Forwarded-Proto $scheme;\r\n#         proxy_cache_bypass $http_upgrade;\r\n#         proxy_read_timeout 300s;\r\n#         proxy_connect_timeout 75s;\r\n#     }\r\n\r\n#     # Auth endpoints with stricter rate limiting\r\n#     location ~ ^/api/auth/(login|register) {\r\n#         limit_req zone=auth_limit burst=5 nodelay;\r\n#         proxy_pass http://app:3000;\r\n#         proxy_http_version 1.1;\r\n#         proxy_set_header Host $host;\r\n#         proxy_set_header X-Real-IP $remote_addr;\r\n#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n#         proxy_set_header X-Forwarded-Proto $scheme;\r\n#     }\r\n\r\n#     # Health check endpoint\r\n#     location /health {\r\n#         access_log off;\r\n#         proxy_pass http://app:3000/health;\r\n#     }\r\n\r\n#     # Frontend static files\r\n#     location / {\r\n#         root /usr/share/nginx/html;\r\n#         try_files $uri $uri/ /index.html;\r\n#\r\n#         # Cache static assets\r\n#         location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {\r\n#             expires 1y;\r\n#             add_header Cache-Control \"public, immutable\";\r\n#         }\r\n#     }\r\n# }\r\n"
    },
    "client\\dist\\index.html": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\middleware\\auth.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\config\\database.js": {
      "diff": "Index: src\\config\\database.js\n===================================================================\n--- src\\config\\database.js\n+++ src\\config\\database.js\n@@ -1,47 +1,47 @@\n-const mysql = require('mysql2');\n+const { Pool } = require('pg');\n require('dotenv').config();\n \n-// Create a MySQL connection pool\n-const pool = mysql.createPool({\n-  host: process.env.DB_HOST || 'localhost',\n-  user: process.env.DB_USER || 'root',\n-  password: process.env.DB_PASSWORD || 'root123',\n-  database: process.env.DB_NAME || 'freelance_platform',\n-  port: process.env.DB_PORT || 3306,\n-  waitForConnections: true,\n-  connectionLimit: 20, // Maximum number of connections in the pool\n-  queueLimit: 0,\n-  enableKeepAlive: true,\n-  keepAliveInitialDelay: 0\n+// TEMPORARY HARDCODED CONFIG - FOR TESTING ONLY!\n+// WARNING: Never commit real credentials to production!\n+console.log('🔧 Using hardcoded database credentials (TEMP ONLY!)');\n+\n+// Create a PostgreSQL connection pool with explicit parameters\n+// Using individual params instead of connection string to force IPv4\n+const pool = new Pool({\n+  host: 'aws-1-ap-southeast-2.pooler.supabase.com',\n+  port: 6543, // Transaction pooling port\n+  database: 'postgres',\n+  user: 'postgres.czzkdcukjqpmeipkadgt',\n+  password: 'd4ugk19lZ17p1XA6',\n+  ssl: { rejectUnauthorized: false },\n+  max: 10,\n+  idleTimeoutMillis: 30000,\n+  connectionTimeoutMillis: 10000,\n+  // Force IPv4 family to avoid IPv6 issues\n+  family: 4,\n });\n \n-// Get promise-based pool\n-const promisePool = pool.promise();\n-\n // Test the connection\n-pool.getConnection((err, connection) => {\n+pool.connect((err, client, release) => {\n   if (err) {\n-    console.error('Error connecting to MySQL database:', err);\n+    console.error('Error connecting to PostgreSQL database:', err);\n     process.exit(-1);\n   }\n-  if (connection) {\n-    console.log('Connected to MySQL database');\n-    connection.release();\n+  if (client) {\n+    console.log('Connected to PostgreSQL database');\n+    release();\n   }\n });\n \n // Handle pool errors\n pool.on('error', (err) => {\n-  console.error('Unexpected error on MySQL pool', err);\n-  if (err.code === 'PROTOCOL_CONNECTION_LOST') {\n-    console.error('Database connection was closed.');\n+  console.error('Unexpected error on PostgreSQL pool', err);\n+  if (err.code === 'ECONNREFUSED') {\n+    console.error('Database connection was refused.');\n   }\n-  if (err.code === 'ER_CON_COUNT_ERROR') {\n+  if (err.code === '53300') {\n     console.error('Database has too many connections.');\n   }\n-  if (err.code === 'ECONNREFUSED') {\n-    console.error('Database connection was refused.');\n-  }\n });\n \n-module.exports = promisePool;\n+module.exports = pool;\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\middleware\\validate.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "src\\middleware\\errorHandler.js": {
      "diff": "Index: src\\middleware\\errorHandler.js\n===================================================================\n--- src\\middleware\\errorHandler.js\n+++ src\\middleware\\errorHandler.js\n@@ -1,59 +1,63 @@\n /**\n- * Global error handler middleware for MySQL\n+ * Global error handler middleware for PostgreSQL\n  */\n const errorHandler = (err, req, res, next) => {\n   console.error('Error:', err);\n \n-  // MySQL database errors\n+  // PostgreSQL database errors (SQLSTATE codes)\n   if (err.code) {\n     switch (err.code) {\n-      case 'ER_DUP_ENTRY': // Duplicate entry (1062)\n+      case '23505': // unique_violation\n         return res.status(409).json({\n           success: false,\n           message: 'Duplicate entry',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_NO_REFERENCED_ROW': // Foreign key violation - no referenced row (1216)\n-      case 'ER_ROW_IS_REFERENCED': // Foreign key violation - row is referenced (1217)\n-      case 'ER_NO_REFERENCED_ROW_2': // Foreign key violation (1452)\n-      case 'ER_ROW_IS_REFERENCED_2': // Foreign key violation (1451)\n+      case '23503': // foreign_key_violation\n         return res.status(400).json({\n           success: false,\n           message: 'Invalid reference',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_BAD_NULL_ERROR': // NOT NULL constraint violation (1048)\n+      case '23502': // not_null_violation\n         return res.status(400).json({\n           success: false,\n           message: 'Missing required field',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_TRUNCATED_WRONG_VALUE': // Invalid data format (1366)\n-      case 'ER_WRONG_VALUE': // Invalid data format (1525)\n+      case '22P02': // invalid_text_representation\n+      case '22007': // invalid_datetime_format\n+      case '22003': // numeric_value_out_of_range\n         return res.status(400).json({\n           success: false,\n           message: 'Invalid data format',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_DATA_TOO_LONG': // Data too long for column (1406)\n+      case '22001': // string_data_right_truncation\n         return res.status(400).json({\n           success: false,\n           message: 'Data too long',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_BAD_FIELD_ERROR': // Unknown column (1054)\n+      case '42703': // undefined_column\n         return res.status(400).json({\n           success: false,\n           message: 'Unknown column',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n-      case 'ER_NO_SUCH_TABLE': // Table doesn't exist (1146)\n+      case '42P01': // undefined_table\n         return res.status(500).json({\n           success: false,\n           message: 'Database table not found',\n-          error: err.sqlMessage\n+          error: err.message || err.detail\n         });\n+      case '23514': // check_violation\n+        return res.status(400).json({\n+          success: false,\n+          message: 'Value violates constraint',\n+          error: err.message || err.detail\n+        });\n     }\n   }\n \n   // Default error response\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\CreateProject.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\Dashboard.jsx": {
      "diff": "Index: client\\src\\pages\\Dashboard.jsx\n===================================================================\n--- client\\src\\pages\\Dashboard.jsx\n+++ client\\src\\pages\\Dashboard.jsx\n@@ -1,8 +1,9 @@\n import React, { useState, useEffect } from 'react';\n import { useNavigate } from 'react-router-dom';\n import { projectsAPI } from '../services/api';\n import { useAuth } from '../context/AuthContext';\n+import SkeletonCard from '../components/ui/SkeletonCard';\n \n const Dashboard = () => {\n   const [projects, setProjects] = useState([]);\n   const [loading, setLoading] = useState(true);\n@@ -53,9 +54,28 @@\n \n   if (loading) {\n     return (\n       <div className=\"container\">\n-        <div className=\"loading\">Loading projects...</div>\n+        <h1 style={{ marginBottom: '1.5rem' }}>Browse Projects</h1>\n+        <div className=\"filters\">\n+          <div className=\"filters-row\">\n+            <div className=\"form-group\" style={{ marginBottom: 0 }}>\n+              <label>Status</label>\n+              <select disabled>\n+                <option>All Statuses</option>\n+              </select>\n+            </div>\n+            <div className=\"form-group\" style={{ marginBottom: 0 }}>\n+              <label>Project Type</label>\n+              <select disabled>\n+                <option>All Types</option>\n+              </select>\n+            </div>\n+          </div>\n+        </div>\n+        <div className=\"projects-grid\">\n+          <SkeletonCard count={6} />\n+        </div>\n       </div>\n     );\n   }\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\ContractDetail.jsx": {
      "diff": "Index: client\\src\\pages\\ContractDetail.jsx\n===================================================================\n--- client\\src\\pages\\ContractDetail.jsx\n+++ client\\src\\pages\\ContractDetail.jsx\n@@ -1,16 +1,22 @@\n import React, { useState, useEffect } from 'react';\r\n import { useParams, useNavigate } from 'react-router-dom';\r\n+import toast from 'react-hot-toast';\r\n import { contractsAPI } from '../services/api';\r\n import { useAuth } from '../context/AuthContext';\r\n+import { useConfirm } from '../context/ConfirmContext';\r\n+import Button from '../components/ui/Button';\r\n+import SkeletonDetail from '../components/ui/SkeletonDetail';\r\n \r\n const ContractDetail = () => {\r\n   const { id } = useParams();\r\n   const [contract, setContract] = useState(null);\r\n   const [loading, setLoading] = useState(true);\r\n   const [error, setError] = useState('');\r\n+  const [actionLoading, setActionLoading] = useState({});\r\n   const { user } = useAuth();\r\n   const navigate = useNavigate();\r\n+  const { confirm } = useConfirm();\r\n \r\n   useEffect(() => {\r\n     fetchContract();\r\n   }, [id]);\r\n@@ -29,39 +35,55 @@\n     }\r\n   };\r\n \r\n   const handleCompleteContract = async () => {\r\n-    if (!window.confirm('Are you sure you want to mark this contract as completed?')) {\r\n-      return;\r\n-    }\r\n+    const confirmed = await confirm({\r\n+      title: 'Complete Contract',\r\n+      message: 'Are you sure you want to mark this contract as completed?',\r\n+      confirmText: 'Mark Complete',\r\n+      variant: 'success'\r\n+    });\r\n \r\n+    if (!confirmed) return;\r\n+\r\n+    setActionLoading(prev => ({ ...prev, complete: true }));\r\n     try {\r\n       await contractsAPI.update(id, { status: 'completed', end_at: new Date().toISOString() });\r\n-      alert('Contract marked as completed!');\r\n+      toast.success('Contract marked as completed!');\r\n       fetchContract();\r\n     } catch (err) {\r\n-      alert(err.response?.data?.message || 'Failed to update contract');\r\n+      toast.error(err.response?.data?.message || 'Failed to update contract');\r\n+    } finally {\r\n+      setActionLoading(prev => ({ ...prev, complete: false }));\r\n     }\r\n   };\r\n \r\n   const handleTerminateContract = async () => {\r\n-    if (!window.confirm('Are you sure you want to terminate this contract? This action cannot be undone.')) {\r\n-      return;\r\n-    }\r\n+    const confirmed = await confirm({\r\n+      title: 'Terminate Contract',\r\n+      message: 'Are you sure you want to terminate this contract? This action cannot be undone.',\r\n+      confirmText: 'Terminate',\r\n+      variant: 'danger'\r\n+    });\r\n \r\n+    if (!confirmed) return;\r\n+\r\n+    setActionLoading(prev => ({ ...prev, terminate: true }));\r\n     try {\r\n       await contractsAPI.update(id, { status: 'terminated', end_at: new Date().toISOString() });\r\n-      alert('Contract terminated');\r\n+      toast.success('Contract terminated');\r\n       fetchContract();\r\n     } catch (err) {\r\n-      alert(err.response?.data?.message || 'Failed to terminate contract');\r\n+      toast.error(err.response?.data?.message || 'Failed to terminate contract');\r\n+    } finally {\r\n+      setActionLoading(prev => ({ ...prev, terminate: false }));\r\n     }\r\n   };\r\n \r\n   if (loading) {\r\n     return (\r\n       <div className=\"container\">\r\n-        <div className=\"loading\">Loading contract...</div>\r\n+        <SkeletonDetail />\r\n       </div>\r\n     );\r\n   }\r\n \r\n@@ -111,14 +133,22 @@\n           </div>\r\n \r\n           {contract.status === 'active' && (\r\n             <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n-              <button onClick={handleCompleteContract} className=\"btn btn-success\">\r\n+              <Button\r\n+                onClick={handleCompleteContract}\r\n+                variant=\"success\"\r\n+                loading={actionLoading.complete}\r\n+              >\r\n                 Mark Complete\r\n-              </button>\r\n-              <button onClick={handleTerminateContract} className=\"btn btn-danger\">\r\n+              </Button>\r\n+              <Button\r\n+                onClick={handleTerminateContract}\r\n+                variant=\"danger\"\r\n+                loading={actionLoading.terminate}\r\n+              >\r\n                 Terminate\r\n-              </button>\r\n+              </Button>\r\n             </div>\r\n           )}\r\n         </div>\r\n \r\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\services\\api.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\index.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\index.css": {
      "diff": "Index: client\\src\\index.css\n===================================================================\n--- client\\src\\index.css\n+++ client\\src\\index.css\n@@ -1,4 +1,45 @@\n+:root {\n+  /* Colors */\n+  --color-primary: #3498db;\n+  --color-primary-dark: #2980b9;\n+  --color-success: #27ae60;\n+  --color-success-dark: #229954;\n+  --color-danger: #e74c3c;\n+  --color-danger-dark: #c0392b;\n+  --color-secondary: #95a5a6;\n+  --color-secondary-dark: #7f8c8d;\n+  --color-text: #2c3e50;\n+  --color-text-light: #666;\n+  --color-bg: #f5f5f5;\n+  --color-white: #fff;\n+  --color-border: #ddd;\n+  --color-border-light: #e0e0e0;\n+\n+  /* Spacing */\n+  --spacing-xs: 0.25rem;\n+  --spacing-sm: 0.5rem;\n+  --spacing-md: 1rem;\n+  --spacing-lg: 1.5rem;\n+  --spacing-xl: 2rem;\n+\n+  /* Border radius */\n+  --radius-sm: 4px;\n+  --radius-md: 8px;\n+  --radius-lg: 12px;\n+\n+  /* Shadows */\n+  --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);\n+  --shadow-md: 0 2px 8px rgba(0,0,0,0.1);\n+  --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);\n+  --shadow-xl: 0 10px 25px rgba(0,0,0,0.2);\n+\n+  /* Transitions */\n+  --transition-fast: 0.15s ease;\n+  --transition-base: 0.2s ease;\n+  --transition-slow: 0.3s ease;\n+}\n+\n * {\n   margin: 0;\n   padding: 0;\n   box-sizing: border-box;\n@@ -9,10 +50,10 @@\n     'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n     sans-serif;\n   -webkit-font-smoothing: antialiased;\n   -moz-osx-font-smoothing: grayscale;\n-  background-color: #f5f5f5;\n-  color: #333;\n+  background-color: var(--color-bg);\n+  color: var(--color-text);\n }\n \n code {\n   font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n@@ -20,59 +61,164 @@\n }\n \n /* Navigation */\n .navbar {\n-  background-color: #2c3e50;\n-  color: white;\n+  background-color: var(--color-text);\n+  color: var(--color-white);\n   padding: 1rem 2rem;\n-  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n+  box-shadow: var(--shadow-sm);\n+  position: sticky;\n+  top: 0;\n+  z-index: 100;\n }\n \n .navbar-container {\n   max-width: 1200px;\n   margin: 0 auto;\n   display: flex;\n   justify-content: space-between;\n   align-items: center;\n+  position: relative;\n }\n \n .navbar h1 {\n   font-size: 1.5rem;\n   cursor: pointer;\n+  transition: opacity var(--transition-base);\n }\n \n-.navbar nav {\n+.navbar h1:hover {\n+  opacity: 0.9;\n+}\n+\n+.navbar-links {\n   display: flex;\n   gap: 1.5rem;\n   align-items: center;\n }\n \n .navbar a {\n-  color: white;\n+  color: var(--color-white);\n   text-decoration: none;\n   font-weight: 500;\n-  transition: opacity 0.2s;\n+  transition: opacity var(--transition-base);\n+  position: relative;\n }\n \n .navbar a:hover {\n   opacity: 0.8;\n }\n \n-.navbar button {\n-  background-color: #e74c3c;\n-  color: white;\n+.navbar a:focus {\n+  outline: 2px solid var(--color-white);\n+  outline-offset: 4px;\n+  border-radius: var(--radius-sm);\n+}\n+\n+.navbar-user {\n+  color: #ecf0f1;\n+  font-size: 0.9rem;\n+}\n+\n+.navbar-logout-btn {\n+  background-color: var(--color-danger);\n+  color: var(--color-white);\n   border: none;\n   padding: 0.5rem 1rem;\n-  border-radius: 4px;\n+  border-radius: var(--radius-sm);\n   cursor: pointer;\n   font-weight: 500;\n-  transition: background-color 0.2s;\n+  transition: background-color var(--transition-base);\n }\n \n-.navbar button:hover {\n-  background-color: #c0392b;\n+.navbar-logout-btn:hover {\n+  background-color: var(--color-danger-dark);\n }\n \n+/* Mobile Hamburger Button */\n+.navbar-hamburger {\n+  display: none;\n+  background: none;\n+  border: none;\n+  color: var(--color-white);\n+  cursor: pointer;\n+  padding: 0.5rem;\n+  z-index: 1001;\n+}\n+\n+.navbar-hamburger:focus {\n+  outline: 2px solid var(--color-white);\n+  outline-offset: 2px;\n+  border-radius: var(--radius-sm);\n+}\n+\n+/* Mobile Menu */\n+.navbar-mobile-backdrop {\n+  position: fixed;\n+  top: 0;\n+  left: 0;\n+  right: 0;\n+  bottom: 0;\n+  background-color: rgba(0, 0, 0, 0.5);\n+  z-index: 999;\n+}\n+\n+.navbar-mobile-menu {\n+  position: fixed;\n+  top: 0;\n+  right: 0;\n+  bottom: 0;\n+  width: 280px;\n+  max-width: 85vw;\n+  background-color: var(--color-white);\n+  box-shadow: var(--shadow-xl);\n+  z-index: 1000;\n+  padding: 2rem 1.5rem;\n+  display: flex;\n+  flex-direction: column;\n+  gap: 1rem;\n+  overflow-y: auto;\n+}\n+\n+.navbar-mobile-user {\n+  padding: 1rem;\n+  background-color: var(--color-bg);\n+  border-radius: var(--radius-md);\n+  font-weight: 600;\n+  color: var(--color-text);\n+  margin-bottom: 0.5rem;\n+}\n+\n+.navbar-mobile-menu a {\n+  color: var(--color-text);\n+  text-decoration: none;\n+  font-weight: 500;\n+  padding: 0.75rem 1rem;\n+  border-radius: var(--radius-sm);\n+  transition: background-color var(--transition-base);\n+}\n+\n+.navbar-mobile-menu a:hover,\n+.navbar-mobile-menu a:focus {\n+  background-color: var(--color-bg);\n+}\n+\n+.navbar-mobile-logout {\n+  margin-top: auto;\n+  background-color: var(--color-danger);\n+  color: var(--color-white);\n+  border: none;\n+  padding: 0.75rem 1rem;\n+  border-radius: var(--radius-sm);\n+  cursor: pointer;\n+  font-weight: 500;\n+  transition: background-color var(--transition-base);\n+}\n+\n+.navbar-mobile-logout:hover {\n+  background-color: var(--color-danger-dark);\n+}\n+\n /* Container */\n .container {\n   max-width: 1200px;\n   margin: 2rem auto;\n@@ -118,10 +264,11 @@\n \n .form-group input:focus,\n .form-group textarea:focus,\n .form-group select:focus {\n-  outline: none;\n-  border-color: #3498db;\n+  outline: 2px solid var(--color-primary);\n+  outline-offset: 0;\n+  border-color: var(--color-primary);\n }\n \n .form-group textarea {\n   resize: vertical;\n@@ -412,17 +559,24 @@\n }\n \n /* Responsive */\n @media (max-width: 768px) {\n-  .navbar-container {\n-    flex-direction: column;\n-    gap: 1rem;\n+  .navbar-links {\n+    display: none;\n   }\n \n+  .navbar-hamburger {\n+    display: block;\n+  }\n+\n   .projects-grid {\n     grid-template-columns: 1fr;\n   }\n \n   .filters-row {\n     grid-template-columns: 1fr;\n   }\n+\n+  .container {\n+    padding: 0 0.75rem;\n+  }\n }\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\Register.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\ProjectDetail.jsx": {
      "diff": "Index: client\\src\\pages\\ProjectDetail.jsx\n===================================================================\n--- client\\src\\pages\\ProjectDetail.jsx\n+++ client\\src\\pages\\ProjectDetail.jsx\n@@ -1,8 +1,11 @@\n import React, { useState, useEffect } from 'react';\n import { useParams, useNavigate } from 'react-router-dom';\n+import toast from 'react-hot-toast';\n import { projectsAPI, proposalsAPI } from '../services/api';\n import { useAuth } from '../context/AuthContext';\n+import SkeletonDetail from '../components/ui/SkeletonDetail';\n+import Button from '../components/ui/Button';\n \n const ProjectDetail = () => {\n   const { id } = useParams();\n   const [project, setProject] = useState(null);\n@@ -60,8 +63,9 @@\n         cover_letter: proposalData.cover_letter,\n       };\n \n       await proposalsAPI.create(data);\n+      toast.success('Proposal submitted successfully!');\n       setSuccess('Proposal submitted successfully!');\n       setShowProposalForm(false);\n       setProposalData({\n         bid_amount: '',\n@@ -80,9 +84,9 @@\n \n   if (loading) {\n     return (\n       <div className=\"container\">\n-        <div className=\"loading\">Loading project...</div>\n+        <SkeletonDetail />\n       </div>\n     );\n   }\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\Profile.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\MyProposals.jsx": {
      "diff": "Index: client\\src\\pages\\MyProposals.jsx\n===================================================================\n--- client\\src\\pages\\MyProposals.jsx\n+++ client\\src\\pages\\MyProposals.jsx\n@@ -1,15 +1,21 @@\n import React, { useState, useEffect } from 'react';\n import { useNavigate } from 'react-router-dom';\n+import toast from 'react-hot-toast';\n import { proposalsAPI } from '../services/api';\n import { useAuth } from '../context/AuthContext';\n+import { useConfirm } from '../context/ConfirmContext';\n+import Button from '../components/ui/Button';\n+import SkeletonCard from '../components/ui/SkeletonCard';\n \n const MyProposals = () => {\n   const [proposals, setProposals] = useState([]);\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState('');\n+  const [actionLoading, setActionLoading] = useState({});\n   const { user, isFreelancer } = useAuth();\n   const navigate = useNavigate();\n+  const { confirm } = useConfirm();\n \n   useEffect(() => {\n     if (!isFreelancer) {\n       navigate('/');\n@@ -34,25 +40,37 @@\n     }\n   };\n \n   const handleWithdraw = async (proposalId) => {\n-    if (!window.confirm('Are you sure you want to withdraw this proposal?')) {\n-      return;\n-    }\n+    const confirmed = await confirm({\n+      title: 'Withdraw Proposal',\n+      message: 'Are you sure you want to withdraw this proposal? This action cannot be undone.',\n+      confirmText: 'Withdraw',\n+      variant: 'danger'\n+    });\n \n+    if (!confirmed) return;\n+\n+    setActionLoading(prev => ({ ...prev, [proposalId]: true }));\n     try {\n       await proposalsAPI.delete(proposalId);\n       setProposals(proposals.filter((p) => p.id !== proposalId));\n+      toast.success('Proposal withdrawn successfully!');\n     } catch (err) {\n-      alert('Failed to withdraw proposal');\n+      toast.error('Failed to withdraw proposal');\n       console.error(err);\n+    } finally {\n+      setActionLoading(prev => ({ ...prev, [proposalId]: false }));\n     }\n   };\n \n   if (loading) {\n     return (\n       <div className=\"container\">\n-        <div className=\"loading\">Loading proposals...</div>\n+        <h1 style={{ marginBottom: '1.5rem' }}>My Proposals</h1>\n+        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\n+          <SkeletonCard count={3} />\n+        </div>\n       </div>\n     );\n   }\n \n@@ -119,11 +137,15 @@\n                   </p>\n                 </div>\n \n                 {proposal.status === 'pending' && (\n-                  <button onClick={() => handleWithdraw(proposal.id)} className=\"btn btn-danger\">\n+                  <Button\n+                    onClick={() => handleWithdraw(proposal.id)}\n+                    variant=\"danger\"\n+                    loading={actionLoading[proposal.id]}\n+                  >\n                     Withdraw\n-                  </button>\n+                  </Button>\n                 )}\n               </div>\n             </div>\n           ))}\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\MyProjects.jsx": {
      "diff": "Index: client\\src\\pages\\MyProjects.jsx\n===================================================================\n--- client\\src\\pages\\MyProjects.jsx\n+++ client\\src\\pages\\MyProjects.jsx\n@@ -1,18 +1,25 @@\n import React, { useState, useEffect } from 'react';\n import { useNavigate } from 'react-router-dom';\n+import toast from 'react-hot-toast';\n import { projectsAPI, proposalsAPI } from '../services/api';\n import { useAuth } from '../context/AuthContext';\n+import { useConfirm } from '../context/ConfirmContext';\n+import Button from '../components/ui/Button';\n+import Modal from '../components/ui/Modal';\n+import SkeletonCard from '../components/ui/SkeletonCard';\n \n const MyProjects = () => {\n   const [projects, setProjects] = useState([]);\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState('');\n   const [selectedProject, setSelectedProject] = useState(null);\n   const [proposals, setProposals] = useState([]);\n   const [filterStatus, setFilterStatus] = useState('all');\n+  const [actionLoading, setActionLoading] = useState({});\n   const { user, isClient } = useAuth();\n   const navigate = useNavigate();\n+  const { confirm } = useConfirm();\n \n   useEffect(() => {\n     if (!isClient) {\n       navigate('/');\n@@ -52,74 +59,113 @@\n     fetchProposals(project.id);\n   };\n \n   const handleAcceptProposal = async (proposalId) => {\n-    if (!window.confirm('Are you sure you want to accept this proposal? This will reject all other proposals, mark the project as awarded, and create a contract.')) {\n-      return;\n-    }\n+    const confirmed = await confirm({\n+      title: 'Accept Proposal',\n+      message: 'Are you sure you want to accept this proposal? This will reject all other proposals, mark the project as awarded, and create a contract.',\n+      confirmText: 'Accept',\n+      variant: 'success'\n+    });\n \n+    if (!confirmed) return;\n+\n+    setActionLoading(prev => ({ ...prev, [proposalId]: true }));\n     try {\n       const response = await proposalsAPI.accept(proposalId);\n       const { contract } = response.data.data;\n-      \n-      alert(`Proposal accepted successfully!\\n\\nA contract has been created and is now active.\\nContract ID: ${contract.id}`);\n-      \n+\n+      toast.success('Proposal accepted successfully! Contract has been created.');\n+\n       fetchProposals(selectedProject.id);\n       fetchProjects();\n-      \n-      // Optionally navigate to the contract\n-      if (window.confirm('Would you like to view the contract now?')) {\n+\n+      // Ask if they want to view the contract\n+      const viewContract = await confirm({\n+        title: 'View Contract',\n+        message: 'Would you like to view the contract now?',\n+        confirmText: 'View Contract',\n+        variant: 'primary'\n+      });\n+\n+      if (viewContract) {\n         navigate(`/contracts/${contract.id}`);\n       }\n     } catch (err) {\n-      alert(err.response?.data?.message || 'Failed to accept proposal');\n+      toast.error(err.response?.data?.message || 'Failed to accept proposal');\n       console.error(err);\n+    } finally {\n+      setActionLoading(prev => ({ ...prev, [proposalId]: false }));\n     }\n   };\n \n   const handleRejectProposal = async (proposalId) => {\n-    if (!window.confirm('Are you sure you want to reject this proposal?')) {\n-      return;\n-    }\n+    const confirmed = await confirm({\n+      title: 'Reject Proposal',\n+      message: 'Are you sure you want to reject this proposal?',\n+      confirmText: 'Reject',\n+      variant: 'danger'\n+    });\n \n+    if (!confirmed) return;\n+\n+    setActionLoading(prev => ({ ...prev, [`reject-${proposalId}`]: true }));\n     try {\n       await proposalsAPI.reject(proposalId);\n-      alert('Proposal rejected successfully!');\n+      toast.success('Proposal rejected successfully!');\n       fetchProposals(selectedProject.id);\n     } catch (err) {\n-      alert(err.response?.data?.message || 'Failed to reject proposal');\n+      toast.error(err.response?.data?.message || 'Failed to reject proposal');\n       console.error(err);\n+    } finally {\n+      setActionLoading(prev => ({ ...prev, [`reject-${proposalId}`]: false }));\n     }\n   };\n \n   const handleShortlistProposal = async (proposalId) => {\n+    setActionLoading(prev => ({ ...prev, [`shortlist-${proposalId}`]: true }));\n     try {\n       await proposalsAPI.update(proposalId, { status: 'shortlisted' });\n+      toast.success('Proposal shortlisted!');\n       fetchProposals(selectedProject.id);\n     } catch (err) {\n-      alert('Failed to shortlist proposal');\n+      toast.error('Failed to shortlist proposal');\n       console.error(err);\n+    } finally {\n+      setActionLoading(prev => ({ ...prev, [`shortlist-${proposalId}`]: false }));\n     }\n   };\n \n   const handleDeleteProject = async (projectId) => {\n-    if (!window.confirm('Are you sure you want to delete this project?')) {\n-      return;\n-    }\n+    const confirmed = await confirm({\n+      title: 'Delete Project',\n+      message: 'Are you sure you want to delete this project? This action cannot be undone.',\n+      confirmText: 'Delete',\n+      variant: 'danger'\n+    });\n \n+    if (!confirmed) return;\n+\n+    setActionLoading(prev => ({ ...prev, [`delete-${projectId}`]: true }));\n     try {\n       await projectsAPI.delete(projectId);\n       setProjects(projects.filter((p) => p.id !== projectId));\n+      toast.success('Project deleted successfully!');\n     } catch (err) {\n-      alert('Failed to delete project');\n+      toast.error('Failed to delete project');\n       console.error(err);\n+    } finally {\n+      setActionLoading(prev => ({ ...prev, [`delete-${projectId}`]: false }));\n     }\n   };\n \n   if (loading) {\n     return (\n       <div className=\"container\">\n-        <div className=\"loading\">Loading projects...</div>\n+        <h1 style={{ marginBottom: '1.5rem' }}>My Projects</h1>\n+        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\n+          <SkeletonCard count={3} />\n+        </div>\n       </div>\n     );\n   }\n \n@@ -165,61 +211,38 @@\n                   </div>\n                 </div>\n \n                 <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\n-                  <button onClick={() => handleViewProposals(project)} className=\"btn btn-primary\">\n+                  <Button onClick={() => handleViewProposals(project)} variant=\"primary\">\n                     View Proposals ({project.proposal_count})\n-                  </button>\n-                  <button onClick={() => navigate(`/projects/${project.id}`)} className=\"btn btn-secondary\">\n+                  </Button>\n+                  <Button onClick={() => navigate(`/projects/${project.id}`)} variant=\"secondary\">\n                     View Details\n-                  </button>\n+                  </Button>\n                   {project.status === 'open' && (\n-                    <button onClick={() => handleDeleteProject(project.id)} className=\"btn btn-danger\">\n+                    <Button\n+                      onClick={() => handleDeleteProject(project.id)}\n+                      variant=\"danger\"\n+                      loading={actionLoading[`delete-${project.id}`]}\n+                    >\n                       Delete\n-                    </button>\n+                    </Button>\n                   )}\n                 </div>\n               </div>\n             </div>\n           ))}\n         </div>\n       )}\n \n-      {selectedProject && (\n-        <div\n-          style={{\n-            position: 'fixed',\n-            top: 0,\n-            left: 0,\n-            right: 0,\n-            bottom: 0,\n-            backgroundColor: 'rgba(0,0,0,0.5)',\n-            display: 'flex',\n-            alignItems: 'center',\n-            justifyContent: 'center',\n-            padding: '1rem',\n-            zIndex: 1000,\n-          }}\n-          onClick={() => setSelectedProject(null)}\n-        >\n-          <div\n-            style={{\n-              backgroundColor: 'white',\n-              borderRadius: '8px',\n-              padding: '2rem',\n-              maxWidth: '800px',\n-              width: '100%',\n-              maxHeight: '80vh',\n-              overflow: 'auto',\n-            }}\n-            onClick={(e) => e.stopPropagation()}\n-          >\n-            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n-              <h2>Proposals for \"{selectedProject.title}\"</h2>\n-              <button onClick={() => setSelectedProject(null)} className=\"btn btn-secondary\">\n-                Close\n-              </button>\n-            </div>\n+      <Modal\n+        isOpen={!!selectedProject}\n+        onClose={() => setSelectedProject(null)}\n+        title={selectedProject ? `Proposals for \"${selectedProject.title}\"` : ''}\n+        maxWidth=\"800px\"\n+      >\n+        {selectedProject && (\n+          <div>\n \n             <div style={{ marginBottom: '1rem', display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>\n               <button \n                 onClick={() => setFilterStatus('all')} \n@@ -312,30 +335,33 @@\n                       </div>\n \n                       {(proposal.status === 'submitted' || proposal.status === 'shortlisted') && (\n                         <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', minWidth: '120px' }}>\n-                          <button \n-                            onClick={() => handleAcceptProposal(proposal.id)} \n-                            className=\"btn btn-success\"\n+                          <Button\n+                            onClick={() => handleAcceptProposal(proposal.id)}\n+                            variant=\"success\"\n+                            loading={actionLoading[proposal.id]}\n                             style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}\n                           >\n                             ✓ Accept\n-                          </button>\n-                          <button \n-                            onClick={() => handleRejectProposal(proposal.id)} \n-                            className=\"btn btn-danger\"\n+                          </Button>\n+                          <Button\n+                            onClick={() => handleRejectProposal(proposal.id)}\n+                            variant=\"danger\"\n+                            loading={actionLoading[`reject-${proposal.id}`]}\n                             style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}\n                           >\n                             ✗ Reject\n-                          </button>\n+                          </Button>\n                           {proposal.status === 'submitted' && (\n-                            <button \n-                              onClick={() => handleShortlistProposal(proposal.id)} \n-                              className=\"btn btn-secondary\"\n+                            <Button\n+                              onClick={() => handleShortlistProposal(proposal.id)}\n+                              variant=\"secondary\"\n+                              loading={actionLoading[`shortlist-${proposal.id}`]}\n                               style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}\n                             >\n                               ⭐ Shortlist\n-                            </button>\n+                            </Button>\n                           )}\n                         </div>\n                       )}\n                       {proposal.status === 'accepted' && (\n@@ -367,10 +393,10 @@\n                 ))}\n               </div>\n             )}\n           </div>\n-        </div>\n-      )}\n+        )}\n+      </Modal>\n     </div>\n   );\n };\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\MyContracts.jsx": {
      "diff": "Index: client\\src\\pages\\MyContracts.jsx\n===================================================================\n--- client\\src\\pages\\MyContracts.jsx\n+++ client\\src\\pages\\MyContracts.jsx\n@@ -1,16 +1,22 @@\n import React, { useState, useEffect } from 'react';\r\n import { useNavigate } from 'react-router-dom';\r\n+import toast from 'react-hot-toast';\r\n import { contractsAPI } from '../services/api';\r\n import { useAuth } from '../context/AuthContext';\r\n+import { useConfirm } from '../context/ConfirmContext';\r\n+import Button from '../components/ui/Button';\r\n+import SkeletonCard from '../components/ui/SkeletonCard';\r\n \r\n const MyContracts = () => {\r\n   const [contracts, setContracts] = useState([]);\r\n   const [loading, setLoading] = useState(true);\r\n   const [error, setError] = useState('');\r\n   const [filterStatus, setFilterStatus] = useState('all');\r\n+  const [actionLoading, setActionLoading] = useState({});\r\n   const { user } = useAuth();\r\n   const navigate = useNavigate();\r\n+  const { confirm } = useConfirm();\r\n \r\n   useEffect(() => {\r\n     fetchContracts();\r\n   }, []);\r\n@@ -37,16 +43,42 @@\n     };\r\n     return styles[status] || {};\r\n   };\r\n \r\n+  const handleMarkComplete = async (contractId) => {\r\n+    const confirmed = await confirm({\r\n+      title: 'Mark Contract Complete',\r\n+      message: 'Are you sure you want to mark this contract as completed?',\r\n+      confirmText: 'Mark Complete',\r\n+      variant: 'success'\r\n+    });\r\n+\r\n+    if (!confirmed) return;\r\n+\r\n+    setActionLoading(prev => ({ ...prev, [contractId]: true }));\r\n+    try {\r\n+      await contractsAPI.update(contractId, { status: 'completed' });\r\n+      toast.success('Contract marked as completed!');\r\n+      fetchContracts();\r\n+    } catch (err) {\r\n+      toast.error('Failed to update contract');\r\n+      console.error(err);\r\n+    } finally {\r\n+      setActionLoading(prev => ({ ...prev, [contractId]: false }));\r\n+    }\r\n+  };\r\n+\r\n   const filteredContracts = contracts.filter(\r\n     (contract) => filterStatus === 'all' || contract.status === filterStatus\r\n   );\r\n \r\n   if (loading) {\r\n     return (\r\n       <div className=\"container\">\r\n-        <div className=\"loading\">Loading contracts...</div>\r\n+        <h1 style={{ marginBottom: '1.5rem' }}>My Contracts</h1>\r\n+        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n+          <SkeletonCard count={3} />\r\n+        </div>\r\n       </div>\r\n     );\r\n   }\r\n \r\n@@ -161,28 +193,23 @@\n                   </div>\r\n                 </div>\r\n \r\n                 <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n-                  <button\r\n+                  <Button\r\n                     onClick={() => navigate(`/contracts/${contract.id}`)}\r\n-                    className=\"btn btn-primary\"\r\n+                    variant=\"primary\"\r\n                   >\r\n                     View Details\r\n-                  </button>\r\n+                  </Button>\r\n                   {contract.status === 'active' && (\r\n-                    <button\r\n-                      onClick={() => {\r\n-                        if (window.confirm('Mark this contract as completed?')) {\r\n-                          contractsAPI.update(contract.id, { status: 'completed' })\r\n-                            .then(() => fetchContracts())\r\n-                            .catch(err => alert('Failed to update contract'));\r\n-                        }\r\n-                      }}\r\n-                      className=\"btn btn-success\"\r\n+                    <Button\r\n+                      onClick={() => handleMarkComplete(contract.id)}\r\n+                      variant=\"success\"\r\n+                      loading={actionLoading[contract.id]}\r\n                       style={{ fontSize: '0.875rem' }}\r\n                     >\r\n                       Mark Complete\r\n-                    </button>\r\n+                    </Button>\r\n                   )}\r\n                 </div>\r\n               </div>\r\n             </div>\r\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\pages\\Login.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\components\\Navbar.jsx": {
      "diff": "Index: client\\src\\components\\Navbar.jsx\n===================================================================\n--- client\\src\\components\\Navbar.jsx\n+++ client\\src\\components\\Navbar.jsx\n@@ -1,44 +1,141 @@\n-import React from 'react';\n-import { Link, useNavigate } from 'react-router-dom';\n+import React, { useState, useEffect } from 'react';\n+import { Link, useNavigate, useLocation } from 'react-router-dom';\n+import { motion, AnimatePresence } from 'framer-motion';\n import { useAuth } from '../context/AuthContext';\n \n const Navbar = () => {\n   const { user, logout, isAuthenticated, isFreelancer, isClient } = useAuth();\n   const navigate = useNavigate();\n+  const location = useLocation();\n+  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n \n   const handleLogout = () => {\n     logout();\n     navigate('/login');\n+    setMobileMenuOpen(false);\n   };\n \n+  // Close mobile menu on route change\n+  useEffect(() => {\n+    setMobileMenuOpen(false);\n+  }, [location.pathname]);\n+\n+  // Close mobile menu on ESC key\n+  useEffect(() => {\n+    const handleEscape = (e) => {\n+      if (e.key === 'Escape') {\n+        setMobileMenuOpen(false);\n+      }\n+    };\n+\n+    if (mobileMenuOpen) {\n+      document.addEventListener('keydown', handleEscape);\n+      // Prevent body scroll on mobile\n+      document.body.style.overflow = 'hidden';\n+      return () => {\n+        document.removeEventListener('keydown', handleEscape);\n+        document.body.style.overflow = 'unset';\n+      };\n+    }\n+  }, [mobileMenuOpen]);\n+\n   return (\n     <nav className=\"navbar\">\n       <div className=\"navbar-container\">\n         <h1 onClick={() => navigate('/')} style={{ cursor: 'pointer' }}>\n           Freelance Platform\n         </h1>\n-        <div style={{ display: 'flex', gap: '1.5rem', alignItems: 'center' }}>\n+\n+        {/* Desktop Navigation */}\n+        <div className=\"navbar-links\">\n           {isAuthenticated ? (\n             <>\n               <Link to=\"/\">Projects</Link>\n               {isFreelancer && <Link to=\"/my-proposals\">My Proposals</Link>}\n               {isClient && <Link to=\"/my-projects\">My Projects</Link>}\n               <Link to=\"/contracts\">Contracts</Link>\n               <Link to=\"/profile\">Profile</Link>\n-              <span style={{ color: '#ecf0f1' }}>\n+              <span className=\"navbar-user\">\n                 {user.first_name} ({user.role})\n               </span>\n-              <button onClick={handleLogout}>Logout</button>\n+              <button onClick={handleLogout} className=\"navbar-logout-btn\">Logout</button>\n             </>\n           ) : (\n             <>\n               <Link to=\"/login\">Login</Link>\n               <Link to=\"/register\">Register</Link>\n             </>\n           )}\n         </div>\n+\n+        {/* Mobile Hamburger Button */}\n+        <button\n+          className=\"navbar-hamburger\"\n+          onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n+          aria-label=\"Toggle menu\"\n+          aria-expanded={mobileMenuOpen}\n+        >\n+          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n+            {mobileMenuOpen ? (\n+              <>\n+                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n+                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n+              </>\n+            ) : (\n+              <>\n+                <line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"></line>\n+                <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n+                <line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"></line>\n+              </>\n+            )}\n+          </svg>\n+        </button>\n       </div>\n+\n+      {/* Mobile Menu */}\n+      <AnimatePresence>\n+        {mobileMenuOpen && (\n+          <>\n+            {/* Backdrop */}\n+            <motion.div\n+              className=\"navbar-mobile-backdrop\"\n+              initial={{ opacity: 0 }}\n+              animate={{ opacity: 1 }}\n+              exit={{ opacity: 0 }}\n+              onClick={() => setMobileMenuOpen(false)}\n+            />\n+\n+            {/* Mobile Menu Panel */}\n+            <motion.div\n+              className=\"navbar-mobile-menu\"\n+              initial={{ x: '100%' }}\n+              animate={{ x: 0 }}\n+              exit={{ x: '100%' }}\n+              transition={{ type: 'tween', duration: 0.3 }}\n+            >\n+              {isAuthenticated ? (\n+                <>\n+                  <div className=\"navbar-mobile-user\">\n+                    {user.first_name} ({user.role})\n+                  </div>\n+                  <Link to=\"/\" onClick={() => setMobileMenuOpen(false)}>Projects</Link>\n+                  {isFreelancer && <Link to=\"/my-proposals\" onClick={() => setMobileMenuOpen(false)}>My Proposals</Link>}\n+                  {isClient && <Link to=\"/my-projects\" onClick={() => setMobileMenuOpen(false)}>My Projects</Link>}\n+                  <Link to=\"/contracts\" onClick={() => setMobileMenuOpen(false)}>Contracts</Link>\n+                  <Link to=\"/profile\" onClick={() => setMobileMenuOpen(false)}>Profile</Link>\n+                  <button onClick={handleLogout} className=\"navbar-mobile-logout\">Logout</button>\n+                </>\n+              ) : (\n+                <>\n+                  <Link to=\"/login\" onClick={() => setMobileMenuOpen(false)}>Login</Link>\n+                  <Link to=\"/register\" onClick={() => setMobileMenuOpen(false)}>Register</Link>\n+                </>\n+              )}\n+            </motion.div>\n+          </>\n+        )}\n+      </AnimatePresence>\n     </nav>\n   );\n };\n \n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\components\\ui\\Button.jsx": {
      "content": "import React from 'react';\r\nimport LoadingSpinner from './LoadingSpinner';\r\nimport './Button.css';\r\n\r\nconst Button = ({\r\n  children,\r\n  onClick,\r\n  variant = 'primary',\r\n  loading = false,\r\n  disabled = false,\r\n  type = 'button',\r\n  className = '',\r\n  ...props\r\n}) => {\r\n  const buttonClass = `btn btn-${variant} ${loading ? 'btn-loading' : ''} ${className}`;\r\n\r\n  return (\r\n    <button\r\n      type={type}\r\n      className={buttonClass}\r\n      onClick={onClick}\r\n      disabled={disabled || loading}\r\n      {...props}\r\n    >\r\n      {loading && (\r\n        <span className=\"btn-spinner\">\r\n          <LoadingSpinner size=\"small\" color={variant === 'secondary' ? '#666' : '#fff'} />\r\n        </span>\r\n      )}\r\n      <span className={loading ? 'btn-content-loading' : ''}>\r\n        {children}\r\n      </span>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default Button;\r\n"
    },
    "client\\src\\components\\ui\\Button.css": {
      "content": ".btn {\r\n  position: relative;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.btn-loading {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.btn-spinner {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.btn-content-loading {\r\n  opacity: 0.7;\r\n}\r\n\r\n.btn:disabled {\r\n  opacity: 0.6;\r\n  cursor: not-allowed;\r\n}\r\n"
    },
    "client\\src\\components\\ui\\ConfirmDialog.css": {
      "content": ".confirm-dialog {\r\n  text-align: center;\r\n  padding: 1rem 0;\r\n}\r\n\r\n.confirm-icon {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n.confirm-title {\r\n  margin: 0 0 1rem 0;\r\n  color: #2c3e50;\r\n  font-size: 1.5rem;\r\n}\r\n\r\n.confirm-message {\r\n  color: #666;\r\n  margin: 0 0 2rem 0;\r\n  line-height: 1.5;\r\n}\r\n\r\n.confirm-actions {\r\n  display: flex;\r\n  gap: 1rem;\r\n  justify-content: center;\r\n}\r\n\r\n.confirm-actions .btn {\r\n  min-width: 100px;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .confirm-actions {\r\n    flex-direction: column-reverse;\r\n  }\r\n\r\n  .confirm-actions .btn {\r\n    width: 100%;\r\n  }\r\n}\r\n"
    },
    "client\\src\\context\\ConfirmContext.jsx": {
      "content": "import React, { createContext, useContext, useState, useCallback } from 'react';\r\nimport ConfirmDialog from '../components/ui/ConfirmDialog';\r\n\r\nconst ConfirmContext = createContext();\r\n\r\nexport const useConfirm = () => {\r\n  const context = useContext(ConfirmContext);\r\n  if (!context) {\r\n    throw new Error('useConfirm must be used within ConfirmProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ConfirmProvider = ({ children }) => {\r\n  const [confirmState, setConfirmState] = useState({\r\n    isOpen: false,\r\n    title: '',\r\n    message: '',\r\n    confirmText: 'Confirm',\r\n    cancelText: 'Cancel',\r\n    variant: 'danger',\r\n    resolve: null,\r\n  });\r\n\r\n  const confirm = useCallback(({\r\n    title = 'Confirm Action',\r\n    message,\r\n    confirmText = 'Confirm',\r\n    cancelText = 'Cancel',\r\n    variant = 'danger'\r\n  }) => {\r\n    return new Promise((resolve) => {\r\n      setConfirmState({\r\n        isOpen: true,\r\n        title,\r\n        message,\r\n        confirmText,\r\n        cancelText,\r\n        variant,\r\n        resolve,\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  const handleConfirm = useCallback(() => {\r\n    setConfirmState((prev) => {\r\n      if (prev.resolve) prev.resolve(true);\r\n      return { ...prev, isOpen: false };\r\n    });\r\n  }, []);\r\n\r\n  const handleCancel = useCallback(() => {\r\n    setConfirmState((prev) => {\r\n      if (prev.resolve) prev.resolve(false);\r\n      return { ...prev, isOpen: false };\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <ConfirmContext.Provider value={{ confirm }}>\r\n      {children}\r\n      <ConfirmDialog\r\n        isOpen={confirmState.isOpen}\r\n        title={confirmState.title}\r\n        message={confirmState.message}\r\n        confirmText={confirmState.confirmText}\r\n        cancelText={confirmState.cancelText}\r\n        variant={confirmState.variant}\r\n        onConfirm={handleConfirm}\r\n        onCancel={handleCancel}\r\n      />\r\n    </ConfirmContext.Provider>\r\n  );\r\n};\r\n"
    },
    "client\\src\\context\\AuthContext.jsx": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\App.jsx": {
      "diff": "Index: client\\src\\App.jsx\n===================================================================\n--- client\\src\\App.jsx\n+++ client\\src\\App.jsx\n@@ -1,7 +1,9 @@\n import React from 'react';\n import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\n+import { Toaster } from 'react-hot-toast';\n import { AuthProvider, useAuth } from './context/AuthContext';\n+import { ConfirmProvider } from './context/ConfirmContext';\n import Navbar from './components/Navbar';\n import Login from './pages/Login';\n import Register from './pages/Register';\n import Dashboard from './pages/Dashboard';\n@@ -99,9 +101,36 @@\n function App() {\n   return (\n     <Router>\n       <AuthProvider>\n-        <AppRoutes />\n+        <ConfirmProvider>\n+          <Toaster\n+            position=\"top-right\"\n+            toastOptions={{\n+              duration: 4000,\n+              style: {\n+                background: '#fff',\n+                color: '#333',\n+                boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n+                borderRadius: '8px',\n+                padding: '1rem',\n+              },\n+              success: {\n+                iconTheme: {\n+                  primary: '#27ae60',\n+                  secondary: '#fff',\n+                },\n+              },\n+              error: {\n+                iconTheme: {\n+                  primary: '#e74c3c',\n+                  secondary: '#fff',\n+                },\n+              },\n+            }}\n+          />\n+          <AppRoutes />\n+        </ConfirmProvider>\n       </AuthProvider>\n     </Router>\n   );\n }\n",
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\src\\components\\ui\\SkeletonDetail.jsx": {
      "content": "import React from 'react';\r\nimport Skeleton from 'react-loading-skeleton';\r\nimport 'react-loading-skeleton/dist/skeleton.css';\r\n\r\nconst SkeletonDetail = () => {\r\n  return (\r\n    <div className=\"card\">\r\n      <Skeleton height={32} width=\"60%\" style={{ marginBottom: '1rem' }} />\r\n      <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem' }}>\r\n        <Skeleton height={24} width={100} style={{ borderRadius: '12px' }} />\r\n        <Skeleton height={24} width={80} style={{ borderRadius: '12px' }} />\r\n      </div>\r\n      <Skeleton count={5} style={{ marginTop: '0.5rem' }} />\r\n\r\n      <div style={{ marginTop: '2rem' }}>\r\n        <Skeleton height={24} width={150} style={{ marginBottom: '1rem' }} />\r\n        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>\r\n          <Skeleton height={24} width={70} style={{ borderRadius: '12px' }} />\r\n          <Skeleton height={24} width={90} style={{ borderRadius: '12px' }} />\r\n          <Skeleton height={24} width={60} style={{ borderRadius: '12px' }} />\r\n          <Skeleton height={24} width={80} style={{ borderRadius: '12px' }} />\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ marginTop: '2rem' }}>\r\n        <Skeleton height={24} width={120} style={{ marginBottom: '0.5rem' }} />\r\n        <Skeleton count={2} />\r\n      </div>\r\n\r\n      <div style={{ marginTop: '2rem', display: 'flex', gap: '1rem' }}>\r\n        <Skeleton height={40} width={120} />\r\n        <Skeleton height={40} width={100} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SkeletonDetail;\r\n"
    },
    "client\\src\\components\\ui\\SkeletonCard.jsx": {
      "content": "import React from 'react';\r\nimport Skeleton from 'react-loading-skeleton';\r\nimport 'react-loading-skeleton/dist/skeleton.css';\r\n\r\nconst SkeletonCard = ({ count = 1 }) => {\r\n  return (\r\n    <>\r\n      {[...Array(count)].map((_, index) => (\r\n        <div key={index} className=\"project-card\">\r\n          <Skeleton height={24} width=\"70%\" style={{ marginBottom: '0.5rem' }} />\r\n          <Skeleton height={20} width={80} style={{ borderRadius: '12px', marginBottom: '0.5rem' }} />\r\n          <Skeleton count={3} style={{ marginTop: '0.5rem' }} />\r\n          <Skeleton height={20} width={60} style={{ marginTop: '0.5rem', borderRadius: '12px' }} />\r\n          <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\r\n            <Skeleton width={120} />\r\n            <Skeleton width={100} />\r\n          </div>\r\n          <div style={{ display: 'flex', gap: '0.5rem', marginTop: '1rem', flexWrap: 'wrap' }}>\r\n            <Skeleton height={24} width={70} style={{ borderRadius: '12px' }} />\r\n            <Skeleton height={24} width={90} style={{ borderRadius: '12px' }} />\r\n            <Skeleton height={24} width={60} style={{ borderRadius: '12px' }} />\r\n          </div>\r\n          <Skeleton width=\"50%\" style={{ marginTop: '0.5rem' }} />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SkeletonCard;\r\n"
    },
    "client\\src\\components\\ui\\Modal.jsx": {
      "content": "import React, { useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport './Modal.css';\r\n\r\nconst Modal = ({\r\n  isOpen,\r\n  onClose,\r\n  title,\r\n  children,\r\n  maxWidth = '600px',\r\n  showCloseButton = true\r\n}) => {\r\n  const modalRef = useRef(null);\r\n  const previousActiveElement = useRef(null);\r\n\r\n  // Handle ESC key\r\n  useEffect(() => {\r\n    const handleEscape = (e) => {\r\n      if (e.key === 'Escape' && isOpen) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleEscape);\r\n      // Prevent body scroll\r\n      document.body.style.overflow = 'hidden';\r\n      // Store previously focused element\r\n      previousActiveElement.current = document.activeElement;\r\n\r\n      return () => {\r\n        document.removeEventListener('keydown', handleEscape);\r\n        document.body.style.overflow = 'unset';\r\n        // Restore focus\r\n        if (previousActiveElement.current) {\r\n          previousActiveElement.current.focus();\r\n        }\r\n      };\r\n    }\r\n  }, [isOpen, onClose]);\r\n\r\n  // Focus trap\r\n  useEffect(() => {\r\n    if (!isOpen || !modalRef.current) return;\r\n\r\n    const focusableElements = modalRef.current.querySelectorAll(\r\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n    );\r\n    const firstElement = focusableElements[0];\r\n    const lastElement = focusableElements[focusableElements.length - 1];\r\n\r\n    const handleTab = (e) => {\r\n      if (e.key !== 'Tab') return;\r\n\r\n      if (e.shiftKey) {\r\n        if (document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement.focus();\r\n        }\r\n      } else {\r\n        if (document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement.focus();\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleTab);\r\n    // Focus first element\r\n    firstElement?.focus();\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleTab);\r\n    };\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <div className=\"modal-overlay\" onClick={onClose} role=\"presentation\">\r\n          <motion.div\r\n            ref={modalRef}\r\n            className=\"modal-content\"\r\n            style={{ maxWidth }}\r\n            onClick={(e) => e.stopPropagation()}\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            transition={{ duration: 0.2 }}\r\n            role=\"dialog\"\r\n            aria-modal=\"true\"\r\n            aria-labelledby={title ? \"modal-title\" : undefined}\r\n          >\r\n            {(title || showCloseButton) && (\r\n              <div className=\"modal-header\">\r\n                {title && <h2 id=\"modal-title\">{title}</h2>}\r\n                {showCloseButton && (\r\n                  <button\r\n                    onClick={onClose}\r\n                    className=\"modal-close\"\r\n                    aria-label=\"Close modal\"\r\n                  >\r\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                      <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                      <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                    </svg>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"modal-body\">\r\n              {children}\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default Modal;\r\n"
    },
    "client\\src\\components\\ui\\Modal.css": {
      "content": ".modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 1rem;\r\n  z-index: 1000;\r\n  backdrop-filter: blur(2px);\r\n}\r\n\r\n.modal-content {\r\n  background: white;\r\n  border-radius: 8px;\r\n  width: 100%;\r\n  max-height: 90vh;\r\n  overflow: auto;\r\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 1.5rem;\r\n  border-bottom: 1px solid #e0e0e0;\r\n}\r\n\r\n.modal-header h2 {\r\n  margin: 0;\r\n  color: #2c3e50;\r\n  font-size: 1.5rem;\r\n}\r\n\r\n.modal-close {\r\n  background: none;\r\n  border: none;\r\n  cursor: pointer;\r\n  padding: 0.5rem;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #666;\r\n  border-radius: 4px;\r\n  transition: background-color 0.2s, color 0.2s;\r\n}\r\n\r\n.modal-close:hover {\r\n  background-color: #f5f5f5;\r\n  color: #333;\r\n}\r\n\r\n.modal-close:focus {\r\n  outline: 2px solid #3498db;\r\n  outline-offset: 2px;\r\n}\r\n\r\n.modal-body {\r\n  padding: 1.5rem;\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 768px) {\r\n  .modal-content {\r\n    max-height: 95vh;\r\n  }\r\n\r\n  .modal-header {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .modal-body {\r\n    padding: 1rem;\r\n  }\r\n}\r\n"
    },
    "client\\src\\components\\ui\\LoadingSpinner.jsx": {
      "content": "import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport './LoadingSpinner.css';\r\n\r\nconst LoadingSpinner = ({ size = 'medium', color = '#3498db' }) => {\r\n  const sizes = {\r\n    small: 16,\r\n    medium: 24,\r\n    large: 40\r\n  };\r\n\r\n  const dimension = sizes[size] || sizes.medium;\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"loading-spinner\"\r\n      style={{ width: dimension, height: dimension }}\r\n      animate={{ rotate: 360 }}\r\n      transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\r\n      aria-label=\"Loading\"\r\n      role=\"status\"\r\n    >\r\n      <svg viewBox=\"0 0 24 24\" fill=\"none\">\r\n        <circle\r\n          cx=\"12\"\r\n          cy=\"12\"\r\n          r=\"10\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth=\"3\"\r\n          strokeLinecap=\"round\"\r\n          style={{ color: '#e0e0e0' }}\r\n        />\r\n        <circle\r\n          cx=\"12\"\r\n          cy=\"12\"\r\n          r=\"10\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth=\"3\"\r\n          strokeLinecap=\"round\"\r\n          strokeDasharray=\"31.4 31.4\"\r\n          strokeDashoffset=\"0\"\r\n          style={{ color }}\r\n        />\r\n      </svg>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default LoadingSpinner;\r\n"
    },
    "client\\src\\components\\ui\\LoadingSpinner.css": {
      "content": ".loading-spinner {\r\n  display: inline-block;\r\n  position: relative;\r\n}\r\n\r\n.loading-spinner svg {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n"
    },
    "client\\src\\components\\ui\\ConfirmDialog.jsx": {
      "content": "import React from 'react';\r\nimport Modal from './Modal';\r\nimport './ConfirmDialog.css';\r\n\r\nconst ConfirmDialog = ({\r\n  isOpen,\r\n  onConfirm,\r\n  onCancel,\r\n  title,\r\n  message,\r\n  confirmText = 'Confirm',\r\n  cancelText = 'Cancel',\r\n  variant = 'danger' // danger, primary, success\r\n}) => {\r\n  return (\r\n    <Modal isOpen={isOpen} onClose={onCancel} maxWidth=\"500px\" showCloseButton={false}>\r\n      <div className=\"confirm-dialog\">\r\n        <div className=\"confirm-icon\">\r\n          {variant === 'danger' && (\r\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#e74c3c\" strokeWidth=\"2\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n              <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\r\n              <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\r\n            </svg>\r\n          )}\r\n          {variant === 'primary' && (\r\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#3498db\" strokeWidth=\"2\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n              <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\r\n              <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\r\n            </svg>\r\n          )}\r\n          {variant === 'success' && (\r\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#27ae60\" strokeWidth=\"2\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n              <polyline points=\"9 12 11 14 15 10\"></polyline>\r\n            </svg>\r\n          )}\r\n        </div>\r\n        <h3 className=\"confirm-title\">{title}</h3>\r\n        <p className=\"confirm-message\">{message}</p>\r\n        <div className=\"confirm-actions\">\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"btn btn-secondary\"\r\n            autoFocus\r\n          >\r\n            {cancelText}\r\n          </button>\r\n          <button\r\n            onClick={onConfirm}\r\n            className={`btn btn-${variant}`}\r\n          >\r\n            {confirmText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ConfirmDialog;\r\n"
    },
    "client\\dist\\assets\\index-EBMiv7T_.js": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "client\\dist\\assets\\index-Ba-r_W9w.css": {
      "baseSnapshotId": "snapshot-1761753430562-e4054b61"
    },
    "CONTRACT_CREATION.md": {
      "deleted": true
    },
    "CLAUDE.md": {
      "deleted": true
    },
    "AUTH_ANALYSIS.md": {
      "deleted": true
    },
    "AGENTS.md": {
      "deleted": true
    },
    ".claude\\settings.local.json": {
      "deleted": true
    },
    "SEED_CREDENTIALS.md": {
      "deleted": true
    },
    "README.md": {
      "deleted": true
    },
    "PROPOSAL_MANAGEMENT.md": {
      "deleted": true
    },
    "src\\db\\seed.sql": {
      "deleted": true
    },
    "src\\db\\schema.sql": {
      "deleted": true
    },
    "src\\db\\migrations\\001_add_refresh_tokens.sql": {
      "deleted": true
    }
  }
}